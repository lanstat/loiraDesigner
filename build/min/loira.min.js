var Loira;!function(t){!function(t){var e=function(){function t(t,e,i){this.x=t,this.y=e,this.type=i}return t}();t.MouseEvent=e;var i=function(){function t(t,e){this.selected=t,this.type=e}return t}();t.ObjectEvent=i;var n=function(){function t(t,e){this.selected=t,this.type=e}return t}();t.RelationEvent=n}(t.event||(t.event={}))}(Loira||(Loira={}));var Loira;!function(t){var e=t.event.RelationEvent,i=t.event.ObjectEvent,n=t.event.MouseEvent,o=(function(){function t(){this.x=0,this.y=0,this.w=0,this.h=0}}(),function(){function t(){this.width=0,this.height=0,this.viewportWidth=0,this.viewportHeight=0,this.dragCanvas=!1}return t}()),s=function(){function t(t){void 0===t&&(t=32),this._fps=1e3/t,this._elapsed=(new Date).getTime()}return t.prototype.passed=function(){var t=!1,e=(new Date).getTime();return e>=this._elapsed&&(this._elapsed=e+this._fps,t=!0),t},t}(),r=function(){function t(){}return t}(),a=function(){function t(t){this._canvas=t,this._scale=1,this.update(1)}return t.prototype.update=function(t){this._scale+=t/Math.abs(t),this._scale<9&&this._scale>0&&(this.scrollX=Math.floor(this._canvas._config.width/20),this.scrollY=Math.floor(this._canvas._config.height/20))},t}(),h=function(){function h(e,i){this._selected=null,this._isDragged=!1,this._tmp=new r,this.items=[],this._canvas=null,this._background=null,this._canvasContainer=null,this.defaultRelation=null,this.container=null,this.container="string"==typeof e?document.getElementById(e):e,i||(i=new o,i.width=this.container.parentElement.offsetWidth,i.height=this.container.parentElement.offsetHeight),i.viewportWidth=i.viewportWidth||this.container.parentElement.offsetWidth||i.width,i.viewportHeight=i.viewportHeight||this.container.parentElement.offsetHeight||i.height,this._canvas=document.createElement("canvas"),this._canvas.width=i.width,this._canvas.height=i.height,this._canvas.style.position="absolute",this._canvas.style.left="0",this._canvas.style.top="0",this._canvas.style.zIndex="100",this._canvas.style.backgroundColor=t.Config.background,this._canvas.tabIndex=99,this.container.style.width=this.container.style.maxWidth=i.viewportWidth+"px",this.container.style.height=this.container.style.maxHeight=i.viewportHeight+"px",this.container.style.position="relative",this.container.style.overflow="auto",this._config=i,this._tmp.pointer={x:0,y:0},this.container.appendChild(this._canvas),this._callbacks={},this.items=[],this.defaultRelation="Relation.Association",document.defaultView&&document.defaultView.getComputedStyle&&(this._border={paddingLeft:parseInt(document.defaultView.getComputedStyle(this._canvas,null).paddingLeft,10)||0,paddingTop:parseInt(document.defaultView.getComputedStyle(this._canvas,null).paddingTop,10)||0,borderLeft:parseInt(document.defaultView.getComputedStyle(this._canvas,null).borderLeftWidth,10)||0,borderTop:parseInt(document.defaultView.getComputedStyle(this._canvas,null).borderTopWidth,10)||0});var n=this;t.drawable.registerMap(t.Config.assetsPath,t.Config.regions,function(){n.renderAll()}),this._bind(),this._setScrollContainer(),this._fps=new s(i.fps),this._zoom=new a(this)}return h.prototype.renderAll=function(t){if(void 0===t&&(t=!1),this._fps.passed()||t){var e=this._canvas.getContext("2d");e.clearRect(0,0,this._canvas.width,this._canvas.height);for(var i=0;i<this.items.length;i++)e.save(),this.items[i].render(e),e.restore();this._selected&&(e.save(),this._selected.drawSelected(e),e.restore(),this._selected.renderButtons(e))}},h.prototype.add=function(t){t.length||(t=[].splice.call(arguments,0));for(var n=this.items,o=this,s=0,r=t;s<r.length;s++){var a=r[s];if(a.attach(o),"relation"===a.baseType){var h=n.indexOf(a.start);h=h<n.indexOf(a.end)?h:n.indexOf(a.end),n.splice(h,0,a),o.emit("relation:added",new e(a,"relationadded"))}else"container"===a.baseType?(n.splice(0,0,a),o.emit("container:added",new i(a,"objectadded"))):(a.centerObject&&(o._canvasContainer?(a.x=o._canvasContainer.w/2+o._canvasContainer.x-a.width/2,a.y=o._canvasContainer.h/2+o._canvasContainer.y-a.height/2):(a.x=o._canvas.width/2,a.y=o._canvas.height/2)),n.push(a),o.emit("object:added",new i(a,"objectadded")))}},h.prototype.remove=function(t){t=[].splice.call(arguments,0);for(var e=this.items,n=this,o=0,s=t;o<s.length;o++){var r=s[o],a=[];r==this._selected&&(this._selected=null),r._canvas=null,a.push(e.indexOf(r));for(var h=0;h<e.length;h++)if("relation"===e[h].baseType){var c=e[h];c.start._uid!==r._uid&&c.end._uid!==r._uid||(c.destroy(),a.push(h))}a.sort();for(var h=a.length-1;h>=0;h--)e.splice(a[h],1);n.emit("object:removed",new i(r,"objectremoved"))}this.renderAll(!0),this._selected=null},h.prototype.removeAll=function(){for(var t=0;t<this.items.length;t++)this.items[t].destroy();this.items=[],this._selected=null},h.prototype.destroy=function(){for(this._canvas.onmousemove=null,this._canvas.onkeydown=null,this._canvas.onmousedown=null,this._canvas.onmouseup=null,this._canvas.ondblclick=null,this._canvas.onselectstart=null,this._canvasContainer&&this.container.removeEventListener("scroll",this._canvasContainer.listener),this._canvasContainer=null,this._canvas=null;this.container.firstChild;)this.container.removeChild(this.container.firstChild)},h.prototype.on=function(t,e){var i;if("string"==typeof t)return void 0===this._callbacks[t]&&(this._callbacks[t]=[]),this._callbacks[t].push(e),e;if("object"==typeof t)for(i in t)t.hasOwnProperty(i)&&(void 0===this._callbacks[i]&&(this._callbacks[i]=[]),this._callbacks[i].push(t[i]));return null},h.prototype.fall=function(t,e){var i=this._callbacks[t].indexOf(e);i>-1&&this._callbacks[t].splice(i,1)},h.prototype._bind=function(){var t=this,e=function(e,i){18!=e.keyCode&&(t._tmp.lastKey=e.keyCode,i||46===t._tmp.lastKey&&t._selected&&t.remove(t._selected))};t._canvas.onkeydown=function(t){e(t,!1)},document.addEventListener("keydown",function(t){e(t,!0)}),t._canvas.onkeyup=function(){t._tmp.lastKey=null},document.addEventListener("keyup",function(){t._tmp.lastKey=null}),t._canvas.onmousewheel=function(e){if(console.log(t._tmp.lastKey),17==t._tmp.lastKey)return t._zoom.update(e.deltaY),!1};var o=function(e,o){var s=t._getMouse(e);if(t._tmp.pointer=s,o?t.emit("mouse:dblclick",new n(s.x,s.y,"dblclick")):t.emit("mouse:down",new n(s.x,s.y,"mousedown")),o||(t._isDragged=!0,t._canvas.style.cursor="move"),t._selected){if(t._tmp.transform=t._selected.getSelectedCorner(s.x,s.y),t._tmp.transform||t._selected.callCustomButton(s.x,s.y)){switch(t._tmp.transform){case"tc":case"bc":t._canvas.style.cursor="ns-resize";break;case"ml":case"mr":t._canvas.style.cursor="ew-resize"}return}t._selected=null}for(var r,a=t.items.length-1;a>=0;a--)if(r=t.items[a],r.checkCollision(s.x,s.y)){if(t._selected=r,"relation"!==r.baseType){o?t.emit("object:dblclick",new i(r,"objectdblclick")):t.emit("object:selected",new i(r,"objectselected"));break}o?t.emit("relation:dblclick",new i(r,"relationdblclick")):t.emit("relation:selected",new i(r,"relationselected"));break}t.renderAll()};t._canvas.onmousedown=function(t){o(t,!1)},t._canvas.onmousemove=function(e){if(t._isDragged){var o=t._getMouse(e),s=o.x-t._tmp.pointer.x,r=o.y-t._tmp.pointer.y;if(t.emit("mouse:move",new n(o.x,o.y,"mousemove")),t._selected)if(t._tmp.transform){if("relation"!==t._selected.baseType)switch(s=Math.floor(s),r=Math.floor(r),t._tmp.transform){case"tc":t._selected.y+=r,t._selected.height-=r;break;case"bc":t._selected.height+=r;break;case"ml":t._selected.x+=s,t._selected.width-=s;break;case"mr":t._selected.width+=s}t.renderAll()}else t._selected.x+=s,t._selected.y+=r,t.emit("object:dragging",new i(t._selected,"objectdragging")),t.renderAll();else t._config.dragCanvas&&(console.log(t._zoom.scrollX,s),t._canvas&&t._canvasContainer&&(s=0===s?s:s/Math.abs(s),r=0===r?r:r/Math.abs(r),t.container.scrollLeft-=t._zoom.scrollX*s,t.container.scrollTop-=t._zoom.scrollY*r,t._canvasContainer.x=Math.floor(t.container.scrollLeft),t._canvasContainer.y=Math.floor(t.container.scrollTop)));t._tmp.pointer=o}},t._canvas.onmouseup=function(e){var o=t._getMouse(e);t._canvas.style.cursor="default",t._isDragged=!1,t.emit("mouse:up",new n(o.x,o.y,"mouseup")),t._selected&&(t.emit("object:released",new i(t._selected,"objectreleased")),t._tmp.transform=null,t._selected.recalculateBorders())},t._canvas.onmouseenter=function(){t.renderAll()},t._canvas.onmouseleave=function(){t._isDragged=!1,t._canvas.style.cursor="default"},t._canvas.onselectstart=function(){return!1}},h.prototype.emit=function(t,e,i){if(void 0!==i){t=("relation"===i.baseType?"relation":"object")+":"+t}if(void 0!==this._callbacks[t])for(var n=0,o=this._callbacks[t];n<o.length;n++){var s=o[n];s.call(this,e)}},h.prototype._getMouse=function(t){var e=this._canvas,i=0,n=0;if(e.offsetParent)do{i+=e.offsetLeft,n+=e.offsetTop}while(e=e.offsetParent);var o=this._border;i+=o.paddingLeft,n+=o.paddingTop,i+=o.borderLeft,n+=o.borderTop;var s={x:t.pageX-i,y:t.pageY-n};return this._canvasContainer&&(s.x+=this._canvasContainer.x,s.y+=this._canvasContainer.y),s},h.prototype.setBackground=function(t,e){this._background=document.createElement("canvas"),this._background.width=t.width,this._background.height=t.height,this._background.style.position="absolute",this._background.style.left="0",this._background.style.top="0",this._background.style.zIndex="0",this._background.getContext("2d").drawImage(t,0,0),e&&(this._canvas.width=t.width,this._canvas.height=t.height,this._canvas.style.backgroundColor="transparent"),this.container.insertBefore(this._background,this._canvas)},h.prototype.cleanBackground=function(){this.container.removeChild(this.container.firstChild),this._canvas.width=this._config.width,this._canvas.height=this._config.height,this.container.style.width=this.container.style.maxWidth=this._config.viewportWidth+"px",this.container.style.height=this.container.style.maxHeight=this._config.viewportHeight+"px",this._canvas.style.backgroundColor=t.Config.background},h.prototype._setScrollContainer=function(){var t=this;t._canvasContainer&&t.container.removeEventListener("scroll",t._canvasContainer.listener),t._canvasContainer={x:0,y:0,w:0,h:0,listener:function(){return t._canvasContainer.y=t.container.scrollTop,t._canvasContainer.x=t.container.scrollLeft,!0}},t._canvasContainer.w=t.container.clientWidth,t._canvasContainer.h=t.container.clientHeight,t.container.addEventListener("scroll",t._canvasContainer.listener)},h.prototype.getRelationsFromObject=function(t,e,i){for(var n=[],o=0,s=this.items;o<s.length;o++){var r=s[o];if("relation"===r.baseType){var a=r;a.start!==t&&a.end!==t||(a.start===t&&i?n.push(r):a.end===t&&e?n.push(r):e||i||n.push(r))}}return n},h.prototype.centerToPoint=function(t,e){this._canvas&&this._canvasContainer&&(t-=this.container.offsetWidth/2,e-=this.container.offsetHeight/2,t=t>=0?t:0,e=e>=0?e:0,this._canvasContainer.x=t,this._canvasContainer.y=e,this.container.scrollTop=e,this.container.scrollLeft=t)},h.prototype.getContext=function(){return this._canvas.getContext("2d")},h}();t.Canvas=h}(Loira||(Loira={}));var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Loira;!function(t){!function(t){function e(t){for(var e="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<t;n++)e+=i.charAt(Math.floor(Math.random()*i.length));return e}function i(t,e){var i=(t.y2-t.y1)*(e.x2-e.x1)-(t.x2-t.x1)*(e.y2-e.y1);if(0===i)return!1;var n=e.y1-t.y1,o=e.x1-t.x1;return n=((t.x2-t.x1)*n-(t.y2-t.y1)*o)/i,{x:e.x1+n*(e.x2-e.x1),y:e.y1+n*(e.y2-e.y1)}}function n(t){for(var e=t.split("."),i=window||this,n=0,o=e;n<o.length;n++){i=i[o[n]]}if("function"!=typeof i)throw new Error("function not found");return i}var o=function(){function t(){this.x=0,this.y=0,this.width=0,this.height=0,this.centerObject=!1,this.maxOutGoingRelation=0,this.extras={},this.text=""}return t}();t.BaseOption=o;var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(o);t.RelOption=s;var r=function(){function t(){}return t}();t.Line=r;var a=function(){function t(){}return t}();t.Region=a;var h=function(){function t(t,e){this.x=t,this.y=e}return t}();t.Point=h,t.createRandom=e,t.intersectPointLine=i,t.stringToFunction=n}(t.util||(t.util={}))}(Loira||(Loira={}));var Loira;!function(t){var e=t.util.BaseOption,i=function(){function i(i){this._uid=t.util.createRandom(8),void 0===i&&(i=new e),this.x="x"in i?i.x:0,this.y="y"in i?i.y:0,this.width="width"in i?i.width:0,this.height="height"in i?i.height:0,this.centerObject="centerObject"in i&&i.centerObject,this.maxOutGoingRelation="maxOutGoingRelation"in i?i.maxOutGoingRelation:0,this.extras="extras"in i?i.extras:{},this.text=i.text?i.text:"",this._buttons=[],this._canvas=null,this.type="",this.baseType="",this.animation=new Animation(this)}return i.prototype.render=function(t){this.animation.proccess()},i.prototype.checkCollision=function(t,e){return t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height},i.prototype.on=function(t){t=[].splice.call(arguments,0),this._buttons=t},i.prototype.renderButtons=function(e){var i=this.x+this.width+10,n=this.y;this._buttons.length>0&&this._buttons.forEach(function(o){t.drawable.render(o.icon,e,i,n),n+=t.drawable.get(o.icon).height+4})},i.prototype.callCustomButton=function(e,i){for(var n,o=this.x+this.width+10,s=this.y,r=0,a=this._buttons;r<a.length;r++){var h=a[r];if(n=t.drawable.get(h.icon),o<=e&&e<=o+n.width&&s<=i&&i<=s+n.height)return h.click.call(this),!0;s+=h.icon.height+4}return!1},i.prototype.drawSelected=function(e){var i=this.x-2,n=this.y-2,o=this.width,s=this.height;e.beginPath(),e.lineWidth=2,e.setLineDash([5,5]),e.strokeStyle=t.Config.selected.color,e.rect(i,n,o+4,s+4),e.stroke(),e.setLineDash([]),e.fillStyle=t.Config.selected.color,e.fillRect(i-4,n-4,8,8),e.fillRect(i+o,n+s,8,8),e.fillRect(i+o,n-4,8,8),e.fillRect(i-4,n+s,8,8),e.fillRect(i+o/2,n-4,8,8),e.fillRect(i+o/2,n+s,8,8),e.fillRect(i-4,n+s/2,8,8),e.fillRect(i+o,n+s/2,8,8),e.strokeStyle="#000000",e.fillStyle="#000000"},i.prototype.getSelectedCorner=function(t,e){var i=this.x-2,n=this.y-2,o=this.width,s=this.height,r=o/2,a=s/2;return i-4<=t&&t<=i+4&&n-4<=e&&e<=n+4?"tl":i+o<=t&&i+o+8>=t&&n-4<=e&&n+4>=e?"tr":i+o<=t&&i+o+8>=t&&n+s<=e&&n+s+8>=e?"br":i-4<=t&&i+4>=t&&n+s<=e&&n+s+8>=e?"bl":i+r<=t&&i+r+8>=t&&n-4<=e&&n+4>=e?"tc":i+r<=t&&i+r+8>=t&&n+s<=e&&n+s+8>=e?"bc":i-4<=t&&i+4>=t&&n+a<=e&&n+a+8>=e?"ml":i+o<=t&&i+o+8>=t&&n+a<=e&&n+a+8>=e?"mr":""},i.prototype.show=function(){this._canvas.centerToPoint(this.x+this.width/2,this.y+this.height/2)},i.prototype.attach=function(t){this._canvas=t,this.animation.setFps(t._config.fps)},i.prototype.animateTo=function(t,e){void 0===e&&(e=1);this._canvas._config.fps},i.prototype.destroy=function(){this._canvas=null},i}();t.Element=i}(Loira||(Loira={}));var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Common;!function(t){var e=Loira.util.Point,i=function(t){function i(i){var n=t.call(this,i)||this;return n.start=i.start?i.start:null,n.end=i.end?i.end:null,n.isDashed=!!i.isDashed&&i.isDashed,n.points=i.points?i.points:[new e,new e],n.icon=i.icon?i.icon:"",n.baseType="relation",n}return __extends(i,t),i.prototype.render=function(t){var e,i,n,o,s,r=this.start,a=this.end;this.points[0]={x:r.x+r.width/2,y:r.y+r.height/2},this.points[this.points.length-1]={x:a.x+a.width/2,y:a.y+a.height/2},i=this.points[0],n=this.points[1],t.beginPath(),t.lineWidth=1,t.moveTo(i.x,i.y),this.isDashed&&t.setLineDash([5,5]);for(var h=1;h<this.points.length;h++)t.lineTo(this.points[h].x,this.points[h].y);if(t.stroke(),t.setLineDash([]),this.icon){i=this.points[this.points.length-2],n=this.points[this.points.length-1],o=n.x-i.x,s=n.y-i.y,e=Math.atan(s/o),o<0&&(e+=Math.PI),t.translate(n.x,n.y),t.rotate(e);var c=Loira.drawable.get(this.icon),l=a.obtainBorderPos(o,s,{x1:i.x,y1:i.y,x2:n.x,y2:n.y},t);Loira.drawable.render(this.icon,t,-(c.width+l),-Math.ceil(c.height/2)),t.rotate(-e),t.translate(-n.x,-n.y)}if(this.text||this.text.length>0){t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType;var u=Math.round(this.points.length/2);i=this.points[u-1],n=this.points[u],o=n.x-i.x,s=n.y-i.y,e=t.measureText(this.text).width,t.fillStyle=Loira.Config.background,t.fillRect(i.x+o/2-e/2,i.y+s/2-15,e,12),t.fillStyle="#000000",t.fillText(this.text,i.x+o/2-e/2,i.y+s/2-5),t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType}},i.prototype.recalculateBorders=function(){},i.prototype.update=function(t,e){return this.start=t,this.end=e,this},i.prototype.checkCollision=function(t,e){for(var i,n=null,o=null,s=0,r=0,a={x:0,y:0},h={x:0,y:0},c=1;c<this.points.length;c++)if(n=this.points[c-1],o=this.points[c],a.x=n.x,a.y=n.y,h.y=o.y,h.x=o.x,n.x>o.x&&(a.x=o.x,h.x=n.x),n.y>o.y&&(a.y=o.y,h.y=n.y),t>a.x-5&&t<h.x+5&&e>a.y-5&&e<h.y+5)if(r=Math.abs(o.y-n.y),s=Math.abs(o.x-n.x),t=Math.abs(t-n.x),e=Math.abs(e-n.y),s>r){if(0===(i=Math.abs(r/s*t))&&e>a.y&&e<h.y||i>e-8&&i<e+8)return!0}else if(0===(i=Math.abs(s/r*e))&&t>a.x&&t<h.x||i>t-8&&i<t+8)return!0;return!1},i.prototype.drawSelected=function(t){t.beginPath(),t.fillStyle=Loira.Config.selected.color;for(var e=0;e<this.points.length;e++)t.fillRect(this.points[e].x-4,this.points[e].y-4,8,8);t.strokeStyle="#000000"},i.prototype.addPoint=function(){var t=this.points[1],e=this.points[0],i=Math.round((t.x-e.x)/2)+e.x,n=Math.round((t.y-e.y)/2)+e.y;this.points.splice(1,0,{x:i,y:n})},i.prototype.getSelectedCorner=function(t,e){for(var i=1;i<this.points.length-1;i++){var n=this.points[i].x-4,o=this.points[i].y-4,s=n+8,r=o+8;if(t>n&&t<s&&e>o&&e<r)return i}return!1},i.prototype.movePoint=function(t,e,i){this.points[t].x+=e,this.points[t].y+=i},i}(Loira.Element);t.Relation=i;var n=function(t){function e(e){var i=t.call(this,e)||this,n=i._linkSymbol;return i.on({icon:"arrow",click:n}),i.baseType="symbol",i}return __extends(e,t),e.prototype._linkSymbol=function(){var t=this,e=this._canvas.on("mouse:down",function(i){var n=t._canvas,o=n.getRelationsFromObject(t,!1,!0).length;if(!t.maxOutGoingRelation||o<t.maxOutGoingRelation)for(var s=0,r=n.items;s<r.length;s++){var a=r[s];if("relation"!==a.baseType&&a.checkCollision(i.x,i.y)){var h=Loira.util.stringToFunction(n.defaultRelation);n.add(new h({}).update(t,a));break}}n.fall("mouse:down",e)})},e.prototype._splitText=function(t,e,i){void 0===i&&(i=10);for(var n=e.split(" "),o="",s=[],r=0;r<n.length;r++)t.measureText(o+n[r]).width>this.width-i?(s.push(o),o=n[r]+" "):o=o+" "+n[r];return s.push(o),s},e.prototype.drawText=function(t,e){var i,n,o=this.x+this.width/2,s=this.y+this.height/2;n=this._splitText(t,e),i=s+3-(6*n.length+3*n.length)/2;for(var r=0;r<n.length;r++){var a=t.measureText(n[r]).width;t.fillText(n[r],o-a/2,i+3),i=i+Loira.Config.fontSize+3}},e}(Loira.Element);t.Symbol=n;var o=function(t){function e(e){var i=t.call(this,e)||this;return i.text=e.text?e.text:"Actor1",i.width=30,i.height=85,i.type="actor",i}return __extends(e,t),e.prototype.obtainBorderPos=function(t,e,i,n){n.font=Loira.Config.fontSize+"px "+Loira.Config.fontType;var o=n.measureText(this.text).width;o>this.width&&(this.x=this.x+this.width/2-o/2,this.width=o);var s=Math.atan(e/t);t<0&&(s+=Math.PI);var r=null;return r=s>-.8&&s<.68||s>2.46&&s<4?Loira.util.intersectPointLine(i,{x1:this.x,y1:-100,x2:this.x,y2:100}):Loira.util.intersectPointLine(i,{x1:-100,y1:this.y,x2:100,y2:this.y}),Math.sqrt(Math.pow(r.x-(this.x+this.width/2),2)+Math.pow(r.y-(this.y+this.height/2),2))},e.prototype.render=function(t){var e=t.measureText(this.text).width;e>this.width&&(this.x=this.x+this.width/2-e/2,this.width=e),t.fillStyle=Loira.Config.background,t.fillRect(this.x,this.y,this.width,this.height),t.fillStyle="#000000",Loira.drawable.render("actor",t,this.x+this.width/2-15,this.y),t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType,t.fillStyle="#000000",t.fillText(this.text,this.x,this.y+80)},e.prototype.recalculateBorders=function(){},e}(t.Symbol);t.Actor=o}(Common||(Common={}));var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Relation;!function(t){var e=function(t){function e(e){var i=t.call(this,e)||this;return i.type="association",i}return __extends(e,t),e}(Common.Relation);t.Association=e;var i=function(t){function e(e){var i=this;return e.icon="spear",i=t.call(this,e)||this,i.type="direct_association",i}return __extends(e,t),e}(Common.Relation);t.DirectAssociation=i;var n=function(t){function e(e){var i=this;return e.icon="spear2",i=t.call(this,e)||this,i.type="generalization",i}return __extends(e,t),e}(Common.Relation);t.Generalization=n;var o=function(t){function e(e){var i=this;return e.icon="spear2",e.isDashed=!0,i=t.call(this,e)||this,i.type="realization",i}return __extends(e,t),e}(Common.Relation);t.Realization=o;var s=function(t){function e(e){var i=this;return e.icon="spear1",e.isDashed=!0,i=t.call(this,e)||this,i.type="dependency",i}return __extends(e,t),e}(Common.Relation);t.Dependency=s}(Relation||(Relation={})),Loira.XmiParser={load:function(t,e){var i,n,o=null;if(window.DOMParser){o=(new DOMParser).parseFromString(t,"text/xml")}else o=new ActiveXObject("Microsoft.XMLDOM"),o.async=!1,o.loadXML(t);var s=this._parse(o),r={};for(n in s.symbols)s.symbols.hasOwnProperty(n)&&(i=s.symbols[n],"UML:UseCase"===i.type?r[i.id]=new UseCase.UseCase({text:i.name}):"UML:Actor"===i.type&&(r[i.id]=new Common.Actor({text:i.name})),e.add(r[i.id]));for(n in s.relations)if(s.relations.hasOwnProperty(n)&&(i=s.relations[n],"UML:Association"===i.type)){for(var a={},h=0;h<i.connection.length;h++)"source"===i.connection[h].taggedValues.ea_end?a.start=r[i.connection[h].type]:"target"===i.connection[h].taggedValues.ea_end&&(a.end=r[i.connection[h].type]);e.addRelation(new Relation.Association(a))}setTimeout(function(){e.renderAll()},50)},_parse:function(t){var e=this._xmlToJson(t),i=e.XMI["XMI.content"]["UML:Model"]["UML:Namespace.ownedElement"]["UML:Package"]["UML:Namespace.ownedElement"],n={},o={};for(var s in i)if(i.hasOwnProperty(s)&&"string"!=typeof i[s]){var r=i[s]["@attributes"]["xmi.id"];if(void 0!==i[s]["UML:Association.connection"]){o[r]={isAbstract:"true"===i[s]["@attributes"].isAbstract,isLeaf:"true"===i[s]["@attributes"].isLeaf,isRoot:"true"===i[s]["@attributes"].isRoot,visibility:i[s]["@attributes"].visibility,id:i[s]["@attributes"]["xmi.id"],type:s,connection:[]};for(var a=0;a<i[s]["UML:Association.connection"]["UML:AssociationEnd"].length;a++){for(var h=i[s]["UML:Association.connection"]["UML:AssociationEnd"][a],c={aggregation:h["@attributes"].aggregation,changeable:h["@attributes"].changeable,isNavigable:"true"===h["@attributes"].isNavigable,isOrdered:"true"===h["@attributes"].isOrdered,targetScope:h["@attributes"].targetScope,type:h["@attributes"].type,visibility:h["@attributes"].visibility,taggedValues:{}},l=0;l<h["UML:ModelElement.taggedValue"]["UML:TaggedValue"].length;l++){var u=h["UML:ModelElement.taggedValue"]["UML:TaggedValue"][l]["@attributes"];c.taggedValues[u.tag]=u.value}o[r].connection.push(c)}}else n[r]={isAbstract:"true"===i[s]["@attributes"].isAbstract,isLeaf:"true"===i[s]["@attributes"].isLeaf,isRoot:"true"===i[s]["@attributes"].isRoot,name:i[s]["@attributes"].name,namespace:i[s]["@attributes"].namespace,visibility:i[s]["@attributes"].visibility,id:i[s]["@attributes"]["xmi.id"],type:s}}return{symbols:n,relations:o}},_xmlToJson:function(t){var e={};if(1===t.nodeType){if(t.attributes.length>0){e["@attributes"]={};for(var i=0;i<t.attributes.length;i++){var n=t.attributes.item(i);e["@attributes"][n.nodeName]=n.nodeValue}}}else 3===t.nodeType&&(e=t.nodeValue);if(t.hasChildNodes())for(var o=0;o<t.childNodes.length;o++){var s=t.childNodes.item(o),r=s.nodeName;if(void 0===e[r])e[r]=this._xmlToJson(s);else{if(void 0===e[r].push){var a=e[r];e[r]=[],e[r].push(a)}e[r].push(this._xmlToJson(s))}}return e}};var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),UseCase;!function(t){var e=function(t){function e(e){var i=t.call(this,e)||this;return i.width=100,i.height=70,i.text=e.text,i.type="use_case",i}return __extends(e,t),e.prototype.obtainBorderPos=function(t,e,i,n){var o=this.width/2,s=this.height/2,r=o*s/Math.sqrt(o*o*e*e+s*s*t*t);return Math.sqrt(Math.pow(r*e,2)+Math.pow(r*t,2))},e.prototype.render=function(t){if(t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType,this.text){var e=this.width/2*.5522848,i=this.height/2*.5522848,n=this.x+this.width,o=this.y+this.height,s=this.x+this.width/2,r=this.y+this.height/2;t.beginPath(),t.lineWidth=2,t.moveTo(this.x,r),t.bezierCurveTo(this.x,r-i,s-e,this.y,s,this.y),t.bezierCurveTo(s+e,this.y,n,r-i,n,r),t.bezierCurveTo(n,r+i,s+e,o,s,o),t.bezierCurveTo(s-e,o,this.x,r+i,this.x,r),t.stroke(),t.fillStyle="#fcf5d9",t.fill(),t.fillStyle="#000000",this.drawText(t,this.text)}},e.prototype.recalculateBorders=function(){},e}(Common.Symbol);t.UseCase=e;var i=function(t){function e(e){var i=this;return e.icon="spear1",e.text="<< extends >>",e.isDashed=!0,i=t.call(this,e)||this,i.type="extends",i}return __extends(e,t),e}(Common.Relation);t.Extends=i;var n=function(t){function e(e){var i=this;return e.icon="spear1",e.text="<< include >>",e.isDashed=!0,i=t.call(this,e)||this,i.type="include",i}return __extends(e,t),e}(Common.Relation);t.Include=n}(UseCase||(UseCase={}));var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Box;!function(t){var e=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}__extends(e,t)}(Loira.util.BaseOption),function(t){function e(e){var i=t.call(this,e)||this;return i.width="width"in e?e.width:30,i.height="height"in e?e.height:30,i.color="color"in e?e.color:"rgba(0,0,0,0.3)",i.baseType="box",i}return __extends(e,t),e.prototype.render=function(t){t.fillStyle=this.color,t.fillRect(this.x,this.y,this.width,this.height),t.fillText(this.text,this.x,this.y-10)},e.prototype.recalculateBorders=function(){},e}(Loira.Element));t.Box=e}(Box||(Box={}));var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Workflow;!function(t){var e=Loira.util.BaseOption,i=Loira.util.Point,n=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}__extends(e,t)}(e),function(t){function e(e){var i=t.call(this,e)||this;return i.startPoint=!!e.startPoint&&e.startPoint,i.endPoint=!!e.endPoint&&e.endPoint,i}return __extends(e,t),e.prototype._linkSymbol=function(){var t=this,e=this._canvas.on("mouse:down",function(n){var o=t._canvas;if(!t.maxOutGoingRelation||o.getRelationsFromObject(t,!1,!0).length<t.maxOutGoingRelation)for(var s=0,r=o.items;s<r.length;s++){var a=r[s];if("relation"!==a.baseType&&!a.startPoint&&a.checkCollision(n.x,n.y)&&!t.endPoint){var h=Loira.util.stringToFunction(o.defaultRelation),c=null;if(t._uid==a._uid){var l=t.x+t.width+30,u=t.y+t.height/2;c=[],c.push(new i),c.push(new i(l,u)),c.push(new i(l,t.y-30)),c.push(new i(t.x+t.width/2,t.y-30)),c.push(new i)}o.add(new h({points:c}).update(t,a));break}}o.fall("mouse:down",e)})},e}(Common.Symbol)),o=function(t){function e(e){var i=this;return e.width=e.width?e.width:100,e.height=e.height?e.height:70,i=t.call(this,e)||this,i.text=e.text,i.type="process",i.borders={bottomLeft:0,topLeft:0,topRight:0,bottomRight:0},i.recalculateBorders(),i.maxOutGoingRelation=1,i}return __extends(e,t),e.prototype.obtainBorderPos=function(t,e,i,n){var o=Math.atan(e/t);t<0&&(o+=Math.PI);var s={x:100,y:this.y-10};s=o>this.borders.bottomLeft&&o<this.borders.topLeft||o>this.borders.topRight&&o<this.borders.bottomRight?Loira.util.intersectPointLine(i,{x1:this.x,y1:-100,x2:this.x,y2:100}):Loira.util.intersectPointLine(i,{x1:-100,y1:this.y,x2:100,y2:this.y});var r=s.x-(this.x+this.width/2),a=s.y-(this.y+this.height/2);return Math.sqrt(Math.pow(r,2)+Math.pow(a,2))},e.prototype.render=function(t){t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType,t.beginPath(),t.lineWidth=2,t.rect(this.x,this.y,this.width,this.height),t.stroke(),t.fillStyle="#fcf5d9",t.fill(),t.fillStyle="#000000",this.drawText(t,this.text)},e.prototype.recalculateBorders=function(){var t=Math.round(this.width/2),e=Math.round(this.height/2);this.borders.bottomLeft=Math.atan(-e/t),this.borders.topLeft=Math.atan(e/t),this.borders.topRight=Math.atan(e/-t)+Math.PI,this.borders.bottomRight=Math.atan(-e/-t)+Math.PI},e}(n);t.Process=o;var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.obtainBorderPos=function(t,e,i,n){var o=this.width/2,s=this.height/2,r=o*s/Math.sqrt(o*o*e*e+s*s*t*t);return Math.sqrt(Math.pow(r*e,2)+Math.pow(r*t,2))},e.prototype.render=function(t){t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType;var e=this.x+20,i=this.y,n=this.x+this.width-20,o=this.y+this.height;t.beginPath(),t.lineWidth=2,t.moveTo(e,i),t.lineTo(n,i),t.bezierCurveTo(n+30,i,n+30,o,n,o),t.lineTo(e,o),t.bezierCurveTo(e-30,o,e-30,i,e,i),t.stroke(),t.fillStyle="#fcf5d9",t.fill(),t.fillStyle="#000000",this.drawText(t,this.text)},e.prototype.recalculateBorders=function(){},e}(n),r=function(t){function e(e){var i=this;return e.width=e.width?e.width:100,e.height=e.height?e.height:70,i=t.call(this,e)||this,i.text="INICIO",i.startPoint=!0,i.maxOutGoingRelation=1,i.type="start_terminator",i}return __extends(e,t),e}(s);t.StartTerminator=r;var a=function(t){function e(e){var i=t.call(this,e)||this;return i.width=70,i.height=30,i.text="FIN",i.endPoint=!0,i.type="end_terminator",i}return __extends(e,t),e}(s);t.EndTerminator=a;var h=function(t){function e(e){var i=this;return e.width=e.width?e.width:100,e.height=e.height?e.height:70,i=t.call(this,e)||this,i.text=e.text,i.type="data",i}return __extends(e,t),e.prototype.obtainBorderPos=function(t,e,i,n){var o=this.width/2,s=this.height/2,r=o*s/Math.sqrt(o*o*e*e+s*s*t*t);return Math.sqrt(Math.pow(r*e,2)+Math.pow(r*t,2))},e.prototype.render=function(t){t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType;var e=this.x+20,i=this.y,n=this.x+this.width,o=this.y+this.height;t.beginPath(),t.lineWidth=2,t.moveTo(e,i),t.lineTo(n,i),t.lineTo(n-20,o),t.lineTo(e-20,o),t.lineTo(e,i),t.stroke(),t.fillStyle="#fcf5d9",t.fill(),t.fillStyle="#000000",this.drawText(t,this.text)},e.prototype.recalculateBorders=function(){},e}(n);t.Data=h;var c=function(t){function e(e){var i=this;return e.width=e.width?e.width:100,e.height=e.height?e.height:70,i=t.call(this,e)||this,i.text=e.text,i.type="decision",i}return __extends(e,t),e.prototype.obtainBorderPos=function(t,e,i,n){var o,s=this.x,r=this.y,a=this.x+this.width/2,h=this.y+this.height/2,c=this.x+this.width,l=Math.atan(h/t);return t<0&&(l+=Math.PI),
o=l>0&&l<1.6||l>3.15&&l<4.7?Loira.util.intersectPointLine(i,{x1:s,y1:h,x2:a,y2:r}):Loira.util.intersectPointLine(i,{x1:a,y1:r,x2:c,y2:h}),s=o.x-(this.x+this.width/2),r=o.y-(this.y+this.height/2),Math.sqrt(Math.pow(s,2)+Math.pow(r,2))},e.prototype.render=function(t){t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType;var e=this.x,i=this.y,n=this.x+this.width/2,o=this.y+this.height/2,s=this.x+this.width,r=this.y+this.height;t.beginPath(),t.lineWidth=2,t.moveTo(n,i),t.lineTo(s,o),t.lineTo(n,r),t.lineTo(e,o),t.lineTo(n,i),t.stroke(),t.fillStyle="#fcf5d9",t.fill(),t.fillStyle="#000000",this.drawText(t,this.text)},e.prototype.recalculateBorders=function(){},e}(n);t.Decision=c}(Workflow||(Workflow={}));var Loira;!function(t){var e={color:"#339966"},i={actor:{x:0,y:98,width:35,height:72},spear:{x:0,y:0,width:25,height:25},spear1:{x:0,y:31,width:27,height:28},spear2:{x:34,y:0,width:25,height:26},arrow:{x:27,y:26,width:12,height:16}},n={levelColor:["#124FFD","#FF4FFD","#12003D"]};!function(t){t.fontSize=12,t.fontType="Arial",t.selected=e,t.background="#aacccc",t.assetsPath="../assets/glyphs.png",t.regions=i,t.orgChart=n}(t.Config||(t.Config={}))}(Loira||(Loira={}));