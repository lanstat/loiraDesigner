var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Loira;!function(t){!function(t){var e=function(){function t(){}return t}();t.Event=e;var i=function(t){function e(e,i){var n=t.call(this)||this;return n.x=e,n.y=i,n}return __extends(e,t),e}(e);t.MouseEvent=i;var n=function(t){function e(e){var i=t.call(this)||this;return i.selected=e,i}return __extends(e,t),e}(e);t.ObjectEvent=n;var o=function(t){function e(e){var i=t.call(this)||this;return i.selected=e,i}return __extends(e,t),e}(e);t.RelationEvent=o}(t.event||(t.event={}))}(Loira||(Loira={}));var Loira;!function(t){!function(t){function e(t,e,i){this.image=new Image,this.image.src=t,this.image.onload=function(){i()},this.regions=e}function i(t,e,i,n){var o=this.regions[t];e.drawImage(this.image,o.x,o.y,o.width,o.height,i,n,o.width,o.height)}function n(t){return this.regions[t]}t.registerMap=e,t.render=i,t.get=n}(t.drawable||(t.drawable={}))}(Loira||(Loira={}));var Loira;!function(t){!function(t){function e(t,e,i,n,o,r){t.beginPath(),t.moveTo(e+r,i),t.lineTo(e+n-r,i),t.quadraticCurveTo(e+n,i,e+n,i+r),t.lineTo(e+n,i+o-r),t.quadraticCurveTo(e+n,i+o,e+n-r,i+o),t.lineTo(e+r,i+o),t.quadraticCurveTo(e,i+o,e,i+o-r),t.lineTo(e,i+r),t.quadraticCurveTo(e,i,e+r,i),t.closePath(),t.stroke(),t.fill()}function i(t,e,i){}!function(t){t[t.LEFT=0]="LEFT",t[t.CENTER=1]="CENTER",t[t.RIGHT=2]="RIGHT"}(t.HorizontalAlign||(t.HorizontalAlign={}));!function(t){t[t.TOP=0]="TOP",t[t.MIDDLE=1]="MIDDLE",t[t.BOTTOM=2]="BOTTOM"}(t.VerticalAlign||(t.VerticalAlign={})),t.drawRoundRect=e,t.drawText=i}(t.shape||(t.shape={}))}(Loira||(Loira={}));var Loira;!function(t){var e=t.event.RelationEvent,i=t.event.ObjectEvent,n=t.event.MouseEvent,o=function(){function t(){this.x=0,this.y=0,this.w=0,this.h=0}return t}();t.CanvasContainer=o;var r=function(){function t(){this.width=0,this.height=0,this.viewportWidth=0,this.viewportHeight=0,this.dragCanvas=!1,this.controller=null,this.readOnly=!1}return t}();t.CanvasConfig=r;var s=function(){function t(t){void 0===t&&(t=32),this._fps=1e3/t,this._elapsed=(new Date).getTime()}return t.prototype.passed=function(){var t=!1,e=(new Date).getTime();return e>=this._elapsed&&(this._elapsed=e+this._fps,t=!0),t},t}(),a=function(){function t(){}return t}(),h=function(){function t(t){this._canvas=t,this._scale=1,this.update(1)}return t.prototype.update=function(t){this._scale+=t/Math.abs(t),this._scale<9&&this._scale>0&&(this.scrollX=Math.floor(this._canvas._config.width/20),this.scrollY=Math.floor(this._canvas._config.height/20))},t}(),l=function(){function o(e,i){this._selected=null,this._isDragged=!1,this._tmp=new a,this.items=[],this._canvas=null,this._background=null,this._canvasContainer=null,this.defaultRelation=null,this.container=null,this.readOnly=!1,this.container="string"==typeof e?document.getElementById(e):e,i||(i=new r,i.width=this.container.parentElement.offsetWidth,i.height=this.container.parentElement.offsetHeight),i.viewportWidth=i.viewportWidth||this.container.offsetWidth||this.container.parentElement.offsetWidth||i.width,i.viewportHeight=i.viewportHeight||this.container.offsetHeight||this.container.parentElement.offsetHeight||i.height,this._canvas=this.createHiDPICanvas(i.width,i.height),this._canvas.style.position="absolute",this._canvas.style.left="0",this._canvas.style.top="0",this._canvas.style.zIndex="100",this._canvas.style.backgroundColor=t.Config.background,this._canvas.tabIndex=99,this.container.style.width=this.container.style.maxWidth=i.viewportWidth+"px",this.container.style.height=this.container.style.maxHeight=i.viewportHeight+"px",this.container.style.position="relative",this.container.style.overflow="auto",this.readOnly=i.readOnly||!1,this._config=i,this._tmp.pointer={x:0,y:0},this.container.appendChild(this._canvas),this._callbacks={},this.items=[],this.defaultRelation="Relation.Association",document.defaultView&&document.defaultView.getComputedStyle&&(this._border={paddingLeft:parseInt(document.defaultView.getComputedStyle(this._canvas,null).paddingLeft,10)||0,paddingTop:parseInt(document.defaultView.getComputedStyle(this._canvas,null).paddingTop,10)||0,borderLeft:parseInt(document.defaultView.getComputedStyle(this._canvas,null).borderLeftWidth,10)||0,borderTop:parseInt(document.defaultView.getComputedStyle(this._canvas,null).borderTopWidth,10)||0});var n=this;t.drawable.registerMap(t.Config.assetsPath,t.Config.regions,function(){n.renderAll()}),this._bind(),this._setScrollContainer(),this._fps=new s(i.fps),this._zoom=new h(this),this.controller=i.controller||null,this.controller&&this.controller.bind(this)}return o.prototype.createHiDPICanvas=function(t,e,i){var n=function(){var t=document.createElement("canvas").getContext("2d");return(window.devicePixelRatio||1)/(t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1)}();i||(i=n);var o=document.createElement("canvas");return o.width=t*i,o.height=e*i,o.style.width=t+"px",o.style.height=e+"px",o.getContext("2d").setTransform(i,0,0,i,0,0),o},o.prototype.renderAll=function(t){if(void 0===t&&(t=!1),this._fps.passed()||t){var e=this._canvas.getContext("2d");e.clearRect(0,0,this._canvas.width,this._canvas.height);for(var i=0;i<this.items.length;i++)e.save(),this.items[i].render(e),e.restore();this._selected&&this._selected.selectable&&(e.save(),this._selected.drawSelected(e),e.restore(),this._selected.renderButtons(e))}},o.prototype.add=function(t,n){if(void 0===n&&(n=!0),!this.readOnly){var o,r,s=this.items,a=this;r="[object Array]"!==Object.prototype.toString.call(t)?[t]:t;for(var h=0,l=r;h<l.length;h++){var c=l[h];if(c.attach(a),"relation"===c.baseType){o=c;var u=s.indexOf(o.start);u=u<s.indexOf(o.end)?u:s.indexOf(o.end),s.splice(u,0,c),a.emit("relation:added",new e(o),n)}else"container"===c.baseType?(s.splice(0,0,c),a.emit("container:added",new i(c),n)):(c.centerObject&&(a._canvasContainer?(c.x=a._canvasContainer.w/2+a._canvasContainer.x-c.width/2,c.y=a._canvasContainer.h/2+a._canvasContainer.y-c.height/2):(c.x=a._canvas.width/2,c.y=a._canvas.height/2)),s.push(c),a.emit("object:added",new i(c),n))}}},o.prototype.remove=function(t,e){void 0===e&&(e=!0);for(var n=this.items,o=this,r=0,s=t;r<s.length;r++){var a=s[r],h=[];a==this._selected&&(this._selected=null),h.push(n.indexOf(a));for(var l=0;l<n.length;l++)if("relation"===n[l].baseType){var c=n[l];c.start._uid!==a._uid&&c.end._uid!==a._uid||(c.destroy(),h.push(l))}h.sort(function(t,e){return t-e});for(var l=h.length-1;l>=0;l--)n.splice(h[l],1);o.emit("object:removed",new i(a),e)}this.renderAll(!0),this._selected=null},o.prototype.removeAll=function(){for(var t=0;t<this.items.length;t++)this.items[t].destroy();this.items=[],this._selected=null},o.prototype.destroy=function(){for(this._canvas.onmousemove=null,this._canvas.onkeydown=null,this._canvas.onmousedown=null,this._canvas.onmouseup=null,this._canvas.ondblclick=null,this._canvas.onselectstart=null,this._canvasContainer&&this.container.removeEventListener("scroll",this._canvasContainer.listener),this._canvasContainer=null,this._canvas=null;this.container.firstChild;)this.container.removeChild(this.container.firstChild)},o.prototype.on=function(t,e){var i;if("string"==typeof t)return void 0===this._callbacks[t]&&(this._callbacks[t]=[]),this._callbacks[t].push(e),e;if("object"==typeof t)for(i in t)t.hasOwnProperty(i)&&(void 0===this._callbacks[i]&&(this._callbacks[i]=[]),this._callbacks[i].push(t[i]));return null},o.prototype.fall=function(t,e){var i=this._callbacks[t].indexOf(e);i>-1&&this._callbacks[t].splice(i,1)},o.prototype._bind=function(){var t=this,e=document.createElement("ul");e.id="loira-context-menu",e.oncontextmenu=function(){return!1},document.getElementsByTagName("body")[0].appendChild(e);var o=function(e,i){18!=e.keyCode&&(t._tmp.lastKey=e.keyCode,i||46===t._tmp.lastKey&&t._selected&&t.remove([t._selected]))};t._canvas.onkeydown=function(e){t.readOnly||o(e,!1)},document.addEventListener("keydown",function(e){t.readOnly||o(e,!0)}),t._canvas.onkeyup=function(){t.readOnly||(t._tmp.lastKey=null)},document.addEventListener("keyup",function(){t.readOnly||(t._tmp.lastKey=null)}),t._canvas.onmousewheel=function(e){if(17==t._tmp.lastKey)return t._zoom.update(e.deltaY),!1};var r=function(e,o){var r=t._getMouse(e);if(t._tmp.pointer=r,o?t.emit("mouse:dblclick",new n(r.x,r.y)):t.emit("mouse:down",new n(r.x,r.y)),o||t.readOnly||(t._isDragged=!0,t._canvas.style.cursor="move"),t._selected&&!t.readOnly){if(t._tmp.transform=t._selected.getSelectedCorner(r.x,r.y),t._tmp.transform||t._selected.callCustomButton(r.x,r.y)){switch(t._tmp.transform){case"tc":case"bc":t._canvas.style.cursor="ns-resize";break;case"ml":case"mr":t._canvas.style.cursor="ew-resize"}return}t._selected=null,t.emit("object:unselected",new n(r.x,r.y))}for(var s,a=t.items.length-1;a>=0;a--)if(s=t.items[a],s.checkCollision(r.x,r.y)){if(t._selected=s,"relation"!==s.baseType){o?t.emit("object:dblclick",new i(s)):t.emit("object:selected",new i(s));break}o?t.emit("relation:dblclick",new i(s)):t.emit("relation:selected",new i(s));break}t.renderAll()};t._canvas.onmousedown=function(t){e.style.display="none",r(t,!1)},t._canvas.oncontextmenu=function(i){e.style.display="none";var n=t._getMouse(i),o=t.getElementByPosition(n.x,n.y);if(o&&o.menu){var r=void 0;e.innerHTML="";for(var s=0,a=o.menu;s<a.length;s++){var h=a[s];!function(t){r=document.createElement("li"),r.innerHTML=t.item,r.onclick=function(){t.callback(this,o),e.style.display="none"},e.appendChild(r)}(h)}e.style.top=i.clientY+"px",e.style.left=i.clientX+"px",e.style.display="block",e.style.opacity="1"}return!1},t._canvas.onmousemove=function(e){if(!t.readOnly&&t._isDragged){var o=t._getMouse(e),r=o.x-t._tmp.pointer.x,s=o.y-t._tmp.pointer.y;if(t.emit("mouse:move",new n(o.x,o.y)),t._selected)if(t._tmp.transform){if("relation"!==t._selected.baseType)switch(r=Math.floor(r),s=Math.floor(s),t._tmp.transform){case"tc":t._selected.y+=s,t._selected.height-=s;break;case"bc":t._selected.height+=s;break;case"ml":t._selected.x+=r,t._selected.width-=r;break;case"mr":t._selected.width+=r}else t._selected.movePoint(parseInt(t._tmp.transform),r,s);t.renderAll()}else t._selected.draggable&&(t._selected.x+=r,t._selected.y+=s,t.emit("object:dragging",new i(t._selected)),t.renderAll());else t._config.dragCanvas&&t._canvas&&t._canvasContainer&&(r=0===r?r:r/Math.abs(r),s=0===s?s:s/Math.abs(s),t.container.scrollLeft-=t._zoom.scrollX*r,t.container.scrollTop-=t._zoom.scrollY*s,t._canvasContainer.x=Math.floor(t.container.scrollLeft),t._canvasContainer.y=Math.floor(t.container.scrollTop));t._tmp.pointer=o}},t._canvas.onmouseup=function(e){if(!t.readOnly){var o=t._getMouse(e);t._canvas.style.cursor="default",t._isDragged=!1,t.emit("mouse:up",new n(o.x,o.y)),t._selected&&(t.emit("object:released",new i(t._selected)),t._tmp.transform=null,t._selected.recalculateBorders())}},t._canvas.onmouseenter=function(){t.renderAll()},t._canvas.onmouseleave=function(){t._isDragged=!1,t._canvas.style.cursor="default"},t._canvas.onselectstart=function(){return!1}},o.prototype.emit=function(t,e,i){if(void 0===i&&(i=!0),i&&void 0!==this._callbacks[t])for(var n=0,o=this._callbacks[t];n<o.length;n++){var r=o[n];r.call(this,e)}},o.prototype._getMouse=function(t){var e=this._canvas,i=0,n=0;if(e.offsetParent)do{i+=e.offsetLeft,n+=e.offsetTop}while(e=e.offsetParent);var o=this._border;i+=o.paddingLeft,n+=o.paddingTop,i+=o.borderLeft,n+=o.borderTop;var r={x:t.pageX-i,y:t.pageY-n};return this._canvasContainer&&(r.x+=this._canvasContainer.x,r.y+=this._canvasContainer.y),r},o.prototype.setBackground=function(t,e){this._background=this.createHiDPICanvas(t.width,t.height),this._background.style.position="absolute",this._background.style.left="0",this._background.style.top="0",this._background.style.zIndex="0",this._background.getContext("2d").drawImage(t,0,0),e&&(this._canvas.width=this._background.width,this._canvas.height=this._background.height,this._canvas.style.width=this._background.width+"px",this._canvas.style.height=this._background.height+"px",this._canvas.style.backgroundColor="transparent"),this.container.insertBefore(this._background,this._canvas)},o.prototype.trigger=function(t,e){this.emit(t,new i(e))},o.prototype.cleanBackground=function(){this.container.removeChild(this.container.firstChild),this._canvas.width=this._config.width,this._canvas.height=this._config.height,this.container.style.width=this.container.style.maxWidth=this._config.viewportWidth+"px",this.container.style.height=this.container.style.maxHeight=this._config.viewportHeight+"px",this._canvas.style.backgroundColor=t.Config.background},o.prototype._setScrollContainer=function(){var t=this;t._canvasContainer&&t.container.removeEventListener("scroll",t._canvasContainer.listener),t._canvasContainer={x:0,y:0,w:0,h:0,listener:function(){return t._canvasContainer.y=t.container.scrollTop,t._canvasContainer.x=t.container.scrollLeft,!0}},t._canvasContainer.w=t.container.clientWidth,t._canvasContainer.h=t.container.clientHeight,t.container.addEventListener("scroll",t._canvasContainer.listener)},o.prototype.getRelationsFromObject=function(t,e,i){for(var n=[],o=0,r=this.items;o<r.length;o++){var s=r[o];if("relation"===s.baseType){var a=s;a.start!==t&&a.end!==t||(a.start===t&&i?n.push(s):a.end===t&&e?n.push(s):e||i||n.push(s))}}return n},o.prototype.centerToPoint=function(t,e){this._canvas&&this._canvasContainer&&(t-=this.container.offsetWidth/2,e-=this.container.offsetHeight/2,t=t>=0?t:0,e=e>=0?e:0,this._canvasContainer.x=t,this._canvasContainer.y=e,this.container.scrollTop=e,this.container.scrollLeft=t)},o.prototype.setSelectedElement=function(t){this._selected=t},o.prototype.getContext=function(){return this._canvas.getContext("2d")},o.prototype.getImage=function(e){void 0===e&&(e=0);var i,n,o,r,s,a,h,l;i=n=Number.MIN_VALUE,o=r=Number.MAX_VALUE;for(var c=0,u=this.items;c<u.length;c++){var d=u[c];"relation"!==d.baseType&&(d.x<o&&(o=d.x),d.y<r&&(r=d.y),d.width+d.x>i&&(i=d.width+d.x),d.y+d.height>n&&(n=d.y+d.height))}s=i-o+10+2*e,a=n-r+10+2*e;var f=this.createHiDPICanvas(s,a,1),p=f.getContext("2d");p.fillStyle=t.Config.background,p.fillRect(0,0,s,a),l=r-e-5,h=o-e-5;for(var y=0;y<this.items.length;y++)"relation"!==this.items[y].baseType&&(this.items[y].x-=h,this.items[y].y-=l);for(var y=0;y<this.items.length;y++)p.save(),"relation"!==this.items[y].baseType?(this.items[y].render(p),this.items[y].x+=h,this.items[y].y+=l):this.items[y].render(p),p.restore();return f.toDataURL("image/png")},o.prototype.getElementByPosition=function(t,e){for(var i,n=this.items.length-1;n>=0;n--)if(i=this.items[n],i.checkCollision(t,e))return i;return null},o}();t.Canvas=l}(Loira||(Loira={}));var Loira;!function(t){var e=function(){function t(){}return t}();t.BaseController=e}(Loira||(Loira={}));var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Loira;!function(t){!function(t){function e(t){for(var e="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<t;n++)e+=i.charAt(Math.floor(Math.random()*i.length));return e}function i(t,e){var i=(t.y2-t.y1)*(e.x2-e.x1)-(t.x2-t.x1)*(e.y2-e.y1);if(0===i)return!1;var n=e.y1-t.y1,o=e.x1-t.x1;return n=((t.x2-t.x1)*n-(t.y2-t.y1)*o)/i,{x:e.x1+n*(e.x2-e.x1),y:e.y1+n*(e.y2-e.y1)}}function n(t){for(var e=t.split("."),i=window||this,n=0,o=e;n<o.length;n++){i=i[o[n]]}if("function"!=typeof i)throw new Error("function not found");return i}function o(t,e){t.sort(function(t,e){return t-e});for(var i=t.length-1;i>=0;i--)e.splice(t[i],1)}var r=function(){function t(){this.x=0,this.y=0,this.width=0,this.height=0,this.centerObject=!1,this.maxOutGoingRelation=0,this.extras={},this.text="",this.selectable=!0,this.resizable=!0,this.draggable=!0}return t}();t.BaseOption=r;var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(r);t.RelOption=s;var a=function(){function t(){}return t}();t.Line=a;var h=function(){function t(){}return t}();t.Region=h;var l=function(){function t(t,e){this.x=t,this.y=e}return t}();t.Point=l,t.createRandom=e,t.intersectPointLine=i,t.stringToFunction=n,t.removeWhole=o}(t.util||(t.util={}))}(Loira||(Loira={}));var Loira;!function(t){var e=t.util.BaseOption,i=function(){function i(i){this._uid=t.util.createRandom(8),void 0===i&&(i=new e),this.x="x"in i?i.x:0,this.y="y"in i?i.y:0,this.width="width"in i?i.width:0,this.height="height"in i?i.height:0,this.centerObject="centerObject"in i&&i.centerObject,this.maxOutGoingRelation="maxOutGoingRelation"in i?i.maxOutGoingRelation:0,this.extras="extras"in i?i.extras:{},this.text=i.text?i.text:"",this.selectable=!i.selectable||i.selectable,this.resizable=!i.resizable||i.resizable,this.draggable=!i.draggable||i.draggable,this._buttons=[],this._canvas=null,this.type="",this.baseType="",this.animation=new Animation(this)}return i.prototype.render=function(t){this.animation.proccess()},i.prototype.checkCollision=function(t,e){return t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height},i.prototype.on=function(t){t?(t=[].splice.call(arguments,0),this._buttons=t):this._buttons=[]},i.prototype.renderButtons=function(e){var i=this.x+this.width+10,n=this.y;this._buttons.length>0&&this._buttons.forEach(function(o){t.drawable.render(o.icon,e,i,n),n+=t.drawable.get(o.icon).height+4})},i.prototype.callCustomButton=function(e,i){for(var n,o=this.x+this.width+10,r=this.y,s=0,a=this._buttons;s<a.length;s++){var h=a[s];if(n=t.drawable.get(h.icon),o<=e&&e<=o+n.width&&r<=i&&i<=r+n.height)return h.click.call(this),!0;r+=h.icon.height+4}return!1},i.prototype.drawSelected=function(e){var i=this.x-2,n=this.y-2,o=this.width,r=this.height;e.beginPath(),e.lineWidth=2,e.setLineDash([5,5]),e.strokeStyle=t.Config.selected.color,e.rect(i,n,o+4,r+4),e.stroke(),e.setLineDash([]),this.resizable&&(e.fillStyle=t.Config.selected.color,e.fillRect(i-4,n-4,8,8),e.fillRect(i+o,n+r,8,8),e.fillRect(i+o,n-4,8,8),e.fillRect(i-4,n+r,8,8),e.fillRect(i+o/2,n-4,8,8),e.fillRect(i+o/2,n+r,8,8),e.fillRect(i-4,n+r/2,8,8),e.fillRect(i+o,n+r/2,8,8)),e.strokeStyle="#000000",e.fillStyle="#000000"},i.prototype.getSelectedCorner=function(t,e){var i=this.x-2,n=this.y-2,o=this.width,r=this.height,s=o/2,a=r/2;return i-4<=t&&t<=i+4&&n-4<=e&&e<=n+4?"tl":i+o<=t&&i+o+8>=t&&n-4<=e&&n+4>=e?"tr":i+o<=t&&i+o+8>=t&&n+r<=e&&n+r+8>=e?"br":i-4<=t&&i+4>=t&&n+r<=e&&n+r+8>=e?"bl":i+s<=t&&i+s+8>=t&&n-4<=e&&n+4>=e?"tc":i+s<=t&&i+s+8>=t&&n+r<=e&&n+r+8>=e?"bc":i-4<=t&&i+4>=t&&n+a<=e&&n+a+8>=e?"ml":i+o<=t&&i+o+8>=t&&n+a<=e&&n+a+8>=e?"mr":""},i.prototype.show=function(){this._canvas.centerToPoint(this.x+this.width/2,this.y+this.height/2)},i.prototype.attach=function(t){this._canvas=t,this.animation.setFps(t._config.fps)},i.prototype.animateTo=function(t,e){void 0===e&&(e=1);this._canvas._config.fps},i.prototype.destroy=function(){this._canvas=null},i}();t.Element=i}(Loira||(Loira={}));var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Common;!function(t){var e,i=Loira.util.Point;!function(t){t[t.STRAIGHT=1]="STRAIGHT",t[t.CURVE=2]="CURVE",t[t.CARTESIAN=3]="CARTESIAN"}(e=t.TypeLine||(t.TypeLine={}));var n=function(t){function n(n){var o=t.call(this,n)||this;return o.start=n.start?n.start:null,o.end=n.end?n.end:null,o.isDashed=!!n.isDashed&&n.isDashed,o.points=n.points?n.points:[new i,new i],o.icon=n.icon?n.icon:"",o.typeLine=n.typeLine?n.typeLine:e.STRAIGHT,o.baseType="relation",o}return __extends(n,t),n.prototype.render=function(t){var e,i,n,o,r,s=this.start,a=this.end;this.points[0]={x:s.x+s.width/2,y:s.y+s.height/2},this.points[this.points.length-1]={x:a.x+a.width/2,y:a.y+a.height/2},i=this.points[0],n=this.points[1],t.beginPath(),t.lineWidth=1,t.moveTo(i.x,i.y),this.isDashed&&t.setLineDash([5,5]);for(var h=1;h<this.points.length;h++)t.lineTo(this.points[h].x,this.points[h].y);if(t.stroke(),t.setLineDash([]),this.icon){i=this.points[this.points.length-2],n=this.points[this.points.length-1],o=n.x-i.x,r=n.y-i.y,e=Math.atan(r/o),o<0&&(e+=Math.PI),t.translate(n.x,n.y),t.rotate(e);var l=Loira.drawable.get(this.icon),c=a.obtainBorderPos(o,r,{x1:i.x,y1:i.y,x2:n.x,y2:n.y},t);Loira.drawable.render(this.icon,t,-(l.width+c),-Math.ceil(l.height/2)),t.rotate(-e),t.translate(-n.x,-n.y)}if(this.text||this.text.length>0){t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType;var u=Math.round(this.points.length/2);i=this.points[u-1],n=this.points[u],o=n.x-i.x,r=n.y-i.y,e=t.measureText(this.text).width,t.fillStyle=Loira.Config.background,t.fillRect(i.x+o/2-e/2,i.y+r/2-15,e,12),t.fillStyle="#000000",t.fillText(this.text,i.x+o/2-e/2,i.y+r/2-5),t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType}},n.prototype.recalculateBorders=function(){},n.prototype.update=function(t,e){return this.start=t,this.end=e,this},n.prototype.checkCollision=function(t,e){for(var i,n=null,o=null,r=0,s=0,a={x:0,y:0},h={x:0,y:0},l=1;l<this.points.length;l++)if(n=this.points[l-1],o=this.points[l],a.x=n.x,a.y=n.y,h.y=o.y,h.x=o.x,n.x>o.x&&(a.x=o.x,h.x=n.x),n.y>o.y&&(a.y=o.y,h.y=n.y),t>a.x-5&&t<h.x+5&&e>a.y-5&&e<h.y+5)if(s=Math.abs(o.y-n.y),r=Math.abs(o.x-n.x),t=Math.abs(t-n.x),e=Math.abs(e-n.y),r>s){if(0===(i=Math.abs(s/r*t))&&e>a.y&&e<h.y||i>e-8&&i<e+8)return!0}else if(0===(i=Math.abs(r/s*e))&&t>a.x&&t<h.x||i>t-8&&i<t+8)return!0;return!1},n.prototype.drawSelected=function(t){t.beginPath(),t.fillStyle=Loira.Config.selected.color;for(var e=0;e<this.points.length;e++)t.fillRect(this.points[e].x-4,this.points[e].y-4,8,8);t.strokeStyle="#000000"},n.prototype.addPoint=function(){var t=this.points[1],e=this.points[0],i=Math.round((t.x-e.x)/2)+e.x,n=Math.round((t.y-e.y)/2)+e.y;this.points.splice(1,0,{x:i,y:n})},n.prototype.getSelectedCorner=function(t,e){for(var i=1;i<this.points.length-1;i++){var n=this.points[i].x-4,o=this.points[i].y-4,r=n+8,s=o+8;if(t>n&&t<r&&e>o&&e<s)return i}return!1},n.prototype.movePoint=function(t,e,i){this.points[t].x+=e,this.points[t].y+=i},n}(Loira.Element);t.Relation=n;var o=function(t){function e(e){var i=t.call(this,e)||this,n=i._linkSymbol;return i.on({icon:"arrow",click:n}),i.baseType="symbol",i}return __extends(e,t),e.prototype._linkSymbol=function(){var t=this,e=this._canvas.on("mouse:down",function(i){var n=t._canvas,o=n.getRelationsFromObject(t,!1,!0).length;if(!t.maxOutGoingRelation||o<t.maxOutGoingRelation)for(var r=0,s=n.items;r<s.length;r++){var a=s[r];if("relation"!==a.baseType&&a.checkCollision(i.x,i.y)){var h=Loira.util.stringToFunction(n.defaultRelation);n.add(new h({}).update(t,a));break}}n.fall("mouse:down",e)})},e.prototype.splitText=function(t,e,i){void 0===i&&(i=10);for(var n=e.split(" "),o="",r=[],s=0;s<n.length;s++)t.measureText(o+n[s]).width>this.width-i?(r.push(o),o=n[s]+" "):o=o+" "+n[s];return r.push(o),r},e.prototype.drawText=function(t,e){var i,n,o=this.x+this.width/2,r=this.y+this.height/2;n=this.splitText(t,e),i=r+3-(6*n.length+3*n.length)/2;for(var s=0;s<n.length;s++){var a=t.measureText(n[s]).width;t.fillText(n[s],o-a/2,i+3),i=i+Loira.Config.fontSize+3}},e}(Loira.Element);t.Symbol=o;var r=function(t){function e(e){var i=t.call(this,e)||this;return i.text=e.text?e.text:"Actor1",i.width=30,i.height=85,i.type="actor",i}return __extends(e,t),e.prototype.obtainBorderPos=function(t,e,i,n){n.font=Loira.Config.fontSize+"px "+Loira.Config.fontType;var o=n.measureText(this.text).width;o>this.width&&(this.x=this.x+this.width/2-o/2,this.width=o);var r=Math.atan(e/t);t<0&&(r+=Math.PI);var s=null;return s=r>-.8&&r<.68||r>2.46&&r<4?Loira.util.intersectPointLine(i,{x1:this.x,y1:-100,x2:this.x,y2:100}):Loira.util.intersectPointLine(i,{x1:-100,y1:this.y,x2:100,y2:this.y}),Math.sqrt(Math.pow(s.x-(this.x+this.width/2),2)+Math.pow(s.y-(this.y+this.height/2),2))},e.prototype.render=function(t){var e=t.measureText(this.text).width;e>this.width&&(this.x=this.x+this.width/2-e/2,this.width=e),t.fillStyle=Loira.Config.background,t.fillRect(this.x,this.y,this.width,this.height),t.fillStyle="#000000",Loira.drawable.render("actor",t,this.x+this.width/2-15,this.y),t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType,t.fillStyle="#000000",t.fillText(this.text,this.x,this.y+80)},e.prototype.recalculateBorders=function(){},e}(t.Symbol);t.Actor=r}(Common||(Common={}));var Loira;!function(t){var e={color:"#339966"},i={actor:{x:0,y:98,width:35,height:72},spear:{x:0,y:0,width:15,height:14},spear1:{x:0,y:31,width:27,height:28},spear2:{x:34,y:0,width:25,height:26},arrow:{x:27,y:26,width:12,height:16}};!function(t){t.fontSize=12,t.fontType="Arial",t.selected=e,t.background="#aacccc",t.assetsPath="../assets/glyphs.png",t.regions=i}(t.Config||(t.Config={}))}(Loira||(Loira={}));var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Relation;!function(t){var e=function(t){function e(e){var i=t.call(this,e)||this;return i.type="association",i}return __extends(e,t),e}(Common.Relation);t.Association=e;var i=function(t){function e(e){var i=this;return e.icon="spear",i=t.call(this,e)||this,i.type="direct_association",i}return __extends(e,t),e}(Common.Relation);t.DirectAssociation=i;var n=function(t){function e(e){var i=this;return e.icon="spear2",i=t.call(this,e)||this,i.type="generalization",i}return __extends(e,t),e}(Common.Relation);t.Generalization=n;var o=function(t){function e(e){var i=this;return e.icon="spear2",e.isDashed=!0,i=t.call(this,e)||this,i.type="realization",i}return __extends(e,t),e}(Common.Relation);t.Realization=o;var r=function(t){function e(e){var i=this;return e.icon="spear1",e.isDashed=!0,i=t.call(this,e)||this,i.type="dependency",i}return __extends(e,t),e}(Common.Relation);t.Dependency=r}(Relation||(Relation={})),Loira.XmiParser={load:function(t,e){var i,n,o=null;if(window.DOMParser){o=(new DOMParser).parseFromString(t,"text/xml")}else o=new ActiveXObject("Microsoft.XMLDOM"),o.async=!1,o.loadXML(t);var r=this._parse(o),s={};for(n in r.symbols)r.symbols.hasOwnProperty(n)&&(i=r.symbols[n],"UML:UseCase"===i.type?s[i.id]=new UseCase.UseCase({text:i.name}):"UML:Actor"===i.type&&(s[i.id]=new Common.Actor({text:i.name})),e.add(s[i.id]));for(n in r.relations)if(r.relations.hasOwnProperty(n)&&(i=r.relations[n],"UML:Association"===i.type)){for(var a={},h=0;h<i.connection.length;h++)"source"===i.connection[h].taggedValues.ea_end?a.start=s[i.connection[h].type]:"target"===i.connection[h].taggedValues.ea_end&&(a.end=s[i.connection[h].type]);e.addRelation(new Relation.Association(a))}setTimeout(function(){e.renderAll()},50)},_parse:function(t){var e=this._xmlToJson(t),i=e.XMI["XMI.content"]["UML:Model"]["UML:Namespace.ownedElement"]["UML:Package"]["UML:Namespace.ownedElement"],n={},o={};for(var r in i)if(i.hasOwnProperty(r)&&"string"!=typeof i[r]){var s=i[r]["@attributes"]["xmi.id"];if(void 0!==i[r]["UML:Association.connection"]){o[s]={isAbstract:"true"===i[r]["@attributes"].isAbstract,isLeaf:"true"===i[r]["@attributes"].isLeaf,isRoot:"true"===i[r]["@attributes"].isRoot,visibility:i[r]["@attributes"].visibility,id:i[r]["@attributes"]["xmi.id"],type:r,connection:[]};for(var a=0;a<i[r]["UML:Association.connection"]["UML:AssociationEnd"].length;a++){for(var h=i[r]["UML:Association.connection"]["UML:AssociationEnd"][a],l={aggregation:h["@attributes"].aggregation,changeable:h["@attributes"].changeable,isNavigable:"true"===h["@attributes"].isNavigable,isOrdered:"true"===h["@attributes"].isOrdered,targetScope:h["@attributes"].targetScope,type:h["@attributes"].type,visibility:h["@attributes"].visibility,taggedValues:{}},c=0;c<h["UML:ModelElement.taggedValue"]["UML:TaggedValue"].length;c++){var u=h["UML:ModelElement.taggedValue"]["UML:TaggedValue"][c]["@attributes"];l.taggedValues[u.tag]=u.value}o[s].connection.push(l)}}else n[s]={isAbstract:"true"===i[r]["@attributes"].isAbstract,isLeaf:"true"===i[r]["@attributes"].isLeaf,isRoot:"true"===i[r]["@attributes"].isRoot,name:i[r]["@attributes"].name,namespace:i[r]["@attributes"].namespace,visibility:i[r]["@attributes"].visibility,id:i[r]["@attributes"]["xmi.id"],type:r}}return{symbols:n,relations:o}},_xmlToJson:function(t){var e={};if(1===t.nodeType){if(t.attributes.length>0){e["@attributes"]={};for(var i=0;i<t.attributes.length;i++){var n=t.attributes.item(i);e["@attributes"][n.nodeName]=n.nodeValue}}}else 3===t.nodeType&&(e=t.nodeValue);if(t.hasChildNodes())for(var o=0;o<t.childNodes.length;o++){var r=t.childNodes.item(o),s=r.nodeName;if(void 0===e[s])e[s]=this._xmlToJson(r);else{if(void 0===e[s].push){var a=e[s];e[s]=[],e[s].push(a)}e[s].push(this._xmlToJson(r))}}return e}};var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),UseCase;!function(t){var e=function(t){function e(e){var i=t.call(this,e)||this;return i.width=100,i.height=70,i.text=e.text,i.type="use_case",i}return __extends(e,t),e.prototype.obtainBorderPos=function(t,e,i,n){var o=this.width/2,r=this.height/2,s=o*r/Math.sqrt(o*o*e*e+r*r*t*t);return Math.sqrt(Math.pow(s*e,2)+Math.pow(s*t,2))},e.prototype.render=function(t){if(t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType,this.text){var e=this.width/2*.5522848,i=this.height/2*.5522848,n=this.x+this.width,o=this.y+this.height,r=this.x+this.width/2,s=this.y+this.height/2;t.beginPath(),t.lineWidth=2,t.moveTo(this.x,s),t.bezierCurveTo(this.x,s-i,r-e,this.y,r,this.y),t.bezierCurveTo(r+e,this.y,n,s-i,n,s),t.bezierCurveTo(n,s+i,r+e,o,r,o),t.bezierCurveTo(r-e,o,this.x,s+i,this.x,s),t.stroke(),t.fillStyle="#fcf5d9",t.fill(),t.fillStyle="#000000",this.drawText(t,this.text)}},e.prototype.recalculateBorders=function(){},e}(Common.Symbol);t.UseCase=e;var i=function(t){function e(e){var i=this;return e.icon="spear1",e.text="<< extends >>",e.isDashed=!0,i=t.call(this,e)||this,i.type="extends",i}return __extends(e,t),e}(Common.Relation);t.Extends=i;var n=function(t){function e(e){var i=this;return e.icon="spear1",e.text="<< include >>",e.isDashed=!0,i=t.call(this,e)||this,i.type="include",i}return __extends(e,t),e}(Common.Relation);t.Include=n}(UseCase||(UseCase={}));var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Box;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(Loira.util.BaseOption);t.ColorOption=e;var i=function(t){function e(e){var i=t.call(this,e)||this;return i.width="width"in e?e.width:30,i.height="height"in e?e.height:30,i.color="color"in e?e.color:"rgba(0,0,0,0.3)",i.baseType="box",i}return __extends(e,t),e.prototype.render=function(t){t.fillStyle=this.color,t.fillRect(this.x,this.y,this.width,this.height),
t.fillText(this.text,this.x,this.y-10)},e.prototype.recalculateBorders=function(){},e}(Loira.Element);t.Box=i}(Box||(Box={}));var Animation=function(){function t(t){this._registers=[],this._element=t}return t.prototype.moveTo=function(t,e,i){void 0===i&&(i=1);this._fps;this._isRunning=!0},t.prototype.setFps=function(t){this._fps=t},t.prototype.proccess=function(){this._isRunning&&0==this._registers.length&&(this._isRunning=!1)},t}(),__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Workflow;!function(t){var e=Loira.util.BaseOption,i=Loira.util.Point,n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(e);t.WorkflowOption=n;var o=function(t){function e(e){var i=t.call(this,e)||this;return i.startPoint=!!e.startPoint&&e.startPoint,i.endPoint=!!e.endPoint&&e.endPoint,i}return __extends(e,t),e.prototype._linkSymbol=function(){var t=this,e=this._canvas.on("mouse:down",function(n){var o=t._canvas;if(!t.maxOutGoingRelation||o.getRelationsFromObject(t,!1,!0).length<t.maxOutGoingRelation)for(var r=0,s=o.items;r<s.length;r++){var a=s[r];if("relation"!==a.baseType&&!a.startPoint&&a.checkCollision(n.x,n.y)&&!t.endPoint){var h=Loira.util.stringToFunction(o.defaultRelation),l=null;if(t._uid==a._uid){var c=t.x+t.width+30,u=t.y+t.height/2;l=[],l.push(new i),l.push(new i(c,u)),l.push(new i(c,t.y-30)),l.push(new i(t.x+t.width/2,t.y-30)),l.push(new i)}o.add(new h({points:l}).update(t,a));break}}o.fall("mouse:down",e)})},e}(Common.Symbol);t.Symbol=o;var r=function(t){function e(e){var i=this;return e.width=e.width?e.width:100,e.height=e.height?e.height:70,i=t.call(this,e)||this,i.text=e.text,i.type="process",i.borders={bottomLeft:0,topLeft:0,topRight:0,bottomRight:0},i.recalculateBorders(),i.maxOutGoingRelation=1,i}return __extends(e,t),e.prototype.obtainBorderPos=function(t,e,i,n){var o=Math.atan(e/t);t<0&&(o+=Math.PI);var r={x:100,y:this.y-10};r=o>this.borders.bottomLeft&&o<this.borders.topLeft||o>this.borders.topRight&&o<this.borders.bottomRight?Loira.util.intersectPointLine(i,{x1:this.x,y1:-100,x2:this.x,y2:100}):Loira.util.intersectPointLine(i,{x1:-100,y1:this.y,x2:100,y2:this.y});var s=r.x-(this.x+this.width/2),a=r.y-(this.y+this.height/2);return Math.sqrt(Math.pow(s,2)+Math.pow(a,2))},e.prototype.render=function(t){t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType,t.beginPath(),t.lineWidth=2,t.rect(this.x,this.y,this.width,this.height),t.stroke(),t.fillStyle="#fcf5d9",t.fill(),t.fillStyle="#000000",this.drawText(t,this.text)},e.prototype.recalculateBorders=function(){var t=Math.round(this.width/2),e=Math.round(this.height/2);this.borders.bottomLeft=Math.atan(-e/t),this.borders.topLeft=Math.atan(e/t),this.borders.topRight=Math.atan(e/-t)+Math.PI,this.borders.bottomRight=Math.atan(-e/-t)+Math.PI},e}(o);t.Process=r;var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.obtainBorderPos=function(t,e,i,n){var o=this.width/2,r=this.height/2,s=o*r/Math.sqrt(o*o*e*e+r*r*t*t);return Math.sqrt(Math.pow(s*e,2)+Math.pow(s*t,2))},e.prototype.render=function(t){t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType;var e=this.x+20,i=this.y,n=this.x+this.width-20,o=this.y+this.height;t.beginPath(),t.lineWidth=2,t.moveTo(e,i),t.lineTo(n,i),t.bezierCurveTo(n+30,i,n+30,o,n,o),t.lineTo(e,o),t.bezierCurveTo(e-30,o,e-30,i,e,i),t.stroke(),t.fillStyle="#fcf5d9",t.fill(),t.fillStyle="#000000",this.drawText(t,this.text)},e.prototype.recalculateBorders=function(){},e}(o);t.Terminator=s;var a=function(t){function e(e){var i=this;return e.width=e.width?e.width:100,e.height=e.height?e.height:70,i=t.call(this,e)||this,i.text="INICIO",i.startPoint=!0,i.maxOutGoingRelation=1,i.type="start_terminator",i}return __extends(e,t),e}(s);t.StartTerminator=a;var h=function(t){function e(e){var i=t.call(this,e)||this;return i.width=70,i.height=30,i.text="FIN",i.endPoint=!0,i.type="end_terminator",i}return __extends(e,t),e}(s);t.EndTerminator=h;var l=function(t){function e(e){var i=this;return e.width=e.width?e.width:100,e.height=e.height?e.height:70,i=t.call(this,e)||this,i.text=e.text,i.type="data",i}return __extends(e,t),e.prototype.obtainBorderPos=function(t,e,i,n){var o=this.width/2,r=this.height/2,s=o*r/Math.sqrt(o*o*e*e+r*r*t*t);return Math.sqrt(Math.pow(s*e,2)+Math.pow(s*t,2))},e.prototype.render=function(t){t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType;var e=this.x+20,i=this.y,n=this.x+this.width,o=this.y+this.height;t.beginPath(),t.lineWidth=2,t.moveTo(e,i),t.lineTo(n,i),t.lineTo(n-20,o),t.lineTo(e-20,o),t.lineTo(e,i),t.stroke(),t.fillStyle="#fcf5d9",t.fill(),t.fillStyle="#000000",this.drawText(t,this.text)},e.prototype.recalculateBorders=function(){},e}(o);t.Data=l;var c=function(t){function e(e){var i=this;return e.width=e.width?e.width:100,e.height=e.height?e.height:70,i=t.call(this,e)||this,i.text=e.text,i.type="decision",i}return __extends(e,t),e.prototype.obtainBorderPos=function(t,e,i,n){var o,r=this.x,s=this.y,a=this.x+this.width/2,h=this.y+this.height/2,l=this.x+this.width,c=Math.atan(h/t);return t<0&&(c+=Math.PI),o=c>0&&c<1.6||c>3.15&&c<4.7?Loira.util.intersectPointLine(i,{x1:r,y1:h,x2:a,y2:s}):Loira.util.intersectPointLine(i,{x1:a,y1:s,x2:l,y2:h}),r=o.x-(this.x+this.width/2),s=o.y-(this.y+this.height/2),Math.sqrt(Math.pow(r,2)+Math.pow(s,2))},e.prototype.render=function(t){t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType;var e=this.x,i=this.y,n=this.x+this.width/2,o=this.y+this.height/2,r=this.x+this.width,s=this.y+this.height;t.beginPath(),t.lineWidth=2,t.moveTo(n,i),t.lineTo(r,o),t.lineTo(n,s),t.lineTo(e,o),t.lineTo(n,i),t.stroke(),t.fillStyle="#fcf5d9",t.fill(),t.fillStyle="#000000",this.drawText(t,this.text)},e.prototype.recalculateBorders=function(){},e}(o);t.Decision=c}(Workflow||(Workflow={}));var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),OrgChart;!function(t){var e,i=Loira.BaseController,n=Loira.util.RelOption,o=["#124FFD","#FF4FFD","#12003D"],r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(Loira.util.BaseOption);t.RoleOption=r;var s=function(){function t(t){this.children=[],this.role=t,this.height=40}return t.prototype.recalculate=function(t){void 0===t&&(t=0),this.width=0,this.level=t;var i=t+1;e.length<=t&&e.push(this.role.height);for(var n=0;n<this.children.length;n++){var r=this.children[n];r.x=this.x+this.width,r.recalculate(i),this.width+=r.width}0===this.width&&(this.width=this.role.width+10),this.role.x=Math.floor(this.width/2-this.role.width/2)+this.x,this.role.isDuplicate||(this.role.color=o[t]),this.role.level=t,e[t]<this.role.height&&(e[t]=this.role.height)},t.prototype.getAllChildren=function(){var t=[];if(this.children.length>0)for(var e=0;e<this.children.length;e++){var i=this.children[e].getAllChildren();t.push(this.children[e]);for(var n=0;n<i.length;n++)t.push(i[n])}return t},t.prototype.getAllParent=function(){for(var t=[],e=this;e.parent;)t.push(e.parent),e=e.parent;return t},t}();t.Group=s;var a=function(t){function i(e,i){void 0===e&&(e=null),void 0===i&&(i=!0);var n=t.call(this)||this;return n.roots=[],n.elements=[],e&&(o=e),n.autoRefresh=i,n}return __extends(i,t),i.prototype.bind=function(t){var e=this;this.canvas=t,t.defaultRelation="OrgChart.Relation",t.on("object:added",function(t){var i=new s(t.selected);e.roots.push(i),e.elements.push(i),e.autoRefresh&&e.reorderElements()}),t.on("object:selected",function(e){var i=e.selected;i.isDuplicate&&(t.centerToPoint(i.rolePrimary.x,i.rolePrimary.y),t.setSelectedElement(i.rolePrimary),setTimeout(function(){t.trigger("object:selected",i.rolePrimary)},300))}),t.on("relation:added",function(i){var n=e.getGroup(i.selected.end,e.roots).index,o=e.getGroup(i.selected.end,e.elements).item,r=e.getGroup(i.selected.start,e.elements).item,s=o.getAllChildren();s.push(o);for(var a=0;a<s.length;a++)if(s[a].role.id===r.role.id)return void t.remove([i.selected],!1);if(n>=0)e.roots.splice(n,1);else{var h=o.parent.children;n=e.getGroup(o.role,h).index,h.splice(n,1);for(var l=t.getRelationsFromObject(i.selected.end,!0,!1),c=[],u=0,d=l;u<d.length;u++){var f=d[u];f.start!=r.role&&c.push(f)}c.length>0&&t.remove(c,!1)}o.parent=r,r.children.push(o),e.autoRefresh&&(e.reorderElements(),t.renderAll(!0))}),t.on("object:removed",function(i){var n,o,r;if("relation"===i.selected.baseType)n=i.selected,o=e.getGroup(n.end,e.elements).item;else{r=e.getGroup(i.selected,e.elements).index,o=e.elements[r],e.elements.splice(r,1);for(var s=o.getAllChildren(),a=[],h=[],l=0;l<s.length;l++)h.push(e.elements.indexOf(s[l])),a.push(s[l].role);Loira.util.removeWhole(h,e.elements),t.remove(a,!1)}o.parent?(r=e.getGroup(o.role,o.parent.children).index,o.parent.children.splice(r,1)):(r=e.getGroup(o.role,e.roots).index,e.roots.splice(r,1)),n&&(o.parent=null,e.roots.push(o)),e.autoRefresh&&e.reorderElements()})},i.prototype.load=function(t){var e,i,o,a=[],c=[],u=this.canvas.readOnly;this.canvas.readOnly=!1;for(var d=0,f=t;d<f.length;d++){var p=f[d];if(e=new r,e.id=p.id?p.id.toString():"",e.personName=p.personName?p.personName.toString():null,e.title=p.title?p.title.toString():null,this.getGroupById(e.id).item&&(e.isDuplicate=!0),i=new s(new h(e)),p.parent){var y=this.getGroupById(p.parent?p.parent.toString():"").item;y.children.push(i),i.parent=y,o=new n,o.start=y.role,o.end=i.role,c.push(new l(o))}else this.roots.push(i);this.elements.push(i),a.push(i.role)}this.canvas.add(a,!1),this.canvas.add(c,!1),this.canvas.readOnly=u},i.prototype.exportData=function(){for(var t=[],e=0,i=this.elements;e<i.length;e++){var n=i[e],o=n.parent;t.push({id:n.role.id,level:n.role.level,parent:o?o.role.id:null})}return t},i.prototype.reorderElements=function(){var t=0;e=[];for(var i=0,n=this.roots;i<n.length;i++){var o=n[i];o.x=t,o.recalculate(),t+=o.width}e[0]+=30;for(var r=1;r<e.length;r++)e[r]+=e[r-1]+30;for(var r=0;r<this.elements.length;r++){var s=this.elements[r];s.role.y=0===s.level?10:e[s.level-1]}},i.prototype.getGroup=function(t,e){e||(e=this.elements);for(var i=0;i<e.length;i++)if(e[i].role==t)return{item:e[i],index:i};return{item:null,index:-1}},i.prototype.getGroupById=function(t,e){e||(e=this.elements),t=t.trim();for(var i=0;i<e.length;i++)if(""!==t&&e[i].role.id==t)return{item:e[i],index:i};return{item:null,index:-1}},i}(i);t.Controller=a;var h=function(t){function e(e){var i=t.call(this,e)||this;return i.width=150,i.height=20,i.parent=e.parent,i.title=e.title,i.resizable=!1,i.draggable=!1,i.id=e.id,i.personName=e.personName?e.personName:"",i.isDuplicate=!!e.isDuplicate&&e.isDuplicate,i.type="role",i}return __extends(e,t),e.prototype.render=function(e){t.prototype.render.call(this,e);var i,n,o,r=this.x+this.width/2,s=0;this.personName&&(n={fontSize:Loira.Config.fontSize,lines:t.prototype.splitText.call(this,e,this.personName)},s=(n.fontSize+3)*n.lines.length+5),this.title&&(o={fontSize:Loira.Config.fontSize-(n?3:0),lines:t.prototype.splitText.call(this,e,this.title)},s+=(o.fontSize+3)*o.lines.length+5),i=this.y+Loira.Config.fontSize,this.height=s;if(e.fillStyle=this.isDuplicate?"#000000":this.color,e.lineWidth=4,e.shadowBlur=10,this.isSelected?(e.shadowColor="#00c0ff",e.strokeStyle="#00c0ff",e.shadowBlur=20,this.isSelected=!1):(e.shadowColor="#000000",e.strokeStyle="#000000"),Loira.shape.drawRoundRect(e,this.x,this.y,this.width,this.height,5),e.fillStyle="#FFFFFF",e.font=Loira.Config.fontSize+"px "+Loira.Config.fontType,n){for(var a=0;a<n.lines.length;a++){var h=e.measureText(n.lines[a]).width;e.fillText(n.lines[a],r-h/2,i+3),i=i+o.fontSize+3}i+=5,e.font="bold "+o.fontSize+"px "+Loira.Config.fontType}if(o)for(var a=0;a<o.lines.length;a++){var h=e.measureText(o.lines[a]).width;e.fillText(o.lines[a],r-h/2,i+3),i=i+o.fontSize+3}},e.prototype.recalculateBorders=function(){},e.prototype.obtainBorderPos=function(t,e,i,n){return 0},e.prototype.drawSelected=function(t){this.isSelected=!0,this.render(t)},e.prototype.attach=function(e){t.prototype.attach.call(this,e);var i=e.getContext(),n=0;this.personName&&(n+=(Loira.Config.fontSize+3)*t.prototype.splitText.call(this,i,this.personName).length+5),this.title&&(n+=(Loira.Config.fontSize+3-(this.personName?3:0))*t.prototype.splitText.call(this,i,this.title).length+5),this.height=n,this.isDuplicate&&this.setDuplicate()},e.prototype.setDuplicate=function(){for(var t=this._canvas.controller.elements,e=this._canvas.controller.getGroup(this).item,i=e.getAllParent(),n=!0,o=0;o<i.length;o++)if(this.id&&i[o].role.id===this.id){this.title=" ",this.id="",n=!1;break}if(n)for(var o=0;o<t.length;o++)if(t[o].role!==this&&t[o].role.id==this.id.trim()&&!t[o].role.isDuplicate){this.isDuplicate=!0,this.on(null),this.rolePrimary=t[o].role;break}},e.prototype.update=function(t){this.title=t.title,this.id=t.id.trim(),this.setDuplicate()},e}(Common.Symbol);t.Role=h;var l=function(t){function e(e){var i=t.call(this,e)||this;return i.type="orgchart:relation",i}return __extends(e,t),e.prototype.render=function(t){var e,i,n=this.start,o=this.end;e=o.y-10,i={x:n.x+n.width/2,y:n.y+n.height/2},this.points[0]=i,this.points[1]={x:i.x,y:e},this.points[2]={x:o.x+o.width/2,y:e},this.points[3]={x:o.x+o.width/2,y:o.y+o.height/2},t.beginPath(),t.lineWidth=4,t.strokeStyle="rgba(255,255,255,0.5)",t.moveTo(i.x,i.y),t.lineJoin="round";for(var r=1;r<this.points.length;r++)t.lineTo(this.points[r].x,this.points[r].y);t.stroke()},e}(Common.Relation);t.Relation=l}(OrgChart||(OrgChart={}));