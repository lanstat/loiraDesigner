var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Loira;!function(t){!function(t){var e=function(){function t(){}return t}();t.Event=e;var i=function(t){function e(e,i){var n=t.call(this)||this;return n.x=e,n.y=i,n}return __extends(e,t),e}(e);t.MouseEvent=i;var n=function(t){function e(e){var i=t.call(this)||this;return i.selected=e,i}return __extends(e,t),e}(e);t.ObjectEvent=n;var o=function(t){function e(e){var i=t.call(this)||this;return i.selected=e,i}return __extends(e,t),e}(e);t.RelationEvent=o}(t.event||(t.event={}))}(Loira||(Loira={}));var Loira;!function(t){!function(t){function e(t,e,i){this.image=new Image,this.image.src=t,this.image.onload=function(){i()},this.regions=e}function i(t,e,i,n){var o=this.regions[t];e.drawImage(this.image,o.x,o.y,o.width,o.height,i,n,o.width,o.height)}function n(t){return this.regions[t]}t.registerMap=e,t.render=i,t.get=n}(t.drawable||(t.drawable={}))}(Loira||(Loira={}));var Loira;!function(t){!function(t){function e(t,e,i,n,o,r){t.beginPath(),t.moveTo(e+r,i),t.lineTo(e+n-r,i),t.quadraticCurveTo(e+n,i,e+n,i+r),t.lineTo(e+n,i+o-r),t.quadraticCurveTo(e+n,i+o,e+n-r,i+o),t.lineTo(e+r,i+o),t.quadraticCurveTo(e,i+o,e,i+o-r),t.lineTo(e,i+r),t.quadraticCurveTo(e,i,e+r,i),t.closePath(),t.stroke(),t.fill()}function i(t,e,i){}!function(t){t[t.LEFT=0]="LEFT",t[t.CENTER=1]="CENTER",t[t.RIGHT=2]="RIGHT"}(t.HorizontalAlign||(t.HorizontalAlign={}));!function(t){t[t.TOP=0]="TOP",t[t.MIDDLE=1]="MIDDLE",t[t.BOTTOM=2]="BOTTOM"}(t.VerticalAlign||(t.VerticalAlign={})),t.drawRoundRect=e,t.drawText=i}(t.shape||(t.shape={}))}(Loira||(Loira={}));var Loira;!function(t){function e(){var e;return e=/firefox/i.test(navigator.userAgent)?a.FIREFOX:a.UNKNOWN,t.util.logger(t.LogLevel.SYSTEM,navigator.userAgent),e}var i=t.event.RelationEvent,n=t.event.ObjectEvent,o=t.event.MouseEvent,r=function(){function t(){this.x=0,this.y=0,this.width=0,this.height=0,this.viewportWidth=0,this.viewportHeight=0,this.area=0}return t}();t.VirtualCanvas=r;var s=function(){function t(){this.width=0,this.height=0,this.viewportWidth=0,this.viewportHeight=0,this.dragCanvas=!1,this.controller=null,this.readOnly=!1}return t}();t.CanvasConfig=s;var a;!function(t){t[t.FIREFOX=1]="FIREFOX",t[t.IE=2]="IE",t[t.CHROME=3]="CHROME",t[t.UNKNOWN=4]="UNKNOWN"}(a=t.UserAgent||(t.UserAgent={}));var h=function(){function t(t){void 0===t&&(t=32),this._fps=1e3/t,this._elapsed=(new Date).getTime()}return t.prototype.passed=function(){var t=!1,e=(new Date).getTime();return e>=this._elapsed&&(this._elapsed=e+this._fps,t=!0),t},t}(),l=function(){function t(){}return t}(),c=function(){function t(t){this._canvas=t,this._scale=1,this.update(1)}return t.prototype.update=function(t){this._scale+=t/Math.abs(t),this._scale<9&&this._scale>0&&(this.scrollX=Math.floor(this._canvas.width/20),this.scrollY=Math.floor(this._canvas.height/20))},t}(),u=function(){function r(i,n){this._selected=null,this._isDragged=!1,this._tmp=new l,this.items=[],this._canvas=null,this._background=null,this.virtualCanvas=null,this.defaultRelation=null,this.container=null,this.readOnly=!1,this.container="string"==typeof i?document.getElementById(i):i,n||(n=new s,n.width=this.container.parentElement.offsetWidth,n.height=this.container.parentElement.offsetHeight),n.viewportWidth=n.viewportWidth||this.container.offsetWidth||this.container.parentElement.offsetWidth||n.width,n.viewportHeight=n.viewportHeight||this.container.offsetHeight||this.container.parentElement.offsetHeight||n.height,this.readOnly=n.readOnly||!1,this._tmp.pointer={x:0,y:0},this._callbacks={},this.items=[],this.width=n.width,this.height=n.height,this.viewportHeight=n.viewportHeight,this.viewportWidth=n.viewportWidth,this.dragCanvas=n.dragCanvas,this.fps=n.fps,this.defaultRelation="Relation.Association",this.refreshScreen();var o=this;t.drawable.registerMap(t.Config.assetsPath,t.Config.regions,function(){o.renderAll()}),this._fps=new h(n.fps),this._zoom=new c(this),this.controller=n.controller||null,this.controller&&this.controller.bind(this),this.userAgent=e(),this.bindResizeWindow()}return r.prototype.refreshScreen=function(){this.destroy(),this.container.style.width=this.container.style.maxWidth=this.viewportWidth+"px",this.container.style.height=this.container.style.maxHeight=this.viewportHeight+"px",this.container.style.position="relative",this.container.style.overflow="hidden",this._canvas=this.createHiDPICanvas(this.viewportWidth,this.viewportHeight),this._canvas.style.position="absolute",this._canvas.style.left="0",this._canvas.style.top="0",this._canvas.style.zIndex="100",this._canvas.style.backgroundColor=t.Config.background,this._canvas.tabIndex=99,this.container.appendChild(this._canvas),this.virtualCanvas={x:0,y:0,viewportWidth:this.viewportWidth,viewportHeight:this.viewportHeight,width:this.width,height:this.height,area:this.viewportHeight*this.viewportWidth},document.defaultView&&document.defaultView.getComputedStyle&&(this._border={paddingLeft:parseInt(document.defaultView.getComputedStyle(this._canvas,null).paddingLeft,10)||0,paddingTop:parseInt(document.defaultView.getComputedStyle(this._canvas,null).paddingTop,10)||0,borderLeft:parseInt(document.defaultView.getComputedStyle(this._canvas,null).borderLeftWidth,10)||0,borderTop:parseInt(document.defaultView.getComputedStyle(this._canvas,null).borderTopWidth,10)||0}),this._bind();var e=this;this._scrollBar=new Common.ScrollBar(this),setTimeout(function(){e.renderAll(!0)},200)},r.prototype.createHiDPICanvas=function(t,e,i){var n=function(){var t=document.createElement("canvas").getContext("2d");return(window.devicePixelRatio||1)/(t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1)}();i||(i=n);var o=document.createElement("canvas");return o.width=t*i,o.height=e*i,o.style.width=t+"px",o.style.height=e+"px",o.getContext("2d").setTransform(i,0,0,i,0,0),o},r.prototype.renderAll=function(e){if(void 0===e&&(e=!1),t.util.logger(t.LogLevel.INFO,"Draw"),this._fps.passed()||e){var i=this._canvas.getContext("2d");i.clearRect(0,0,this._canvas.width,this._canvas.height);for(var n=0;n<this.items.length;n++)this.items[n].isVisible(this.virtualCanvas)&&(i.save(),this.items[n].render(i,this.virtualCanvas.x,this.virtualCanvas.y),i.restore());this._selected&&this._selected.selectable&&(t.util.logger(t.LogLevel.INFO,"Selected"),i.save(),this._selected.drawSelected(i),i.restore(),this._selected.renderButtons(i,this.virtualCanvas.x,this.virtualCanvas.y)),this._scrollBar.render(i)}},r.prototype.add=function(t,e){if(void 0===e&&(e=!0),!this.readOnly){var o,r,s=this.items,a=this;r="[object Array]"!==Object.prototype.toString.call(t)?[t]:t;for(var h=0,l=r;h<l.length;h++){var c=l[h];if(c.attach(a),"relation"===c.baseType){if(o=c,!a.emit("relation:pre-add",new i(o)))return;var u=s.indexOf(o.start);u=u<s.indexOf(o.end)?u:s.indexOf(o.end),s.splice(u,0,c),a.emit("relation:added",new i(o),e)}else"container"===c.baseType?(s.splice(0,0,c),a.emit("container:added",new n(c),e)):(c.centerObject&&(c.x=a.virtualCanvas.viewportWidth/2+a.virtualCanvas.x-c.width/2,c.y=a.virtualCanvas.viewportHeight/2+a.virtualCanvas.y-c.height/2),s.push(c),a.emit("object:added",new n(c),e))}}},r.prototype.remove=function(t,e){void 0===e&&(e=!0);for(var i=this.items,o=this,r=0,s=t;r<s.length;r++){var a=s[r],h=[];a==this._selected&&(this._selected=null),h.push(i.indexOf(a));for(var l=0;l<i.length;l++)if("relation"===i[l].baseType){var c=i[l];c.start._uid!==a._uid&&c.end._uid!==a._uid||(c.destroy(),h.push(l))}h.sort(function(t,e){return t-e});for(var l=h.length-1;l>=0;l--)i.splice(h[l],1);o.emit("object:removed",new n(a),e)}this.renderAll(!0),this._selected=null},r.prototype.removeAll=function(){for(var t=0;t<this.items.length;t++)this.items[t].destroy();this.items=[],this._selected=null},r.prototype.destroy=function(){for(this._canvas&&(this._canvas.onmousemove=null,this._canvas.onkeydown=null,this._canvas.onmousedown=null,this._canvas.onmouseup=null,this._canvas.ondblclick=null,this._canvas.onselectstart=null),document.createElement("ul").remove(),this._canvas=null;this.container.firstChild;)this.container.removeChild(this.container.firstChild)},r.prototype.on=function(t,e){var i;if("string"==typeof t)return void 0===this._callbacks[t]&&(this._callbacks[t]=[]),this._callbacks[t].push(e),e;if("object"==typeof t)for(i in t)t.hasOwnProperty(i)&&(void 0===this._callbacks[i]&&(this._callbacks[i]=[]),this._callbacks[i].push(t[i]));return null},r.prototype.fall=function(t,e){var i=this._callbacks[t].indexOf(e);i>-1&&this._callbacks[t].splice(i,1)},r.prototype._bind=function(){var e=this,i=document.createElement("ul");i.id="loira-context-menu",i.oncontextmenu=function(){return!1},document.getElementsByTagName("body")[0].appendChild(i);var r=function(t,i){18!=t.keyCode&&(e._tmp.lastKey=t.keyCode,i||46===e._tmp.lastKey&&e._selected&&e.remove([e._selected]))};e._canvas.onkeydown=function(t){e.readOnly||r(t,!1)},document.addEventListener("keydown",function(t){e.readOnly||r(t,!0)}),e._canvas.onkeyup=function(){e.readOnly||(e._tmp.lastKey=null)},document.addEventListener("keyup",function(){e.readOnly||(e._tmp.lastKey=null)}),e._canvas.onmousewheel=function(t){if(17==e._tmp.lastKey)return e._zoom.update(t.deltaY),!1;e._scrollBar.addMovement(16===e._tmp.lastKey?"H":"V",t.deltaY/Math.abs(t.deltaY)),e.renderAll()};var s=function(i,r){var s=e._getMouse(i);if(e._tmp.pointer=s,r?e.emit("mouse:dblclick",new o(s.x,s.y)):e.emit("mouse:down",new o(s.x,s.y)),r||e.readOnly||(e._isDragged=!0,e._canvas.style.cursor="move"),e._scrollBar.checkCollision(s.x,s.y))return void(e._isDragged=!0);if(e._selected&&!e.readOnly){if(e._tmp.transform=e._selected.getSelectedCorner(s.x,s.y),e._tmp.transform||e._selected.callCustomButton(s.x,s.y)){switch(e._tmp.transform){case"tc":case"bc":e._canvas.style.cursor="ns-resize";break;case"ml":case"mr":e._canvas.style.cursor="ew-resize"}return}e._selected=null,e.emit("object:unselected",new o(s.x,s.y))}for(var a,h=e.items.length-1;h>=0;h--)if(a=e.items[h],a.checkCollision(s.x,s.y)){if(e._selected=a,"relation"!==a.baseType){r?e.emit("object:dblclick",new n(a)):(t.util.logger(t.LogLevel.INFO,"down"),e.emit("object:selected",new n(a)));break}r?e.emit("relation:dblclick",new n(a)):e.emit("relation:selected",new n(a));break}e.renderAll()};e._canvas.onmousedown=function(e){t.util.logger(t.LogLevel.INFO,"Mouse"),i.style.display="none",s(e,!1)},e._canvas.oncontextmenu=function(t){i.style.display="none";var n=e._getMouse(t),o=e.getElementByPosition(n.x,n.y);if(o&&o.menu){var r=void 0;i.innerHTML="";for(var s=0,a=o.menu;s<a.length;s++){var h=a[s];!function(t){r=document.createElement("li"),r.innerHTML=t.item,r.onclick=function(){t.callback(this,o),i.style.display="none"},i.appendChild(r)}(h)}i.style.top=t.clientY+"px",i.style.left=t.clientX+"px",i.style.display="block",i.style.opacity="1"}return!1},e._canvas.onmousemove=function(t){if((!e.readOnly||e._scrollBar.isSelected())&&e._isDragged){var i=e._getMouse(t),r=i.x-e._tmp.pointer.x,s=i.y-e._tmp.pointer.y;if(e._scrollBar.isSelected())e._scrollBar.dragScroll(r,s),e.renderAll(),e._tmp.pointer=e._getMouse(t);else{if(e.emit("mouse:move",new o(i.x,i.y)),e._selected)if(e._tmp.transform){if("relation"!==e._selected.baseType)switch(r=Math.floor(r),s=Math.floor(s),e._tmp.transform){case"tc":e._selected.y+=s,e._selected.height-=s;break;case"bc":e._selected.height+=s;break;case"ml":e._selected.x+=r,e._selected.width-=r;break;case"mr":e._selected.width+=r}else e._selected.movePoint(parseInt(e._tmp.transform),r,s);e.renderAll()}else e._selected.draggable&&(e._selected.x+=r,e._selected.y+=s,e.emit("object:dragging",new n(e._selected)),e.renderAll());e._tmp.pointer=i}}},e._canvas.onmouseup=function(t){if(!e.readOnly){var i=e._getMouse(t);e._canvas.style.cursor="default",e._isDragged=!1,e._scrollBar.selected=null,e.emit("mouse:up",new o(i.x,i.y)),e._selected&&(e.emit("object:released",new n(e._selected)),e._tmp.transform=null,e._selected.recalculateBorders())}},e._canvas.onmouseenter=function(){e.renderAll()},e._canvas.onmouseleave=function(){e._isDragged=!1,e._canvas.style.cursor="default"},e._canvas.onselectstart=function(){return!1}},r.prototype.bindResizeWindow=function(){var t=-1,e=this,i=function(){clearTimeout(t),t=setTimeout(function(){e.refreshScreen()},500)};window.removeEventListener("resize",i),window.addEventListener("resize",i)},r.prototype.emit=function(t,e,i){if(void 0===i&&(i=!0),i&&void 0!==this._callbacks[t])for(var n=0,o=this._callbacks[t];n<o.length;n++){var r=o[n],s=r.call(this,e);if(!1===s)return!1}return!0},r.prototype._getMouse=function(t){var e=this._canvas,i=0,n=0;if(e.offsetParent)do{i+=e.offsetLeft,n+=e.offsetTop}while(e=e.offsetParent);var o=this._border;i+=o.paddingLeft,n+=o.paddingTop,i+=o.borderLeft,n+=o.borderTop;var r={x:t.pageX-i,y:t.pageY-n};return r.x+=this.virtualCanvas.x,r.y+=this.virtualCanvas.y,r},r.prototype.removeRelation=function(t,e){for(var i=this.getRelationsFromObject(t,!1,!0),n=[],o=0,r=i;o<r.length;o++){var s=r[o];s.end==e&&n.push(s)}n.length>0&&this.remove(n,!1)},r.prototype.setBackground=function(t,e){this._background=this.createHiDPICanvas(t.width,t.height),this._background.style.position="absolute",this._background.style.left="0",this._background.style.top="0",this._background.style.zIndex="0",this._background.getContext("2d").drawImage(t,0,0),this._canvas.style.backgroundColor="transparent",e&&(this.virtualCanvas.width=t.width,this.virtualCanvas.height=t.height,this._scrollBar=new Common.ScrollBar(this)),this.container.insertBefore(this._background,this._canvas)},r.prototype.trigger=function(t,e){this.emit(t,new n(e))},r.prototype.cleanBackground=function(){this.container.removeChild(this.container.firstChild),this._canvas.width=this.width,this._canvas.height=this.height,this.container.style.width=this.container.style.maxWidth=this.viewportWidth+"px",this.container.style.height=this.container.style.maxHeight=this.viewportHeight+"px",this._canvas.style.backgroundColor=t.Config.background},r.prototype.getRelationsFromObject=function(t,e,i){for(var n=[],o=0,r=this.items;o<r.length;o++){var s=r[o];if("relation"===s.baseType){var a=s;a.start!==t&&a.end!==t||(a.start===t&&i?n.push(s):a.end===t&&e?n.push(s):e||i||n.push(s))}}return n},r.prototype.centerToPoint=function(t,e){t-=this.virtualCanvas.viewportWidth/2,e-=this.virtualCanvas.viewportHeight/2,this._scrollBar.setPosition(t,e),this.renderAll(!0)},r.prototype.setSelectedElement=function(t){this._selected=t},r.prototype.getContext=function(){return this._canvas.getContext("2d")},r.prototype.getImage=function(e){void 0===e&&(e=0);var i,n,o,r,s,a,h,l;i=n=Number.MIN_VALUE,o=r=Number.MAX_VALUE;for(var c=0,u=this.items;c<u.length;c++){var d=u[c];"relation"!==d.baseType&&(d.x<o&&(o=d.x),d.y<r&&(r=d.y),d.width+d.x>i&&(i=d.width+d.x),d.y+d.height>n&&(n=d.y+d.height))}s=i-o+10+2*e,a=n-r+10+2*e;var p=this.createHiDPICanvas(s,a,1),f=p.getContext("2d");f.fillStyle=t.Config.background,f.fillRect(0,0,s,a),l=r-e-5,h=o-e-5;for(var v=0;v<this.items.length;v++)"relation"!==this.items[v].baseType&&(this.items[v].x-=h,this.items[v].y-=l);for(var y=this.virtualCanvas.x,g=this.virtualCanvas.y,v=0;v<this.items.length;v++)f.save(),"relation"!==this.items[v].baseType?(this.items[v].render(f,y,g),this.items[v].x+=h,this.items[v].y+=l):this.items[v].render(f,y,g),f.restore();return p.toDataURL("image/png")},r.prototype.getElementByPosition=function(t,e){for(var i,n=this.items.length-1;n>=0;n--)if(i=this.items[n],i.checkCollision(t,e))return i;return null},r}();t.Canvas=u}(Loira||(Loira={}));var Loira;!function(t){var e=function(){function t(){}return t}();t.BaseController=e}(Loira||(Loira={}));var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Loira;!function(t){!function(e){function i(t){for(var e="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<t;n++)e+=i.charAt(Math.floor(Math.random()*i.length));return e}function n(t,e){var i=(t.y2-t.y1)*(e.x2-e.x1)-(t.x2-t.x1)*(e.y2-e.y1);if(0===i)return!1;var n=e.y1-t.y1,o=e.x1-t.x1;return n=((t.x2-t.x1)*n-(t.y2-t.y1)*o)/i,{x:e.x1+n*(e.x2-e.x1),y:e.y1+n*(e.y2-e.y1)}}function o(t){for(var e=t.split("."),i=window||this,n=0,o=e;n<o.length;n++){i=i[o[n]]}if("function"!=typeof i)throw new Error("function not found");return i}function r(t,e){t.sort(function(t,e){return t-e});for(var i=t.length-1;i>=0;i--)e.splice(t[i],1)}function s(e,i,n){t.Config.debug&&e<=t.Config.logLevel&&console.log("[Loira "+(new Date).getTime()+"] "+i)}var a=function(){function t(){this.x=0,this.y=0,this.width=0,this.height=0,this.centerObject=!1,this.maxOutGoingRelation=0,this.extras={},this.text="",this.selectable=!0,this.resizable=!0,this.draggable=!0}return t}();e.BaseOption=a;var h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(a);e.RelOption=h;var l=function(){function t(){}return t}();e.Line=l;var c=function(){function t(){}return t}();e.Region=c;var u=function(){function t(t,e){this.x=t,this.y=e}return t}();e.Point=u;var d=function(){function t(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n}return t}();e.Rect=d,e.createRandom=i,e.intersectPointLine=n,e.stringToFunction=o,e.removeWhole=r,e.logger=s}(t.util||(t.util={}))}(Loira||(Loira={}));var Loira;!function(t){var e=t.util.BaseOption,i=function(){function i(i){this._uid=t.util.createRandom(8),void 0===i&&(i=new e),this.x="x"in i?i.x:0,this.y="y"in i?i.y:0,this.width="width"in i?i.width:0,this.height="height"in i?i.height:0,this.centerObject="centerObject"in i&&i.centerObject,this.maxOutGoingRelation="maxOutGoingRelation"in i?i.maxOutGoingRelation:0,this.extras="extras"in i?i.extras:{},this.text=i.text?i.text:"",this.selectable=!i.selectable||i.selectable,this.resizable=!i.resizable||i.resizable,this.draggable=!i.draggable||i.draggable,this._buttons=[],this._canvas=null,this.type="",this.baseType="",this.animation=new Animation(this)}return i.prototype.render=function(t,e,i){this.animation.proccess()},i.prototype.checkCollision=function(t,e){return t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height},i.prototype.on=function(t){t?(t=[].splice.call(arguments,0),this._buttons=t):this._buttons=[]},i.prototype.renderButtons=function(e,i,n){var o=this.x+this.width+10,r=this.y;o-=i,r-=n,this._buttons.length>0&&this._buttons.forEach(function(i){t.drawable.render(i.icon,e,o,r),r+=t.drawable.get(i.icon).height+4})},i.prototype.callCustomButton=function(e,i){for(var n,o=this.x+this.width+10,r=this.y,s=0,a=this._buttons;s<a.length;s++){var h=a[s];if(n=t.drawable.get(h.icon),o<=e&&e<=o+n.width&&r<=i&&i<=r+n.height)return h.click.call(this),!0;r+=h.icon.height+4}return!1},i.prototype.drawSelected=function(e){var i=this.x-2,n=this.y-2,o=this.width,r=this.height;i-=this._canvas.virtualCanvas.x,n-=this._canvas.virtualCanvas.y,e.beginPath(),e.lineWidth=2,e.setLineDash([5,5]),e.strokeStyle=t.Config.selected.color,e.rect(i,n,o+4,r+4),e.stroke(),e.setLineDash([]),this.resizable&&(e.fillStyle=t.Config.selected.color,e.fillRect(i-4,n-4,8,8),e.fillRect(i+o,n+r,8,8),e.fillRect(i+o,n-4,8,8),e.fillRect(i-4,n+r,8,8),e.fillRect(i+o/2,n-4,8,8),e.fillRect(i+o/2,n+r,8,8),e.fillRect(i-4,n+r/2,8,8),e.fillRect(i+o,n+r/2,8,8)),e.strokeStyle="#000000",e.fillStyle="#000000"},i.prototype.getSelectedCorner=function(t,e){var i=this.x-2,n=this.y-2,o=this.width,r=this.height,s=o/2,a=r/2;return i-4<=t&&t<=i+4&&n-4<=e&&e<=n+4?"tl":i+o<=t&&i+o+8>=t&&n-4<=e&&n+4>=e?"tr":i+o<=t&&i+o+8>=t&&n+r<=e&&n+r+8>=e?"br":i-4<=t&&i+4>=t&&n+r<=e&&n+r+8>=e?"bl":i+s<=t&&i+s+8>=t&&n-4<=e&&n+4>=e?"tc":i+s<=t&&i+s+8>=t&&n+r<=e&&n+r+8>=e?"bc":i-4<=t&&i+4>=t&&n+a<=e&&n+a+8>=e?"ml":i+o<=t&&i+o+8>=t&&n+a<=e&&n+a+8>=e?"mr":""},i.prototype.show=function(){this._canvas.centerToPoint(this.x+this.width/2,this.y+this.height/2)},i.prototype.attach=function(t){this._canvas=t,this.animation.setFps(t.fps)},i.prototype.isVisible=function(t){var e=null,i=null,n=null,o=null;return t.area>this.width*this.height?(e={x:this.x,y:this.y},i={x:this.x+this.width,y:this.y+this.height},n={x:t.x,y:t.y},o={x:t.x+t.viewportWidth,y:t.y+t.viewportHeight}):(n={x:this.x,y:this.y},o={x:this.x+this.width,y:this.y+this.height},e={x:t.x,y:t.y},i={x:t.x+t.viewportWidth,y:t.y+t.viewportHeight}),e.x>n.x&&e.x<o.x&&e.y>n.y&&e.y<o.y||(e.x>n.x&&e.x<o.x&&i.y>n.y&&i.y<o.y||(i.x>n.x&&i.x<o.x&&e.y>n.y&&e.y<o.y||i.x>n.x&&i.x<o.x&&i.y>n.y&&i.y<o.y))},i.prototype.animateTo=function(t,e){void 0===e&&(e=1);this._canvas.fps},i.prototype.destroy=function(){this._canvas=null},i}();t.Element=i}(Loira||(Loira={}));var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Common;!function(t){var e,i=Loira.util.Point,n=Loira.util.BaseOption,o=Loira.util.Rect;!function(t){t[t.STRAIGHT=1]="STRAIGHT",t[t.CURVE=2]="CURVE",t[t.CARTESIAN=3]="CARTESIAN"}(e=t.TypeLine||(t.TypeLine={}));var r=function(t){function n(n){var o=t.call(this,n)||this;return o.start=n.start?n.start:null,o.end=n.end?n.end:null,o.isDashed=!!n.isDashed&&n.isDashed,o.points=n.points?n.points:[new i,new i],o.icon=n.icon?n.icon:"",o.typeLine=n.typeLine?n.typeLine:e.STRAIGHT,o.baseType="relation",o}return __extends(n,t),n.prototype.render=function(t,e,i){var n,r,s,a,h,l,c;n=new o(this.start.x-e,this.start.y-i,this.start.width,this.start.height),r=new o(this.end.x-e,this.end.y-i,this.end.width,this.end.height),this.points[0]={x:n.x+n.width/2,y:n.y+n.height/2},this.points[this.points.length-1]={x:r.x+r.width/2,y:r.y+r.height/2},a=this.points[0],h=this.points[1],t.beginPath(),t.lineWidth=1,t.moveTo(a.x,a.y),this.isDashed&&t.setLineDash([5,5]);for(var u=1;u<this.points.length;u++)u<this.points.length-1&&(this.points[u].x-=e,this.points[u].y-=i),t.lineTo(this.points[u].x,this.points[u].y);if(t.stroke(),t.setLineDash([]),this.icon){a=this.points[this.points.length-2],h=this.points[this.points.length-1],l=h.x-a.x,c=h.y-a.y,s=Math.atan(c/l),l<0&&(s+=Math.PI),t.translate(h.x,h.y),t.rotate(s);var d=Loira.drawable.get(this.icon),p=this.end.obtainBorderPos(l,c,{x1:a.x,y1:a.y,x2:h.x,y2:h.y},t);Loira.drawable.render(this.icon,t,-(d.width+p),-Math.ceil(d.height/2)),t.rotate(-s),t.translate(-h.x,-h.y)}if(this.text||this.text.length>0){t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType;var f=Math.round(this.points.length/2);a=this.points[f-1],h=this.points[f],l=h.x-a.x,c=h.y-a.y,s=t.measureText(this.text).width,t.fillStyle=Loira.Config.background,t.fillRect(a.x+l/2-s/2,a.y+c/2-15,s,12),t.fillStyle="#000000",t.fillText(this.text,a.x+l/2-s/2,a.y+c/2-5),t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType}},n.prototype.recalculateBorders=function(){},n.prototype.update=function(t,e){return this.start=t,this.end=e,this},n.prototype.checkCollision=function(t,e){for(var i,n=null,o=null,r=0,s=0,a={x:0,y:0},h={x:0,y:0},l=1;l<this.points.length;l++)if(n=this.points[l-1],o=this.points[l],a.x=n.x,a.y=n.y,h.y=o.y,h.x=o.x,n.x>o.x&&(a.x=o.x,h.x=n.x),n.y>o.y&&(a.y=o.y,h.y=n.y),t>a.x-5&&t<h.x+5&&e>a.y-5&&e<h.y+5)if(s=Math.abs(o.y-n.y),r=Math.abs(o.x-n.x),t=Math.abs(t-n.x),e=Math.abs(e-n.y),r>s){if(0===(i=Math.abs(s/r*t))&&e>a.y&&e<h.y||i>e-8&&i<e+8)return!0}else if(0===(i=Math.abs(r/s*e))&&t>a.x&&t<h.x||i>t-8&&i<t+8)return!0;return!1},n.prototype.drawSelected=function(t){t.beginPath(),t.fillStyle=Loira.Config.selected.color;for(var e=0;e<this.points.length;e++)t.fillRect(this.points[e].x-4,this.points[e].y-4,8,8);t.strokeStyle="#000000"},n.prototype.addPoint=function(){var t=this.points[1],e=this.points[0],i=Math.round((t.x-e.x)/2)+e.x,n=Math.round((t.y-e.y)/2)+e.y;this.points.splice(1,0,{x:i,y:n})},n.prototype.getSelectedCorner=function(t,e){for(var i=1;i<this.points.length-1;i++){var n=this.points[i].x-4,o=this.points[i].y-4,r=n+8,s=o+8;if(t>n&&t<r&&e>o&&e<s)return i}return!1},n.prototype.movePoint=function(t,e,i){this.points[t].x+=e,this.points[t].y+=i},n.prototype.isVisible=function(t){return!0},n}(Loira.Element);t.Relation=r;var s=function(t){function e(e){var i=t.call(this,e)||this,n=i._linkSymbol;return i.on({icon:"arrow",click:n}),i.baseType="symbol",i}return __extends(e,t),e.prototype._linkSymbol=function(){var t=this,e=this._canvas.on("mouse:down",function(i){var n=t._canvas,o=n.getRelationsFromObject(t,!1,!0).length;if(!t.maxOutGoingRelation||o<t.maxOutGoingRelation)for(var r=0,s=n.items;r<s.length;r++){var a=s[r];if("relation"!==a.baseType&&a.checkCollision(i.x,i.y)){var h=Loira.util.stringToFunction(n.defaultRelation);n.add(new h({}).update(t,a));break}}n.fall("mouse:down",e)})},e.prototype.splitText=function(t,e,i){void 0===i&&(i=10);for(var n=e.split(" "),o="",r=[],s=0;s<n.length;s++)t.measureText(o+n[s]).width>this.width-i?(r.push(o),o=n[s]+" "):o=o+" "+n[s];return r.push(o),r},e.prototype.drawText=function(t,e){var i,n,o=this.x-this._canvas.virtualCanvas.x+this.width/2,r=this.y-this._canvas.virtualCanvas.y+this.height/2;n=this.splitText(t,e),i=r+3-(6*n.length+3*n.length)/2;for(var s=0;s<n.length;s++){var a=t.measureText(n[s]).width;t.fillText(n[s],o-a/2,i+3),i=i+Loira.Config.fontSize+3}},e}(Loira.Element);t.Symbol=s;var a=function(t){function e(e){var i=t.call(this,e)||this;return i.text=e.text?e.text:"Actor1",i.width=30,i.height=85,i.type="actor",i}return __extends(e,t),e.prototype.obtainBorderPos=function(t,e,i,n){n.font=Loira.Config.fontSize+"px "+Loira.Config.fontType;var o=n.measureText(this.text).width;o>this.width&&(this.x=this.x+this.width/2-o/2,this.width=o);var r=Math.atan(e/t);t<0&&(r+=Math.PI);var s=null;return s=r>-.8&&r<.68||r>2.46&&r<4?Loira.util.intersectPointLine(i,{x1:this.x,y1:-100,x2:this.x,y2:100}):Loira.util.intersectPointLine(i,{x1:-100,y1:this.y,x2:100,y2:this.y}),Math.sqrt(Math.pow(s.x-(this.x+this.width/2),2)+Math.pow(s.y-(this.y+this.height/2),2))},e.prototype.render=function(t,e,i){var n=t.measureText(this.text).width;n>this.width&&(this.x=this.x+this.width/2-n/2,this.width=n);var o=this.x-e,r=this.y-i;t.fillStyle=Loira.Config.background,t.fillRect(o,r,this.width,this.height),t.fillStyle="#000000",Loira.drawable.render("actor",t,o+this.width/2-15,r),t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType,t.fillStyle="#000000",t.fillText(this.text,o,r+80)},e.prototype.recalculateBorders=function(){},e}(t.Symbol);t.Actor=a;var h=function(t){function e(e){var i=t.call(this,new n)||this;return i.type="scrollBar",i.width=e.virtualCanvas.viewportWidth,i.height=e.virtualCanvas.viewportHeight,i._horPos=e.virtualCanvas.x,i._verPos=e.virtualCanvas.y,i._horSize=Math.floor(i.width*(i.width/e.virtualCanvas.width)),i._verSize=Math.floor(i.height*(i.height/e.virtualCanvas.height)),i._virtual=e.virtualCanvas,i._canvas=e,i}return __extends(e,t),e.prototype.render=function(t){var e=Loira.Config.scrollBar;this._virtual.width>this._virtual.viewportWidth&&(t.fillStyle=e.background,t.fillRect(0,this.height-e.size,this._virtual.viewportWidth,e.size),t.fillStyle=e.color,t.fillRect(this._horPos,this.height-e.size,this._horSize,e.size)),this._virtual.height>this._virtual.viewportHeight&&(t.fillStyle=e.background,t.fillRect(this.width-e.size,0,e.size,this._virtual.viewportHeight),t.fillStyle=e.color,t.fillRect(this.width-e.size,this._verPos,e.size,this._verSize)),t.fillStyle="#000000"},e.prototype.recalculateBorders=function(){},e.prototype.checkCollision=function(t,e){var i=this._virtual,n=t-i.x,o=e-i.y;return n>this._horPos&&n<this._horPos+this._horSize&&o>i.viewportHeight-Loira.Config.scrollBar.size&&o<i.viewportHeight?(this.selected="H",!0):n>i.viewportWidth-Loira.Config.scrollBar.size&&n<i.viewportWidth&&o>this._verPos&&o<this._verPos+this._verSize?(this.selected="V",!0):(this.selected=null,!1)},e.prototype.addMovement=function(t,e,i){void 0===i&&(i=30);var n,o=this._virtual,r=this._canvas._background;"H"===t?(n=this._horPos+e*i,n<0?this._horPos=0:n+this._horSize>o.viewportWidth?this._horPos=o.viewportWidth-this._horSize:this._horPos=n,o.x=Math.floor(o.width*(this._horPos/o.viewportWidth)),r&&(r.style.marginLeft="-"+o.x+"px")):"V"===t&&(n=this._verPos+e*i,n<0?this._verPos=0:n+this._verSize>o.viewportHeight?this._verPos=o.viewportHeight-this._verSize:this._verPos=n,o.y=Math.floor(o.height*(this._verPos/o.viewportHeight)),r&&(r.style.marginTop="-"+o.y+"px"))},e.prototype.setPosition=function(t,e){var i=this._virtual,n=this._canvas._background;t=t<0?0:t,e=e<0?0:e,i.x=t,i.y=e,this._horPos=Math.floor(i.x*i.viewportWidth/i.width),this._verPos=Math.floor(i.y*i.viewportHeight/i.height),n&&(n.style.marginTop="-"+i.y+"px",n.style.marginLeft="-"+i.x+"px")},e.prototype.isSelected=function(){return!!this.selected},e.prototype.dragScroll=function(t,e){this.addMovement(this.selected,"H"===this.selected?t:e,1)},e}(Loira.Element);t.ScrollBar=h}(Common||(Common={}));var Loira;!function(t){var e,i={color:"#339966"},n={actor:{x:0,y:98,width:35,height:72},spear:{x:0,y:0,width:15,height:14},spear1:{x:0,y:31,width:27,height:28},spear2:{x:34,y:0,width:25,height:26},arrow:{x:27,y:26,width:12,height:16}},o={size:10,color:"rgba(255, 255, 255, 0.85)",background:"rgba(0, 0, 0, 0.15)"},r={roleWidth:150};!function(t){t[t.INFO=99]="INFO",t[t.SYSTEM=2]="SYSTEM",t[t.WARNING=1]="WARNING",t[t.DANGER=0]="DANGER"}(e=t.LogLevel||(t.LogLevel={}));!function(t){t.fontSize=12,t.fontType="Arial",t.selected=i,t.background="#aacccc",t.assetsPath="../assets/glyphs.png",t.regions=n,t.debug=!1,t.logLevel=e.SYSTEM,t.scrollBar=o,t.orgChart=r}(t.Config||(t.Config={}))}(Loira||(Loira={}));var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Relation;!function(t){var e=function(t){function e(e){var i=t.call(this,e)||this;return i.type="association",i}return __extends(e,t),e}(Common.Relation);t.Association=e;var i=function(t){function e(e){var i=this;return e.icon="spear",i=t.call(this,e)||this,i.type="direct_association",i}return __extends(e,t),e}(Common.Relation);t.DirectAssociation=i;var n=function(t){function e(e){var i=this;return e.icon="spear2",i=t.call(this,e)||this,i.type="generalization",i}return __extends(e,t),e}(Common.Relation);t.Generalization=n;var o=function(t){function e(e){var i=this;return e.icon="spear2",e.isDashed=!0,i=t.call(this,e)||this,i.type="realization",i}return __extends(e,t),e}(Common.Relation);t.Realization=o;var r=function(t){function e(e){var i=this;return e.icon="spear1",e.isDashed=!0,i=t.call(this,e)||this,i.type="dependency",i}return __extends(e,t),e}(Common.Relation);t.Dependency=r}(Relation||(Relation={})),Loira.XmiParser={load:function(t,e){var i,n,o=null;if(window.DOMParser){o=(new DOMParser).parseFromString(t,"text/xml")}else o=new ActiveXObject("Microsoft.XMLDOM"),o.async=!1,o.loadXML(t);var r=this._parse(o),s={};for(n in r.symbols)r.symbols.hasOwnProperty(n)&&(i=r.symbols[n],"UML:UseCase"===i.type?s[i.id]=new UseCase.UseCase({text:i.name}):"UML:Actor"===i.type&&(s[i.id]=new Common.Actor({text:i.name})),e.add(s[i.id]));for(n in r.relations)if(r.relations.hasOwnProperty(n)&&(i=r.relations[n],"UML:Association"===i.type)){
for(var a={},h=0;h<i.connection.length;h++)"source"===i.connection[h].taggedValues.ea_end?a.start=s[i.connection[h].type]:"target"===i.connection[h].taggedValues.ea_end&&(a.end=s[i.connection[h].type]);e.addRelation(new Relation.Association(a))}setTimeout(function(){e.renderAll()},50)},_parse:function(t){var e=this._xmlToJson(t),i=e.XMI["XMI.content"]["UML:Model"]["UML:Namespace.ownedElement"]["UML:Package"]["UML:Namespace.ownedElement"],n={},o={};for(var r in i)if(i.hasOwnProperty(r)&&"string"!=typeof i[r]){var s=i[r]["@attributes"]["xmi.id"];if(void 0!==i[r]["UML:Association.connection"]){o[s]={isAbstract:"true"===i[r]["@attributes"].isAbstract,isLeaf:"true"===i[r]["@attributes"].isLeaf,isRoot:"true"===i[r]["@attributes"].isRoot,visibility:i[r]["@attributes"].visibility,id:i[r]["@attributes"]["xmi.id"],type:r,connection:[]};for(var a=0;a<i[r]["UML:Association.connection"]["UML:AssociationEnd"].length;a++){for(var h=i[r]["UML:Association.connection"]["UML:AssociationEnd"][a],l={aggregation:h["@attributes"].aggregation,changeable:h["@attributes"].changeable,isNavigable:"true"===h["@attributes"].isNavigable,isOrdered:"true"===h["@attributes"].isOrdered,targetScope:h["@attributes"].targetScope,type:h["@attributes"].type,visibility:h["@attributes"].visibility,taggedValues:{}},c=0;c<h["UML:ModelElement.taggedValue"]["UML:TaggedValue"].length;c++){var u=h["UML:ModelElement.taggedValue"]["UML:TaggedValue"][c]["@attributes"];l.taggedValues[u.tag]=u.value}o[s].connection.push(l)}}else n[s]={isAbstract:"true"===i[r]["@attributes"].isAbstract,isLeaf:"true"===i[r]["@attributes"].isLeaf,isRoot:"true"===i[r]["@attributes"].isRoot,name:i[r]["@attributes"].name,namespace:i[r]["@attributes"].namespace,visibility:i[r]["@attributes"].visibility,id:i[r]["@attributes"]["xmi.id"],type:r}}return{symbols:n,relations:o}},_xmlToJson:function(t){var e={};if(1===t.nodeType){if(t.attributes.length>0){e["@attributes"]={};for(var i=0;i<t.attributes.length;i++){var n=t.attributes.item(i);e["@attributes"][n.nodeName]=n.nodeValue}}}else 3===t.nodeType&&(e=t.nodeValue);if(t.hasChildNodes())for(var o=0;o<t.childNodes.length;o++){var r=t.childNodes.item(o),s=r.nodeName;if(void 0===e[s])e[s]=this._xmlToJson(r);else{if(void 0===e[s].push){var a=e[s];e[s]=[],e[s].push(a)}e[s].push(this._xmlToJson(r))}}return e}};var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),UseCase;!function(t){var e=function(t){function e(e){var i=t.call(this,e)||this;return i.width=100,i.height=70,i.text=e.text,i.type="use_case",i}return __extends(e,t),e.prototype.obtainBorderPos=function(t,e,i,n){var o=this.width/2,r=this.height/2,s=o*r/Math.sqrt(o*o*e*e+r*r*t*t);return Math.sqrt(Math.pow(s*e,2)+Math.pow(s*t,2))},e.prototype.render=function(t,e,i){if(t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType,this.text){var n=this.x-e,o=this.y-i,r=this.width/2*.5522848,s=this.height/2*.5522848,a=n+this.width,h=o+this.height,l=n+this.width/2,c=o+this.height/2;t.beginPath(),t.lineWidth=2,t.moveTo(n,c),t.bezierCurveTo(n,c-s,l-r,o,l,o),t.bezierCurveTo(l+r,o,a,c-s,a,c),t.bezierCurveTo(a,c+s,l+r,h,l,h),t.bezierCurveTo(l-r,h,n,c+s,n,c),t.stroke(),t.fillStyle="#fcf5d9",t.fill(),t.fillStyle="#000000",this.drawText(t,this.text)}},e.prototype.recalculateBorders=function(){},e}(Common.Symbol);t.UseCase=e;var i=function(t){function e(e){var i=this;return e.icon="spear1",e.text="<< extends >>",e.isDashed=!0,i=t.call(this,e)||this,i.type="extends",i}return __extends(e,t),e}(Common.Relation);t.Extends=i;var n=function(t){function e(e){var i=this;return e.icon="spear1",e.text="<< include >>",e.isDashed=!0,i=t.call(this,e)||this,i.type="include",i}return __extends(e,t),e}(Common.Relation);t.Include=n}(UseCase||(UseCase={}));var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Box;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(Loira.util.BaseOption);t.ColorOption=e;var i=function(t){function e(e){var i=t.call(this,e)||this;return i.width="width"in e?e.width:30,i.height="height"in e?e.height:30,i.color="color"in e?e.color:"rgba(0,0,0,0.3)",i.baseType="box",i}return __extends(e,t),e.prototype.render=function(t,e,i){t.fillStyle=this.color;var n=this.x-e,o=this.y-i;t.fillRect(n,o,this.width,this.height),t.fillText(this.text,n,o-10)},e.prototype.recalculateBorders=function(){},e}(Loira.Element);t.Box=i}(Box||(Box={}));var Animation=function(){function t(t){this._registers=[],this._element=t}return t.prototype.moveTo=function(t,e,i){void 0===i&&(i=1);this._fps;this._isRunning=!0},t.prototype.setFps=function(t){this._fps=t},t.prototype.proccess=function(){this._isRunning&&0==this._registers.length&&(this._isRunning=!1)},t}(),__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Workflow;!function(t){var e=Loira.util.BaseOption,i=Loira.util.Point,n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(e);t.WorkflowOption=n;var o=function(t){function e(e){var i=t.call(this,e)||this;return i.startPoint=!!e.startPoint&&e.startPoint,i.endPoint=!!e.endPoint&&e.endPoint,i}return __extends(e,t),e.prototype._linkSymbol=function(){var t=this,e=this._canvas.on("mouse:down",function(n){var o=t._canvas;if(!t.maxOutGoingRelation||o.getRelationsFromObject(t,!1,!0).length<t.maxOutGoingRelation)for(var r=0,s=o.items;r<s.length;r++){var a=s[r];if("relation"!==a.baseType&&!a.startPoint&&a.checkCollision(n.x,n.y)&&!t.endPoint){var h=Loira.util.stringToFunction(o.defaultRelation),l=null;if(t._uid==a._uid){var c=t.x+t.width+30,u=t.y+t.height/2;l=[],l.push(new i),l.push(new i(c,u)),l.push(new i(c,t.y-30)),l.push(new i(t.x+t.width/2,t.y-30)),l.push(new i)}o.add(new h({points:l}).update(t,a));break}}o.fall("mouse:down",e)})},e}(Common.Symbol);t.Symbol=o;var r=function(t){function e(e){var i=this;return e.width=e.width?e.width:100,e.height=e.height?e.height:70,i=t.call(this,e)||this,i.text=e.text,i.type="process",i.borders={bottomLeft:0,topLeft:0,topRight:0,bottomRight:0},i.recalculateBorders(),i.maxOutGoingRelation=1,i}return __extends(e,t),e.prototype.obtainBorderPos=function(t,e,i,n){var o=Math.atan(e/t);t<0&&(o+=Math.PI);var r={x:100,y:this.y-10};r=o>this.borders.bottomLeft&&o<this.borders.topLeft||o>this.borders.topRight&&o<this.borders.bottomRight?Loira.util.intersectPointLine(i,{x1:this.x,y1:-100,x2:this.x,y2:100}):Loira.util.intersectPointLine(i,{x1:-100,y1:this.y,x2:100,y2:this.y});var s=r.x-(this.x+this.width/2),a=r.y-(this.y+this.height/2);return Math.sqrt(Math.pow(s,2)+Math.pow(a,2))},e.prototype.render=function(t){t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType,t.beginPath(),t.lineWidth=2,t.rect(this.x,this.y,this.width,this.height),t.stroke(),t.fillStyle="#fcf5d9",t.fill(),t.fillStyle="#000000",this.drawText(t,this.text)},e.prototype.recalculateBorders=function(){var t=Math.round(this.width/2),e=Math.round(this.height/2);this.borders.bottomLeft=Math.atan(-e/t),this.borders.topLeft=Math.atan(e/t),this.borders.topRight=Math.atan(e/-t)+Math.PI,this.borders.bottomRight=Math.atan(-e/-t)+Math.PI},e}(o);t.Process=r;var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.obtainBorderPos=function(t,e,i,n){var o=this.width/2,r=this.height/2,s=o*r/Math.sqrt(o*o*e*e+r*r*t*t);return Math.sqrt(Math.pow(s*e,2)+Math.pow(s*t,2))},e.prototype.render=function(t){t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType;var e=this.x+20,i=this.y,n=this.x+this.width-20,o=this.y+this.height;t.beginPath(),t.lineWidth=2,t.moveTo(e,i),t.lineTo(n,i),t.bezierCurveTo(n+30,i,n+30,o,n,o),t.lineTo(e,o),t.bezierCurveTo(e-30,o,e-30,i,e,i),t.stroke(),t.fillStyle="#fcf5d9",t.fill(),t.fillStyle="#000000",this.drawText(t,this.text)},e.prototype.recalculateBorders=function(){},e}(o);t.Terminator=s;var a=function(t){function e(e){var i=this;return e.width=e.width?e.width:100,e.height=e.height?e.height:70,i=t.call(this,e)||this,i.text="INICIO",i.startPoint=!0,i.maxOutGoingRelation=1,i.type="start_terminator",i}return __extends(e,t),e}(s);t.StartTerminator=a;var h=function(t){function e(e){var i=t.call(this,e)||this;return i.width=70,i.height=30,i.text="FIN",i.endPoint=!0,i.type="end_terminator",i}return __extends(e,t),e}(s);t.EndTerminator=h;var l=function(t){function e(e){var i=this;return e.width=e.width?e.width:100,e.height=e.height?e.height:70,i=t.call(this,e)||this,i.text=e.text,i.type="data",i}return __extends(e,t),e.prototype.obtainBorderPos=function(t,e,i,n){var o=this.width/2,r=this.height/2,s=o*r/Math.sqrt(o*o*e*e+r*r*t*t);return Math.sqrt(Math.pow(s*e,2)+Math.pow(s*t,2))},e.prototype.render=function(t){t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType;var e=this.x+20,i=this.y,n=this.x+this.width,o=this.y+this.height;t.beginPath(),t.lineWidth=2,t.moveTo(e,i),t.lineTo(n,i),t.lineTo(n-20,o),t.lineTo(e-20,o),t.lineTo(e,i),t.stroke(),t.fillStyle="#fcf5d9",t.fill(),t.fillStyle="#000000",this.drawText(t,this.text)},e.prototype.recalculateBorders=function(){},e}(o);t.Data=l;var c=function(t){function e(e){var i=this;return e.width=e.width?e.width:100,e.height=e.height?e.height:70,i=t.call(this,e)||this,i.text=e.text,i.type="decision",i}return __extends(e,t),e.prototype.obtainBorderPos=function(t,e,i,n){var o,r=this.x,s=this.y,a=this.x+this.width/2,h=this.y+this.height/2,l=this.x+this.width,c=Math.atan(h/t);return t<0&&(c+=Math.PI),o=c>0&&c<1.6||c>3.15&&c<4.7?Loira.util.intersectPointLine(i,{x1:r,y1:h,x2:a,y2:s}):Loira.util.intersectPointLine(i,{x1:a,y1:s,x2:l,y2:h}),r=o.x-(this.x+this.width/2),s=o.y-(this.y+this.height/2),Math.sqrt(Math.pow(r,2)+Math.pow(s,2))},e.prototype.render=function(t){t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType;var e=this.x,i=this.y,n=this.x+this.width/2,o=this.y+this.height/2,r=this.x+this.width,s=this.y+this.height;t.beginPath(),t.lineWidth=2,t.moveTo(n,i),t.lineTo(r,o),t.lineTo(n,s),t.lineTo(e,o),t.lineTo(n,i),t.stroke(),t.fillStyle="#fcf5d9",t.fill(),t.fillStyle="#000000",this.drawText(t,this.text)},e.prototype.recalculateBorders=function(){},e}(o);t.Decision=c}(Workflow||(Workflow={}));var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),OrgChart;!function(t){var e,i=Loira.BaseController,n=Loira.util.RelOption,o=Loira.util.Rect,r=["#124FFD","#FF4FFD","#12003D"],s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(Loira.util.BaseOption);t.RoleOption=s;var a=function(){function t(t){this.children=[],this.role=t,this.height=40}return t.prototype.recalculate=function(t){void 0===t&&(t=0),this.width=0,this.level=t;var i=t+1;e.length<=t&&e.push(this.role.height);for(var n=0;n<this.children.length;n++){var o=this.children[n];o.x=this.x+this.width,o.recalculate(i),this.width+=o.width}0===this.width&&(this.width=this.role.width+10),this.role.x=Math.floor(this.width/2-this.role.width/2)+this.x,this.role.isDuplicate||(this.role.color=r[t]),this.role.level=t,e[t]<this.role.height&&(e[t]=this.role.height)},t.prototype.getAllChildren=function(){var t=[];if(this.children.length>0)for(var e=0;e<this.children.length;e++){var i=this.children[e].getAllChildren();t.push(this.children[e]);for(var n=0;n<i.length;n++)t.push(i[n])}return t},t.prototype.getAllParent=function(){for(var t=[],e=this;e.parent;)t.push(e.parent),e=e.parent;return t},t}();t.Group=a;var h=function(i){function o(t,e){void 0===t&&(t=null),void 0===e&&(e=!0);var n=i.call(this)||this;return n.roots=[],n.elements=[],t&&(r=t),n.autoRefresh=e,n}return __extends(o,i),o.prototype.bind=function(e){var i=this;this.canvas=e,e.defaultRelation="OrgChart.Relation",e.on("object:added",function(t){var e=new a(t.selected);i.roots.push(e),i.elements.push(e),i.autoRefresh&&i.reorderElements()}),e.on("relation:pre-add",function(t){for(var n=e.getRelationsFromObject(t.selected.start,!1,!0),o=0,r=n;o<r.length;o++){if(r[o].end==t.selected.end)return!1}var s=i.getGroup(t.selected.end,i.elements).item;if(s){var a=s.getAllChildren();a.push(s);for(var h=0;h<a.length;h++)if(a[h].role.id===t.selected.start.id&&a[h].role!=t.selected.start)return!1}}),e.on("object:selected",function(t){var i=t.selected;i.isDuplicate&&(e.centerToPoint(i.rolePrimary.x,i.rolePrimary.y),e.setSelectedElement(i.rolePrimary),setTimeout(function(){e.trigger("object:selected",i.rolePrimary)},300))}),e.on("relation:added",function(o){var r=i.getGroup(o.selected.end,i.roots).index,s=i.getGroup(o.selected.end,i.elements).item,a=i.getGroup(o.selected.start,i.elements).item;if(r>=0)i.roots.splice(r,1),a.parent==s&&i.roots.push(a);else{var h=s.parent.children;r=i.getGroup(s.role,h).index,h.splice(r,1);for(var l=e.getRelationsFromObject(o.selected.end,!0,!1),c=[],u=0,d=l;u<d.length;u++){var p=d[u];p.start!=a.role&&c.push(p)}c.length>0&&e.remove(c,!1)}if(a.parent==s){if(a.parent=s.parent,r=i.getGroup(a.role,s.children).index,s.children.splice(r,1),a.parent){a.parent.children.push(a);var f=new n;f.start=a.parent.role,f.end=a.role;var p=new t.Relation(f);e.add([p],!1)}e.removeRelation(s.role,a.role)}s.parent=a,a.children.push(s),i.autoRefresh&&(i.reorderElements(),e.renderAll(!0))}),e.on("object:removed",function(t){var n,o,r;if("relation"===t.selected.baseType)n=t.selected,o=i.getGroup(n.end,i.elements).item;else{r=i.getGroup(t.selected,i.elements).index,o=i.elements[r],i.elements.splice(r,1);for(var s=o.getAllChildren(),a=[],h=[],l=0;l<s.length;l++)h.push(i.elements.indexOf(s[l])),a.push(s[l].role);Loira.util.removeWhole(h,i.elements),e.remove(a,!1)}o.parent?(r=i.getGroup(o.role,o.parent.children).index,o.parent.children.splice(r,1)):(r=i.getGroup(o.role,i.roots).index,i.roots.splice(r,1)),n&&(o.parent=null,i.roots.push(o)),i.autoRefresh&&i.reorderElements()})},o.prototype.load=function(t){var e,i,o,r=[],h=[],u=this.canvas.readOnly;this.canvas.readOnly=!1;for(var d=0,p=t;d<p.length;d++){var f=p[d];if(e=new s,e.id=f.id?f.id.toString():"",e.personName=f.personName?f.personName.toString():null,e.title=f.title?f.title.toString():null,this.getGroupById(e.id).item&&(e.isDuplicate=!0),i=new a(new l(e)),i.role.on(null),f.parent){var v=this.getGroupById(f.parent?f.parent.toString():"").item;v.children.push(i),i.parent=v,o=new n,o.start=v.role,o.end=i.role,h.push(new c(o))}else this.roots.push(i);this.elements.push(i),r.push(i.role)}this.canvas.add(r,!1),this.canvas.add(h,!1),this.canvas.readOnly=u},o.prototype.exportData=function(){for(var t=[],e=0,i=this.elements;e<i.length;e++){var n=i[e],o=n.parent;t.push({id:n.role.id,level:n.role.level,parent:o?o.role.id:null})}return t},o.prototype.reorderElements=function(){var t=0;e=[];for(var i=0,n=this.roots;i<n.length;i++){var o=n[i];o.x=t,o.recalculate(),t+=o.width}e[0]+=30;for(var r=1;r<e.length;r++)e[r]+=e[r-1]+30;for(var r=0;r<this.elements.length;r++){var s=this.elements[r];s.role.y=0===s.level?10:e[s.level-1]}},o.prototype.getGroup=function(t,e){e||(e=this.elements);for(var i=0;i<e.length;i++)if(e[i].role==t)return{item:e[i],index:i};return{item:null,index:-1}},o.prototype.getGroupById=function(t,e){e||(e=this.elements),t=t.trim();for(var i=0;i<e.length;i++)if(""!==t&&e[i].role.id==t)return{item:e[i],index:i};return{item:null,index:-1}},o}(i);t.Controller=h;var l=function(t){function e(e){var i=t.call(this,e)||this;return i.width=Loira.Config.orgChart.roleWidth,i.height=20,i.parent=e.parent,i.title=e.title,i.resizable=!1,i.draggable=!1,i.id=e.id,i.personName=e.personName?e.personName:"",i.isDuplicate=!!e.isDuplicate&&e.isDuplicate,i.type="role",i}return __extends(e,t),e.prototype.render=function(e,i,n){t.prototype.render.call(this,e,i,n);var o,r,s,a=this.x-i,h=this.y-n,l=a+this.width/2,c=0;this.personName&&(r={fontSize:Loira.Config.fontSize,lines:t.prototype.splitText.call(this,e,this.personName)},c=(r.fontSize+3)*r.lines.length+5),this.title&&(s={fontSize:Loira.Config.fontSize-(r?3:0),lines:t.prototype.splitText.call(this,e,this.title)},c+=(s.fontSize+3)*s.lines.length+5),o=h+Loira.Config.fontSize,this.height=c;var u,d;if(e.fillStyle=this.isDuplicate?"#000000":this.color,e.lineWidth=4,this.isSelected?(u="#00c0ff",d=20,e.strokeStyle="#00c0ff",this.isSelected=!1):(u="#000000",d=10,e.strokeStyle="#000000"),this._canvas.userAgent!=Loira.UserAgent.FIREFOX&&(e.shadowColor=u,e.shadowBlur=d),Loira.shape.drawRoundRect(e,a,h,this.width,this.height,5),e.fillStyle="#FFFFFF",e.font=Loira.Config.fontSize+"px "+Loira.Config.fontType,r){for(var p=0;p<r.lines.length;p++){var f=e.measureText(r.lines[p]).width;e.fillText(r.lines[p],l-f/2,o+3),o=o+s.fontSize+3}o+=5,e.font="bold "+s.fontSize+"px "+Loira.Config.fontType}if(s)for(var p=0;p<s.lines.length;p++){var f=e.measureText(s.lines[p]).width;e.fillText(s.lines[p],l-f/2,o+3),o=o+s.fontSize+3}},e.prototype.recalculateBorders=function(){},e.prototype.obtainBorderPos=function(t,e,i,n){return 0},e.prototype.drawSelected=function(t){this.isSelected=!0,this.render(t,this._canvas.virtualCanvas.x,this._canvas.virtualCanvas.y)},e.prototype.attach=function(e){t.prototype.attach.call(this,e);var i=e.getContext(),n=0;this.personName&&(n+=(Loira.Config.fontSize+3)*t.prototype.splitText.call(this,i,this.personName).length+5),this.title&&(n+=(Loira.Config.fontSize+3-(this.personName?3:0))*t.prototype.splitText.call(this,i,this.title).length+5),this.height=n,e.readOnly&&this.on(null),this.isDuplicate&&this.setDuplicate()},e.prototype.setDuplicate=function(){for(var t=this._canvas.controller.elements,e=this._canvas.controller.getGroup(this).item,i=e.getAllParent(),n=!0,o=0;o<i.length;o++)if(this.id&&i[o].role.id===this.id){this.title=" ",this.id="",n=!1;break}if(n)for(var o=0;o<t.length;o++)if(t[o].role!==this&&t[o].role.id==this.id.trim()&&!t[o].role.isDuplicate){this.isDuplicate=!0,this.on(null),this.rolePrimary=t[o].role;break}},e.prototype.update=function(t){this.title=t.title,this.id=t.id.trim(),this.setDuplicate()},e}(Common.Symbol);t.Role=l;var c=function(t){function e(e){var i=t.call(this,e)||this;return i.type="orgchart:relation",i}return __extends(e,t),e.prototype.render=function(t,e,i){var n,r,s=new o(this.start.x-e,this.start.y-i,this.start.width,this.start.height),a=new o(this.end.x-e,this.end.y-i,this.end.width,this.end.height);n=a.y-10,r={x:s.x+s.width/2,y:s.y+s.height/2},this.points[0]=r,this.points[1]={x:r.x,y:n},this.points[2]={x:a.x+a.width/2,y:n},this.points[3]={x:a.x+a.width/2,y:a.y+a.height/2},t.beginPath(),t.lineWidth=4,t.strokeStyle="rgba(255,255,255,0.5)",t.moveTo(r.x,r.y),t.lineJoin="round";for(var h=1;h<this.points.length;h++)t.lineTo(this.points[h].x,this.points[h].y);t.stroke()},e}(Common.Relation);t.Relation=c}(OrgChart||(OrgChart={}));