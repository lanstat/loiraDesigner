var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Loira;!function(t){var e;!function(t){t.ERROR_MESSAGE="error:message",t.OBJECT_ADDED="object:added",t.OBJECT_PRE_ADD="object:pre-add",t.RELATION_PRE_ADD="relation:pre-add",t.RELATION_ADDED="relation:added",t.OBJECT_REMOVED="object:removed";var e=function(){function t(){}return t}();t.Event=e;var i=function(t){function e(e,i){var n=t.call(this)||this;return n.x=e,n.y=i,n}return __extends(e,t),e}(e);t.MouseEvent=i;var n=function(t){function e(e){var i=t.call(this)||this;return i.selected=e,i}return __extends(e,t),e}(e);t.ObjectEvent=n;var o=function(t){function e(e){var i=t.call(this)||this;return i.selected=e,i}return __extends(e,t),e}(e);t.RelationEvent=o;var r=function(t){function e(e){var i=t.call(this)||this;return i.message=e,i}return __extends(e,t),e}(e);t.MessageEvent=r}(e=t.event||(t.event={}))}(Loira||(Loira={}));var Loira;!function(t){var e;!function(t){function e(t,e,i){this.image=new Image,this.image.src=t,this.image.onload=function(){i()},this.regions=e}function i(t,e,i,n){var o=this.regions[t];e.drawImage(this.image,o.x,o.y,o.width,o.height,i,n,o.width,o.height)}function n(t){return this.regions[t]}t.registerMap=e,t.render=i,t.get=n}(e=t.drawable||(t.drawable={}))}(Loira||(Loira={}));var Loira;!function(t){var e;!function(t){function e(t,e,i,n,o,r){t.beginPath(),t.moveTo(e+r,i),t.lineTo(e+n-r,i),t.quadraticCurveTo(e+n,i,e+n,i+r),t.lineTo(e+n,i+o-r),t.quadraticCurveTo(e+n,i+o,e+n-r,i+o),t.lineTo(e+r,i+o),t.quadraticCurveTo(e,i+o,e,i+o-r),t.lineTo(e,i+r),t.quadraticCurveTo(e,i,e+r,i),t.closePath(),t.stroke(),t.fill()}function i(t,e,i,n,o){var r=e+n/2,s=i+o/2,a=e+n,l=i+o;t.beginPath(),t.lineWidth=2,t.moveTo(r,i),t.lineTo(a,s),t.lineTo(r,l),t.lineTo(e,s),t.lineTo(r,i),t.stroke(),t.fillStyle="#fcf5d9",t.fill()}function n(t,e,i){}var o;!function(t){t[t.LEFT=0]="LEFT",t[t.CENTER=1]="CENTER",t[t.RIGHT=2]="RIGHT"}(o=t.HorizontalAlign||(t.HorizontalAlign={}));var r;!function(t){t[t.TOP=0]="TOP",t[t.MIDDLE=1]="MIDDLE",t[t.BOTTOM=2]="BOTTOM"}(r=t.VerticalAlign||(t.VerticalAlign={})),t.drawRoundRect=e,t.drawDiamond=i,t.drawText=n}(e=t.shape||(t.shape={}))}(Loira||(Loira={}));var Loira;!function(t){function e(){var e;return e=/firefox/i.test(navigator.userAgent)?a.FIREFOX:a.UNKNOWN,t.util.logger(t.LogLevel.SYSTEM,navigator.userAgent),e}var i=t.event.RelationEvent,n=t.event.ObjectEvent,o=t.event.MouseEvent,r=function(){function t(){this.x=0,this.y=0,this.width=0,this.height=0,this.viewportWidth=0,this.viewportHeight=0,this.area=0}return t}();t.VirtualCanvas=r;var s=function(){function t(){this.width=0,this.height=0,this.viewportWidth=0,this.viewportHeight=0,this.dragCanvas=!1,this.controller=null,this.readOnly=!1}return t}();t.CanvasConfig=s;var a;!function(t){t[t.FIREFOX=1]="FIREFOX",t[t.IE=2]="IE",t[t.CHROME=3]="CHROME",t[t.UNKNOWN=4]="UNKNOWN"}(a=t.UserAgent||(t.UserAgent={}));var l;!function(t){t[t.ENTER=13]="ENTER",t[t.DELETE=46]="DELETE",t[t.CONTROL=17]="CONTROL",t[t.ALT=18]="ALT",t[t.SHIFT=16]="SHIFT"}(l=t.Key||(t.Key={}));var h=function(){function t(t){void 0===t&&(t=32),this._fps=1e3/t,this._elapsed=(new Date).getTime()}return t.prototype.passed=function(){var t=!1,e=(new Date).getTime();return e>=this._elapsed&&(this._elapsed=e+this._fps,t=!0),t},t}(),c=function(){function t(){}return t}(),u=function(){function t(t){this._canvas=t,this._scale=1,this.update(1)}return t.prototype.update=function(t){this._scale+=t/Math.abs(t),this._scale<9&&this._scale>0&&(this.scrollX=Math.floor(this._canvas.width/20),this.scrollY=Math.floor(this._canvas.height/20))},t}(),d=function(){function r(i,n){this._selected=[],this._isDragged=!1,this._tmp=new c,this.items=[],this._canvas=null,this._background=null,this.virtualCanvas=null,this.defaultRelation=null,this.container=null,this.readOnly=!1,"string"==typeof i?this.container=document.getElementById(i):this.container=i,n||(n=new s,n.width=this.container.parentElement.offsetWidth,n.height=this.container.parentElement.offsetHeight),n.viewportWidth=n.viewportWidth||this.container.offsetWidth||this.container.parentElement.offsetWidth||n.width,n.viewportHeight=n.viewportHeight||this.container.offsetHeight||this.container.parentElement.offsetHeight||n.height,this.readOnly=n.readOnly||!1,this._tmp.pointer={x:0,y:0},this._callbacks={},this.items=[],this.width=n.width,this.height=n.height,this.viewportHeight=n.viewportHeight,this.viewportWidth=n.viewportWidth,this.dragCanvas=n.dragCanvas,this.fps=n.fps,this.defaultRelation="Relation.Association",this.refreshScreen();var o=this;t.drawable.registerMap(t.Config.assetsPath,t.Config.regions,function(){o.renderAll()}),this._fps=new h(n.fps),this._zoom=new u(this),this.controller=n.controller||null,this.controller&&this.controller.bind(this),this.userAgent=e(),this.bindResizeWindow()}return r.prototype.iterateSelected=function(t){if(this._selected.length>0)for(var e=0,i=this._selected;e<i.length;e++){var n=i[e];t(n)}},r.prototype.clearSelected=function(t){if(void 0===t&&(t=null),t){for(var e=0;e<this._selected.length;e++)if(this._selected[e]._uid===t._uid){this._selected[e].isSelected=!1,this._selected.splice(e,1);break}}else{for(var i=0,n=this._selected;i<n.length;i++){var o=n[i];o.isSelected=!1}this._selected=[]}},r.prototype.appendSelected=function(t,e){void 0===e&&(e=!1);var i=null;i="[object Array]"!==Object.prototype.toString.call(t)?[t]:t,e&&this.clearSelected();for(var n=0,o=i;n<o.length;n++){var r=o[n];r.isSelected||(r.isSelected=!0,this._selected.push(r))}},r.prototype.refreshScreen=function(){this.destroy(),this.container.style.width=this.container.style.maxWidth=this.viewportWidth+"px",this.container.style.height=this.container.style.maxHeight=this.viewportHeight+"px",this.container.style.position="relative",this.container.style.overflow="hidden",this._canvas=this.createHiDPICanvas(this.viewportWidth,this.viewportHeight),this._canvas.style.position="absolute",this._canvas.style.left="0",this._canvas.style.top="0",this._canvas.style.zIndex="100",this._canvas.style.backgroundColor=t.Config.background,this._canvas.tabIndex=99,this.container.appendChild(this._canvas),this.virtualCanvas={x:0,y:0,viewportWidth:this.viewportWidth,viewportHeight:this.viewportHeight,width:this.width,height:this.height,area:this.viewportHeight*this.viewportWidth},document.defaultView&&document.defaultView.getComputedStyle&&(this._border={paddingLeft:parseInt(document.defaultView.getComputedStyle(this._canvas,null).paddingLeft,10)||0,paddingTop:parseInt(document.defaultView.getComputedStyle(this._canvas,null).paddingTop,10)||0,borderLeft:parseInt(document.defaultView.getComputedStyle(this._canvas,null).borderLeftWidth,10)||0,borderTop:parseInt(document.defaultView.getComputedStyle(this._canvas,null).borderTopWidth,10)||0}),this._bind();var e=this;this._scrollBar=new t.Common.ScrollBar(this),setTimeout(function(){e.renderAll(!0)},200)},r.prototype.createHiDPICanvas=function(t,e,i){var n=function(){var t=document.createElement("canvas").getContext("2d"),e=window.devicePixelRatio||1,i=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return e=e<1?1:e,e/i}();i||(i=n);var o=document.createElement("canvas");return o.width=t*i,o.height=e*i,o.style.width=t+"px",o.style.height=e+"px",o.getContext("2d").setTransform(i,0,0,i,0,0),o},r.prototype.renderAll=function(e){void 0===e&&(e=!1),t.util.logger(t.LogLevel.INFO,"Draw");var i=this,n=1==this._selected.length;if(this._fps.passed()||e){var o=this._canvas.getContext("2d");o.clearRect(0,0,this._canvas.width,this._canvas.height);for(var r=0;r<this.items.length;r++)this.items[r].isVisible(this.virtualCanvas)&&(o.save(),this.items[r].render(o,this.virtualCanvas.x,this.virtualCanvas.y),o.restore());this.iterateSelected(function(e){e.selectable&&(t.util.logger(t.LogLevel.INFO,"Selected"),o.save(),e.drawSelected(o,n),o.restore(),e.renderButtons(o,i.virtualCanvas.x,i.virtualCanvas.y))}),this._scrollBar.render(o),t.Config.showBanner&&t.Canvas.drawBanner(o)}},r.prototype.add=function(e,o){if(void 0===o&&(o=!0),!this.readOnly){var r,s,a=this.items,l=this;s="[object Array]"!==Object.prototype.toString.call(e)?[e]:e;for(var h=0,c=s;h<c.length;h++){var u=c[h];if(u.attach(l),"relation"===u.baseType){if(r=u,!l.emit(t.event.RELATION_PRE_ADD,new i(r)))return;var d=a.indexOf(r.start);d=d<a.indexOf(r.end)?d:a.indexOf(r.end),a.splice(d,0,u),l.emit(t.event.RELATION_ADDED,new i(r),o)}else if("container"===u.baseType)a.splice(0,0,u),l.emit("container:added",new n(u),o);else{if(!l.emit("object:pre-add",new n(u)))return;u.centerObject&&(u.x=l.virtualCanvas.viewportWidth/2+l.virtualCanvas.x-u.width/2,u.y=l.virtualCanvas.viewportHeight/2+l.virtualCanvas.y-u.height/2),a.push(u),l.emit("object:added",new n(u),o)}}}},r.prototype.remove=function(e,i){void 0===i&&(i=!0);for(var o=this.items,r=this,s=0,a=e;s<a.length;s++){var l=a[s],h=[];h.push(o.indexOf(l));for(var c=0;c<o.length;c++)if("relation"===o[c].baseType){var u=o[c];u.start._uid!==l._uid&&u.end._uid!==l._uid||(u.destroy(),h.push(c))}h.sort(function(t,e){return t-e});for(var c=h.length-1;c>=0;c--)o.splice(h[c],1);r.emit(t.event.OBJECT_REMOVED,new n(l),i)}this.clearSelected(),this.renderAll(!0)},r.prototype.removeAll=function(){for(var t=0;t<this.items.length;t++)this.items[t].destroy();this.items=[],this.clearSelected()},r.prototype.destroy=function(){for(this._canvas&&(this._canvas.onmousemove=null,this._canvas.onkeydown=null,this._canvas.onmousedown=null,this._canvas.onmouseup=null,this._canvas.ondblclick=null,this._canvas.onselectstart=null),this.contextMenu&&(this.contextMenu.remove(),this.contextMenu=null),this.textEditor&&(this.textEditor.remove(),this.textEditor=null),this._canvas=null;this.container.firstChild;)this.container.removeChild(this.container.firstChild)},r.prototype.on=function(t,e){var i;if("string"==typeof t)return"undefined"==typeof this._callbacks[t]&&(this._callbacks[t]=[]),this._callbacks[t].push(e),e;if("object"==typeof t)for(i in t)t.hasOwnProperty(i)&&("undefined"==typeof this._callbacks[i]&&(this._callbacks[i]=[]),this._callbacks[i].push(t[i]));return null},r.prototype.fall=function(t,e){var i=this._callbacks[t].indexOf(e);i>-1&&this._callbacks[t].splice(i,1)},r.prototype._bind=function(){var e=this;this.contextMenu=document.createElement("ul"),this.contextMenu.className="loira-context-menu",this.contextMenu.oncontextmenu=function(){return!1},document.getElementsByTagName("body")[0].appendChild(this.contextMenu),this.textEditor=document.createElement("textarea"),this.textEditor.className="loira-text-editor",document.getElementsByTagName("body")[0].appendChild(this.textEditor);var i=function(t,i){if(t.keyCode!=l.ALT&&(e._tmp.lastKey=t.keyCode,!i&&e._tmp.lastKey===l.DELETE)){if(e.readOnly)return;e._selected&&e.remove(e._selected)}};e._canvas.onkeydown=function(t){i(t,!1)},document.addEventListener("keydown",function(t){i(t,!0)}),e._canvas.onkeyup=function(){e._tmp.lastKey=null},document.addEventListener("keyup",function(){e.readOnly||(e._tmp.lastKey=null)}),e._canvas.onmousewheel=function(t){return e._tmp.lastKey==l.CONTROL?e._zoom.update(t.deltaY):e._scrollBar.addMovementWheel(e._tmp.lastKey===l.SHIFT?"H":"V",t.deltaY/Math.abs(t.deltaY)),e.renderAll(),!1};var r=function(i,r){var s=e._getMouse(i);if(e._tmp.pointer=s,r?e.emit("mouse:dblclick",new o(s.x,s.y)):e.emit("mouse:down",new o(s.x,s.y)),r||e.readOnly||(e._isDragged=!0,e._canvas.style.cursor="move"),e._scrollBar.checkCollision(s.x,s.y))return e._tmp.globalPointer={x:i.pageX,y:i.pageY},void(e._isDragged=!0);if(1==e._selected.length&&!e.readOnly){var a=e._selected[0];if(e._tmp.transform=a.getSelectedCorner(s.x,s.y),e._tmp.transform||a.callCustomButton(s.x,s.y)){switch(e._tmp.transform){case"tc":case"bc":e._canvas.style.cursor="ns-resize";break;case"ml":case"mr":e._canvas.style.cursor="ew-resize"}return}e._tmp.lastKey!==l.SHIFT&&(e.clearSelected(),e.emit("object:unselected",new o(s.x,s.y)))}for(var h,c=!1,u=e.items.length-1;u>=0;u--)if(h=e.items[u],h.checkCollision(s.x,s.y)){if(c=!0,h.isSelected){e._tmp.lastKey===l.SHIFT&&(e.clearSelected(h),e.emit("object:unselected",new n(h)));break}if(e.appendSelected(h,e._tmp.lastKey!==l.SHIFT),"relation"!==h.baseType){r?e.emit("object:dblclick",new n(h)):(t.util.logger(t.LogLevel.INFO,"down"),e.emit("object:selected",new n(h)));break}r?e.emit("relation:dblclick",new n(h)):e.emit("relation:selected",new n(h));break}c||(e.clearSelected(),e.emit("object:unselected",new n(null))),e.renderAll()};e._canvas.onmousedown=function(i){t.util.logger(t.LogLevel.INFO,"Mouse"),e.contextMenu.style.display="none",r(i,!1)},e._canvas.oncontextmenu=function(t){e.contextMenu.style.display="none";var i=e._getMouse(t),n=e.getElementByPosition(i.x,i.y);if(n){var o=n.getMenu(i.x,i.y);if(!o)return!1;var r=void 0;e.contextMenu.innerHTML="";for(var s=function(t){r=document.createElement("li"),t?(r.innerHTML=t.text,r.onclick=function(){t.callback(this,n),e.contextMenu.style.display="none"}):r.className="null-line",e.contextMenu.appendChild(r)},a=0,l=o;a<l.length;a++){var h=l[a];s(h)}e.contextMenu.style.top=t.clientY+"px",e.contextMenu.style.left=t.clientX+"px",e.contextMenu.style.display="block",e.contextMenu.style.opacity="1"}return!1},e._canvas.onmousemove=function(t){if((!e.readOnly||e._scrollBar.isSelectable())&&e._isDragged){var i=e._getMouse(t),r=i.x-e._tmp.pointer.x,s=i.y-e._tmp.pointer.y;if(!e._scrollBar.isSelectable()){if(e.emit("mouse:move",new o(i.x,i.y)),e._selected)if(e._tmp.transform){if("relation"!==e._selected[0].baseType)switch(r=Math.floor(r),s=Math.floor(s),e._tmp.transform){case"tc":e._selected[0].y+=s,e._selected[0].height-=s;break;case"bc":e._selected[0].height+=s;break;case"ml":e._selected[0].x+=r,e._selected[0].width-=r;break;case"mr":e._selected[0].width+=r}else e._selected[0].movePoint(parseInt(e._tmp.transform),r,s);e.renderAll()}else e.iterateSelected(function(t){t.draggable&&(t.move(r,s),e.emit("object:dragging",new n(t)),e.renderAll())});e._tmp.pointer=i}}},e._canvas.onmouseup=function(t){var i=e._getMouse(t);e._canvas.style.cursor="default",e._isDragged=!1,e.emit("mouse:up",new o(i.x,i.y)),e.iterateSelected(function(t){e.emit("object:released",new n(t)),e._tmp.transform=null,t.recalculateBorders(),e.save()})},e._canvas.onmouseenter=function(){e.renderAll()},e._canvas.onmouseleave=function(){e._isDragged=!1,e._canvas.style.cursor="default"},e._canvas.onselectstart=function(){return!1},document.addEventListener("mousemove",function(t){e._scrollBar.isSelectable()&&(e._scrollBar.dragScroll(t.pageX-e._tmp.globalPointer.x,t.pageY-e._tmp.globalPointer.y),e.renderAll(),e._tmp.globalPointer={x:t.pageX,y:t.pageY})}),document.addEventListener("mouseup",function(){e._scrollBar.selected=null})},r.prototype.bindResizeWindow=function(){var t=-1,e=this,i=function(){clearTimeout(t),t=setTimeout(function(){e.refreshScreen()},500)};window.removeEventListener("resize",i),window.addEventListener("resize",i)},r.prototype.emit=function(t,e,i){if(void 0===i&&(i=!0),i&&"undefined"!=typeof this._callbacks[t])for(var n=0,o=this._callbacks[t];n<o.length;n++){var r=o[n],s=r.call(this,e);if(s===!1)return!1}return!0},r.prototype._getMouse=function(t){var e=this._canvas,i=0,n=0;if(e.offsetParent){do i+=e.offsetLeft,n+=e.offsetTop;while(e=e.offsetParent);e=this._canvas;do"BODY"!==e.nodeName&&(n-=e.scrollTop,i-=e.scrollLeft);while(e=e.parentElement)}var o=this._border;i+=o.paddingLeft,n+=o.paddingTop,i+=o.borderLeft,n+=o.borderTop;var r={x:t.pageX-i,y:t.pageY-n};return r.x+=this.virtualCanvas.x,r.y+=this.virtualCanvas.y,r},r.prototype.getGlobalPoint=function(t,e){var i=this._canvas,n=0,o=0;if(i.offsetParent){do n+=i.offsetLeft,o+=i.offsetTop;while(i=i.offsetParent);i=this._canvas;do"BODY"!==i.nodeName&&(o-=i.scrollTop,n-=i.scrollLeft);while(i=i.parentElement)}var r=this._border;n+=r.paddingLeft,o+=r.paddingTop,n+=r.borderLeft,o+=r.borderTop;var s={x:t+n,y:e+o};return s.x-=this.virtualCanvas.x,s.y-=this.virtualCanvas.y,s},r.prototype.removeRelation=function(t,e){for(var i=this.getRelationsFromObject(t,!1,!0),n=[],o=0,r=i;o<r.length;o++){var s=r[o];s.end==e&&n.push(s)}n.length>0&&this.remove(n,!1)},r.prototype.setBackground=function(e,i){this._background=this.createHiDPICanvas(e.width,e.height),this._background.style.position="absolute",this._background.style.left="0",this._background.style.top="0",this._background.style.zIndex="0",this._background.getContext("2d").drawImage(e,0,0),this._canvas.style.backgroundColor="transparent",i&&(this.virtualCanvas.width=e.width,this.virtualCanvas.height=e.height,this._scrollBar=new t.Common.ScrollBar(this)),this.container.insertBefore(this._background,this._canvas)},r.prototype.trigger=function(t,e){this.emit(t,new n(e))},r.prototype.cleanBackground=function(){this.container.removeChild(this.container.firstChild),this._canvas.width=this.width,this._canvas.height=this.height,this.container.style.width=this.container.style.maxWidth=this.viewportWidth+"px",this.container.style.height=this.container.style.maxHeight=this.viewportHeight+"px",this._canvas.style.backgroundColor=t.Config.background},r.prototype.getRelationsFromObject=function(t,e,i){for(var n=[],o=0,r=this.items;o<r.length;o++){var s=r[o];if("relation"===s.baseType){var a=s;a.start!==t&&a.end!==t||(a.start===t&&i?n.push(s):a.end===t&&e?n.push(s):e||i||n.push(s))}}return n},r.prototype.centerToPoint=function(t,e){t-=this.virtualCanvas.viewportWidth/2,e-=this.virtualCanvas.viewportHeight/2,this._scrollBar.setPosition(t,e),this.renderAll(!0)},r.prototype.setSelectedElement=function(t){this.appendSelected(t,!0)},r.prototype.getContext=function(){return this._canvas.getContext("2d")},r.prototype.getImage=function(e){void 0===e&&(e=0);var i,n,o,r,s,a,l,h,c=this.items.slice(0);i=n=Number.MIN_VALUE,o=r=Number.MAX_VALUE;for(var u=0,d=c;u<d.length;u++){var p=d[u];"relation"!==p.baseType&&(p.x<o&&(o=p.x),p.y<r&&(r=p.y),p.width+p.x>i&&(i=p.width+p.x),p.y+p.height>n&&(n=p.y+p.height))}s=i-o+10+2*e,a=n-r+10+2*e;var f=this.createHiDPICanvas(s,a,1),y=f.getContext("2d");y.fillStyle=t.Config.background,y.fillRect(0,0,s,a),h=r-e-5,l=o-e-5;for(var v=0;v<c.length;v++)y.save(),c[v].render(y,l,h),y.restore();return f.toDataURL("image/png")},r.prototype.getElementByPosition=function(t,e){for(var i,n=this.items.length-1;n>=0;n--)if(i=this.items[n],i.isVisible(this.virtualCanvas)&&i.checkCollision(t,e))return i;return null},r.drawBanner=function(t){t.fillStyle="rgba(0, 0, 0, 0.15)",t.fillRect(0,0,114,16),t.font="12px Arial",t.fillStyle="#FFFFFF",t.fillText("loira-designer v0.5.7",2,12)},r.prototype.showEditor=function(t,e,i){var n=this.getGlobalPoint(t.x,t.y);this.textEditor.style.top=n.y+"px",this.textEditor.style.left=n.x+"px",this.textEditor.style.display="block",this.textEditor.style.width=t.width+"px",this.textEditor.style.height=t.height+"px",this.textEditor.focus(),this.textEditor.value=e;var o=this,r=this.on("mouse:down",function(){o.textEditor.style.display="none",i(o.textEditor.value),o.fall("mouse:down",r)})},r.prototype.restore=function(){},r.prototype.save=function(t){void 0===t&&(t=1)},r.prototype.getSelected=function(){return this._selected},r}();t.Canvas=d}(Loira||(Loira={}));var Loira;!function(t){var e=function(){function t(){}return t}();t.BaseController=e}(Loira||(Loira={}));var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Loira;!function(t){var e;!function(e){function i(t){for(var e="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<t;n++)e+=i.charAt(Math.floor(Math.random()*i.length));return e}function n(t){return Math.floor(1e7*Math.random())}function o(t,e){var i=(t.y2-t.y1)*(e.x2-e.x1)-(t.x2-t.x1)*(e.y2-e.y1);if(0===i)return!1;var n=e.y1-t.y1,o=e.x1-t.x1,r=(t.x2-t.x1)*n-(t.y2-t.y1)*o;return n=r/i,{x:e.x1+n*(e.x2-e.x1),y:e.y1+n*(e.y2-e.y1)}}function r(t){for(var e=t.split("."),i=window||this,n=0,o=e;n<o.length;n++){var r=o[n];i=i[r]}if("function"!=typeof i)throw new Error("function not found");return i}function s(t,e){t.sort(function(t,e){return t-e});for(var i=t.length-1;i>=0;i--)e.splice(t[i],1)}function a(e,i,n){t.Config.debug&&e<=t.Config.logLevel&&console.log("[Loira "+(new Date).getTime()+"] "+i)}var l=function(){function t(){this.x=0,this.y=0,this.width=0,this.height=0,this.centerObject=!1,this.maxOutGoingRelation=0,this.extras={},this.text="",this.selectable=!0,this.resizable=!0,this.draggable=!0}return t}();e.BaseOption=l;var h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(l);e.RelOption=h;var c=function(){function t(t,e,i,n){this.x1=t,this.y1=e,this.x2=i,this.y2=n}return t.prototype.xm=function(){return this.x2-this.x1},t.prototype.ym=function(){return this.y2-this.y1},t}();e.Line=c;var u=function(){function t(){}return t}();e.Region=u;var d=function(){function t(t,e){this.x=t,this.y=e}return t}();e.Point=d;var p=function(){function t(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n}return t}();e.Rect=p,e.createRandom=i,e.createRandomNumber=n,e.intersectPointLine=o,e.stringToFunction=r,e.removeWhole=s,e.logger=a}(e=t.util||(t.util={}))}(Loira||(Loira={}));var Loira;!function(t){var e=t.util.BaseOption,i=t.Animation,n=function(){function n(n){this._uid=t.util.createRandom(8),"undefined"==typeof n&&(n=new e),this.x="x"in n?n.x:0,this.y="y"in n?n.y:0,this.width="width"in n?n.width:0,this.height="height"in n?n.height:0,this.centerObject="centerObject"in n&&n.centerObject,this.maxOutGoingRelation="maxOutGoingRelation"in n?n.maxOutGoingRelation:0,this.extras="extras"in n?n.extras:{},this.text=n.text?n.text:"",this.selectable=!n.selectable||n.selectable,this.resizable=!n.resizable||n.resizable,this.draggable=!n.draggable||n.draggable,this._buttons=[],this._canvas=null,this.type="",this.baseType="",this.isSelected=!1,this.animation=new i(this)}return n.prototype.render=function(t,e,i){this.animation.proccess()},n.prototype.checkCollision=function(t,e){return t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height},n.prototype.on=function(t){t?(t=[].splice.call(arguments,0),this._buttons=t):this._buttons=[]},n.prototype.move=function(t,e){this.x+=t,this.y+=e},n.prototype.renderButtons=function(e,i,n){var o=this.x+this.width+10,r=this.y;o-=i,r-=n,this._buttons.length>0&&this._buttons.forEach(function(i){t.drawable.render(i.icon,e,o,r),r+=t.drawable.get(i.icon).height+4})},n.prototype.callCustomButton=function(e,i){for(var n,o=this.x+this.width+10,r=this.y,s=0,a=this._buttons;s<a.length;s++){var l=a[s];if(n=t.drawable.get(l.icon),o<=e&&e<=o+n.width&&r<=i&&i<=r+n.height)return l.click.call(this),!0;r+=l.icon.height+4}return!1},n.prototype.drawSelected=function(e,i){void 0===i&&(i=!0);var n=this.x-2,o=this.y-2,r=this.width,s=this.height;n-=this._canvas.virtualCanvas.x,o-=this._canvas.virtualCanvas.y,e.beginPath(),e.lineWidth=2,e.setLineDash([5,5]),e.strokeStyle=t.Config.selected.color,e.rect(n,o,r+4,s+4),e.stroke(),e.setLineDash([]),this.resizable&&i&&(e.fillStyle=t.Config.selected.color,e.fillRect(n-4,o-4,8,8),e.fillRect(n+r,o+s,8,8),e.fillRect(n+r,o-4,8,8),e.fillRect(n-4,o+s,8,8),e.fillRect(n+r/2,o-4,8,8),e.fillRect(n+r/2,o+s,8,8),e.fillRect(n-4,o+s/2,8,8),e.fillRect(n+r,o+s/2,8,8)),e.strokeStyle="#000000",e.fillStyle="#000000"},n.prototype.getSelectedCorner=function(t,e){if(!this.resizable)return"";var i=this.x-2,n=this.y-2,o=this.width,r=this.height,s=o/2,a=r/2;return i-4<=t&&t<=i+4&&n-4<=e&&e<=n+4?"tl":i+o<=t&&i+o+8>=t&&n-4<=e&&n+4>=e?"tr":i+o<=t&&i+o+8>=t&&n+r<=e&&n+r+8>=e?"br":i-4<=t&&i+4>=t&&n+r<=e&&n+r+8>=e?"bl":i+s<=t&&i+s+8>=t&&n-4<=e&&n+4>=e?"tc":i+s<=t&&i+s+8>=t&&n+r<=e&&n+r+8>=e?"bc":i-4<=t&&i+4>=t&&n+a<=e&&n+a+8>=e?"ml":i+o<=t&&i+o+8>=t&&n+a<=e&&n+a+8>=e?"mr":""},n.prototype.show=function(){this._canvas.centerToPoint(this.x+this.width/2,this.y+this.height/2)},n.prototype.attach=function(t){this._canvas=t,this.animation.setFps(t.fps)},n.prototype.isVisible=function(t){var e=null,i=null,n=null,o=null;return t.area>this.width*this.height?(e={x:this.x,y:this.y},i={x:this.x+this.width,y:this.y+this.height},n={x:t.x,y:t.y},o={x:t.x+t.viewportWidth,y:t.y+t.viewportHeight}):(n={x:this.x,y:this.y},o={x:this.x+this.width,y:this.y+this.height},e={x:t.x,y:t.y},i={x:t.x+t.viewportWidth,y:t.y+t.viewportHeight}),e.x>n.x&&e.x<o.x&&e.y>n.y&&e.y<o.y||(e.x>n.x&&e.x<o.x&&i.y>n.y&&i.y<o.y||(i.x>n.x&&i.x<o.x&&e.y>n.y&&e.y<o.y||i.x>n.x&&i.x<o.x&&i.y>n.y&&i.y<o.y))},n.prototype.animateTo=function(t,e){void 0===e&&(e=1);this._canvas.fps*e},n.prototype.destroy=function(){this._canvas=null},n.prototype.getMenu=function(t,e){return this.menu},n}();t.Element=n}(Loira||(Loira={}));var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Loira;!function(t){var e;!function(e){var i,n=t.util.Point,o=t.util.Line,r=t.util.BaseOption,s=t.util.Rect;!function(t){t[t.STRAIGHT=1]="STRAIGHT",t[t.CURVE=2]="CURVE",t[t.CARTESIAN=3]="CARTESIAN"}(i=e.TypeLine||(e.TypeLine={}));var a=function(e){function r(t){var o=e.call(this,t)||this;return o.start=t.start?t.start:null,o.end=t.end?t.end:null,o.isDashed=!!t.isDashed&&t.isDashed,o.points=t.points?t.points:[new n,new n],o.icon=t.icon?t.icon:"",o.typeLine=t.typeLine?t.typeLine:i.STRAIGHT,o.baseType="relation",o.start._uid===o.end._uid&&o.selfRelated(),o}return __extends(r,e),r.prototype.render=function(e,i,n){var r,a,l,h,c,u,d,p,f=[],y=0;r=new s(this.start.x,this.start.y,this.start.width,this.start.height),a=new s(this.end.x,this.end.y,this.end.width,this.end.height),this.points[0]={x:r.x+r.width/2,y:r.y+r.height/2},this.points[this.points.length-1]={x:a.x+a.width/2,y:a.y+a.height/2},h=this.points[0],c=this.points[1],e.beginPath(),e.lineWidth=1,e.moveTo(h.x-i,h.y-n),this.isDashed&&e.setLineDash([5,5]);for(var v=0;v<this.points.length;v++)e.lineTo(this.points[v].x-i,this.points[v].y-n),v>0&&(f[v-1]=Math.sqrt(Math.pow(this.points[v].x-this.points[v-1].x,2)+Math.pow(this.points[v].y-this.points[v-1].y,2)),y+=f[v-1]);if(e.stroke(),e.setLineDash([]),this.icon){h=this.points[this.points.length-2],c=this.points[this.points.length-1],u=c.x-h.x,d=c.y-h.y,l=Math.atan(d/u),u<0&&(l+=Math.PI),e.translate(c.x-i,c.y-n),e.rotate(l),p=new o(h.x,h.y,c.x,c.y);var g=t.drawable.get(this.icon),x=this.end.obtainBorderPos(p,e);t.drawable.render(this.icon,e,-(g.width+x),-Math.ceil(g.height/2)),e.rotate(-l),e.translate(-c.x-i,-c.y-n)}if(this.text||this.text.length>0){e.font=t.Config.fontSize+"px "+t.Config.fontType;var _=0,m=0,w=0;if(2==this.points.length)h=this.points[0],c=this.points[1],p=new o(h.x,h.y,c.x,c.y),_=this.end.obtainBorderPos(p,e),m=this.start.obtainBorderPos(p,e);else{m=this.start.obtainBorderPos(new o(this.points[0].x,this.points[0].y,this.points[1].x,this.points[1].y),e),_=this.end.obtainBorderPos(new o(this.points[this.points.length-2].x,this.points[this.points.length-2].y,this.points[this.points.length-1].x,this.points[this.points.length-1].y),e),w=(y-m-_)/2+m;for(var v=0;w-f[v]>0;)w-=f[v],v++;h=this.points[v],c=this.points[v+1],0!==v&&(m=0),v!==this.points.length-2&&(_=0)}var b=c.x-h.x,L=c.y-h.y,C=Math.sqrt(Math.pow(b,2)+Math.pow(L,2)),S=2==this.points.length?(C-_-m)/2+m:w,T=Math.floor(L/C*S),P=Math.floor(b/C*S);l=e.measureText(this.text).width,e.fillStyle=t.Config.background,e.fillRect(h.x+i+P-l/2,h.y+n+T-13,l,12),e.fillStyle="#000000",e.fillText(this.text,h.x+i+P-l/2,h.y+n+T-3),e.font=t.Config.fontSize+"px "+t.Config.fontType}},r.prototype.recalculateBorders=function(){},r.prototype.update=function(t,e){return this.start=t,this.end=e,this},r.prototype.checkCollision=function(t,e){for(var i,n=null,o=null,r=0,s=0,a={x:0,y:0},l={x:0,y:0},h=0,c=0,u=1;u<this.points.length;u++)if(n=this.points[u-1],o=this.points[u],a.x=n.x,a.y=n.y,l.y=o.y,l.x=o.x,n.x>o.x&&(a.x=o.x,l.x=n.x),n.y>o.y&&(a.y=o.y,l.y=n.y),t>a.x-5&&t<l.x+5&&e>a.y-5&&e<l.y+5)if(s=Math.abs(o.y-n.y),r=Math.abs(o.x-n.x),h=Math.abs(t-n.x),c=Math.abs(e-n.y),r>s){if(i=Math.abs(s/r*h),0===i&&c>a.y&&c<l.y||i>c-8&&i<c+8)return!0}else if(i=Math.abs(r/s*c),0===i&&h>a.x&&h<l.x||i>h-8&&i<h+8)return!0;return!1},r.prototype.drawSelected=function(e){e.beginPath(),e.fillStyle=t.Config.selected.color;for(var i=this._canvas.virtualCanvas.x,n=this._canvas.virtualCanvas.y,o=0;o<this.points.length;o++)e.fillRect(this.points[o].x-4-i,this.points[o].y-4-n,8,8);e.strokeStyle="#000000"},r.prototype.addPoint=function(){var t=this.points[1],e=this.points[0],i=Math.round((t.x-e.x)/2)+e.x,n=Math.round((t.y-e.y)/2)+e.y;this.points.splice(1,0,{x:i,y:n})},r.prototype.removePoint=function(t){this.points.splice(t,1)},r.prototype.getSelectedCorner=function(t,e){for(var i=1;i<this.points.length-1;i++){var n=this.points[i].x-4,o=this.points[i].y-4,r=n+8,s=o+8;if(t>n&&t<r&&e>o&&e<s)return i}return!1},r.prototype.movePoint=function(t,e,i){this.points[t].x+=e,this.points[t].y+=i},r.prototype.isVisible=function(t){return!0},r.prototype.getMenu=function(t,e){return this.selectedArea=this.getSelectedCorner(t,e),this.selectedArea?this.pointMenu||this.menu:this.menu},r.prototype.move=function(t,e){if(this.points.length>2)for(var i=1;i<this.points.length-1;i++)this.points[i].x+=t,this.points[i].y+=e},r.prototype.selfRelated=function(){var t=this.start.x+this.start.width+30,e=this.start.y+this.start.height/2;this.points=[],this.points.push(new n),this.points.push(new n(t,e)),this.points.push(new n(t,this.start.y-30)),this.points.push(new n(this.start.x+this.start.width/2,this.start.y-30)),this.points.push(new n)},r}(t.Element);e.Relation=a;var l=function(e){function i(t){var i=e.call(this,t)||this,n=i._linkSymbol;return i.on({icon:"arrow",click:n}),i.baseType="symbol",i}return __extends(i,e),i.prototype._linkSymbol=function(){var e=this,i=this._canvas.on("mouse:down",function(n){var o=e._canvas,r=o.getRelationsFromObject(e,!1,!0).length;if(!e.maxOutGoingRelation||r<e.maxOutGoingRelation)for(var s=0,a=o.items;s<a.length;s++){var l=a[s];if("relation"!==l.baseType&&l.checkCollision(n.x,n.y)){var h=t.util.stringToFunction(o.defaultRelation);o.add(new h({}).update(e,l));break}}o.fall("mouse:down",i)})},i.prototype.splitText=function(t,e,i){void 0===i&&(i=10);for(var n=e.split(" "),o="",r=[],s=0;s<n.length;s++)t.measureText(o+n[s]).width>this.width-i?(r.push(o),o=n[s]+" "):o=o+" "+n[s];return r.push(o),r},i.prototype.drawText=function(e,i,n,o){var r,s,a=this.x-n+this.width/2,l=this.y-o+this.height/2;s=this.splitText(e,i),r=l+3-(6*s.length+3*s.length)/2;for(var h=0;h<s.length;h++){var c=e.measureText(s[h]).width;e.fillText(s[h],a-c/2,r+3),r=r+t.Config.fontSize+3}},i}(t.Element);e.Symbol=l;var h=function(e){function i(t){var i=e.call(this,t)||this;return i.text=t.text?t.text:"Actor1",i.width=30,i.height=85,i.type="actor",i}return __extends(i,e),i.prototype.obtainBorderPos=function(e,i){i.font=t.Config.fontSize+"px "+t.Config.fontType;var n=i.measureText(this.text).width,r=e.x2-e.x1,s=e.y2-e.y1;n>this.width&&(this.x=this.x+this.width/2-n/2,this.width=n);var a=Math.atan(s/r);r<0&&(a+=Math.PI);var l=null;return l=a>-.8&&a<.68||a>2.46&&a<4?t.util.intersectPointLine(e,new o(this.x,(-100),this.x,100)):t.util.intersectPointLine(e,new o((-100),this.y,100,this.y)),Math.sqrt(Math.pow(l.x-(this.x+this.width/2),2)+Math.pow(l.y-(this.y+this.height/2),2))},i.prototype.render=function(e,i,n){var o=e.measureText(this.text).width;
o>this.width&&(this.x=this.x+this.width/2-o/2,this.width=o);var r=this.x-i,s=this.y-n;e.fillStyle=t.Config.background,e.fillRect(r,s,this.width,this.height),e.fillStyle="#000000",t.drawable.render("actor",e,r+this.width/2-15,s),e.font=t.Config.fontSize+"px "+t.Config.fontType,e.fillStyle="#000000",e.fillText(this.text,r,s+80)},i.prototype.recalculateBorders=function(){},i}(e.Symbol);e.Actor=h;var c=function(e){function i(t){var i=e.call(this,new r)||this;return i.type="scrollBar",i.width=t.virtualCanvas.viewportWidth,i.height=t.virtualCanvas.viewportHeight,i._horPos=t.virtualCanvas.x,i._verPos=t.virtualCanvas.y,i._horSize=Math.floor(i.width*(i.width/t.virtualCanvas.width)),i._verSize=Math.floor(i.height*(i.height/t.virtualCanvas.height)),i._virtual=t.virtualCanvas,i._canvas=t,i}return __extends(i,e),i.prototype.render=function(e){var i=t.Config.scrollBar;this._virtual.width>this._virtual.viewportWidth&&(e.fillStyle=i.background,e.fillRect(0,this.height-i.size,this._virtual.viewportWidth,i.size),e.fillStyle=i.color,e.fillRect(this._horPos,this.height-i.size,this._horSize,i.size)),this._virtual.height>this._virtual.viewportHeight&&(e.fillStyle=i.background,e.fillRect(this.width-i.size,0,i.size,this._virtual.viewportHeight),e.fillStyle=i.color,e.fillRect(this.width-i.size,this._verPos,i.size,this._verSize)),e.fillStyle="#000000"},i.prototype.recalculateBorders=function(){},i.prototype.checkCollision=function(e,i){var n=this._virtual,o=e-n.x,r=i-n.y;return o>this._horPos&&o<this._horPos+this._horSize&&r>n.viewportHeight-t.Config.scrollBar.size&&r<n.viewportHeight?(this.selected="H",!0):o>n.viewportWidth-t.Config.scrollBar.size&&o<n.viewportWidth&&r>this._verPos&&r<this._verPos+this._verSize?(this.selected="V",!0):(this.selected=null,!1)},i.prototype.addMovement=function(t,e,i){void 0===i&&(i=30);var n,o=this._virtual,r=this._canvas._background;"H"===t?(n=this._horPos+e*i,n<0?this._horPos=0:n+this._horSize>o.viewportWidth?this._horPos=o.viewportWidth-this._horSize:this._horPos=n,o.x=Math.floor(o.width*(this._horPos/o.viewportWidth)),r&&(r.style.marginLeft="-"+o.x+"px")):"V"===t&&(n=this._verPos+e*i,n<0?this._verPos=0:n+this._verSize>o.viewportHeight?this._verPos=o.viewportHeight-this._verSize:this._verPos=n,o.y=Math.floor(o.height*(this._verPos/o.viewportHeight)),r&&(r.style.marginTop="-"+o.y+"px"))},i.prototype.addMovementWheel=function(t,e,i){void 0===i&&(i=30);var n,o=this._virtual,r=this._canvas._background;"H"===t?(n=this._horPos+Math.round(e*o.viewportWidth*(i/o.width)),n<0?this._horPos=0:n+this._horSize>o.viewportWidth?this._horPos=o.viewportWidth-this._horSize:this._horPos=n,o.x=Math.floor(o.width*(this._horPos/o.viewportWidth)),r&&(r.style.marginLeft="-"+o.x+"px")):"V"===t&&(n=this._verPos+Math.round(e*o.viewportHeight*(i/o.height)),n<0?this._verPos=0:n+this._verSize>o.viewportHeight?this._verPos=o.viewportHeight-this._verSize:this._verPos=n,o.y=Math.floor(o.height*(this._verPos/o.viewportHeight)),r&&(r.style.marginTop="-"+o.y+"px"))},i.prototype.setPosition=function(t,e){var i=this._virtual,n=this._canvas._background;t=t<0?0:t,e=e<0?0:e,i.x=t,i.y=e,this._horPos=Math.floor(i.x*i.viewportWidth/i.width),this._verPos=Math.floor(i.y*i.viewportHeight/i.height),n&&(n.style.marginTop="-"+i.y+"px",n.style.marginLeft="-"+i.x+"px")},i.prototype.isSelectable=function(){return!!this.selected},i.prototype.dragScroll=function(t,e){this.addMovement(this.selected,"H"===this.selected?t:e,1)},i}(t.Element);e.ScrollBar=c}(e=t.Common||(t.Common={}))}(Loira||(Loira={}));var Loira;!function(t){var e,i=12,n="Arial",o={color:"#339966"},r=!0,s="#aacccc",a="../assets/glyphs.png",l={actor:{x:0,y:30,width:30,height:60},spear:{x:0,y:0,width:14,height:15},spear1:{x:0,y:15,width:15,height:15},spear2:{x:15,y:0,width:15,height:15},spear3:{x:30,y:15,width:15,height:15},arrow:{x:15,y:15,width:15,height:15},start1:{x:30,y:15,width:15,height:15},end1:{x:30,y:30,width:15,height:15},start2:{x:30,y:45,width:15,height:15},end2:{x:30,y:60,width:15,height:15}},h={size:10,color:"rgba(255, 255, 255, 0.85)",background:"rgba(0, 0, 0, 0.15)"},c={roleWidth:150},u={menu:{joinTo:"Unir a...",deleteBtn:"Borrar",property:"Propiedades"}};!function(t){t[t.INFO=99]="INFO",t[t.SYSTEM=2]="SYSTEM",t[t.WARNING=1]="WARNING",t[t.DANGER=0]="DANGER"}(e=t.LogLevel||(t.LogLevel={}));var d;!function(t){t.fontSize=i,t.fontType=n,t.selected=o,t.background=s,t.assetsPath=a,t.regions=l,t.debug=!1,t.logLevel=e.SYSTEM,t.scrollBar=h,t.orgChart=c,t.showBanner=r,t.workflow=u}(d=t.Config||(t.Config={}))}(Loira||(Loira={}));var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Relation;!function(t){var e=Loira.Common,i=function(t){function e(e){var i=t.call(this,e)||this;return i.type="association",i}return __extends(e,t),e}(e.Relation);t.Association=i;var n=function(t){function e(e){var i=this;return e.icon="spear",i=t.call(this,e)||this,i.type="direct_association",i}return __extends(e,t),e}(e.Relation);t.DirectAssociation=n;var o=function(t){function e(e){var i=this;return e.icon="spear2",i=t.call(this,e)||this,i.type="generalization",i}return __extends(e,t),e}(e.Relation);t.Generalization=o;var r=function(t){function e(e){var i=this;return e.icon="spear2",e.isDashed=!0,i=t.call(this,e)||this,i.type="realization",i}return __extends(e,t),e}(e.Relation);t.Realization=r;var s=function(t){function e(e){var i=this;return e.icon="spear1",e.isDashed=!0,i=t.call(this,e)||this,i.type="dependency",i}return __extends(e,t),e}(e.Relation);t.Dependency=s}(Relation||(Relation={})),Loira.XmiParser={load:function(t,e){var i,n,o=null;if(window.DOMParser){var r=new DOMParser;o=r.parseFromString(t,"text/xml")}else o=new ActiveXObject("Microsoft.XMLDOM"),o.async=!1,o.loadXML(t);var s=this._parse(o),a={};for(n in s.symbols)s.symbols.hasOwnProperty(n)&&(i=s.symbols[n],"UML:UseCase"===i.type?a[i.id]=new UseCase.UseCase({text:i.name}):"UML:Actor"===i.type&&(a[i.id]=new Common.Actor({text:i.name})),e.add(a[i.id]));for(n in s.relations)if(s.relations.hasOwnProperty(n)&&(i=s.relations[n],"UML:Association"===i.type)){for(var l={},h=0;h<i.connection.length;h++)"source"===i.connection[h].taggedValues.ea_end?l.start=a[i.connection[h].type]:"target"===i.connection[h].taggedValues.ea_end&&(l.end=a[i.connection[h].type]);e.addRelation(new Relation.Association(l))}setTimeout(function(){e.renderAll()},50)},_parse:function(t){var e=this._xmlToJson(t),i=e.XMI["XMI.content"]["UML:Model"]["UML:Namespace.ownedElement"]["UML:Package"]["UML:Namespace.ownedElement"],n={},o={};for(var r in i)if(i.hasOwnProperty(r)&&"string"!=typeof i[r]){var s=i[r]["@attributes"]["xmi.id"];if("undefined"!=typeof i[r]["UML:Association.connection"]){o[s]={isAbstract:"true"===i[r]["@attributes"].isAbstract,isLeaf:"true"===i[r]["@attributes"].isLeaf,isRoot:"true"===i[r]["@attributes"].isRoot,visibility:i[r]["@attributes"].visibility,id:i[r]["@attributes"]["xmi.id"],type:r,connection:[]};for(var a=0;a<i[r]["UML:Association.connection"]["UML:AssociationEnd"].length;a++){for(var l=i[r]["UML:Association.connection"]["UML:AssociationEnd"][a],h={aggregation:l["@attributes"].aggregation,changeable:l["@attributes"].changeable,isNavigable:"true"===l["@attributes"].isNavigable,isOrdered:"true"===l["@attributes"].isOrdered,targetScope:l["@attributes"].targetScope,type:l["@attributes"].type,visibility:l["@attributes"].visibility,taggedValues:{}},c=0;c<l["UML:ModelElement.taggedValue"]["UML:TaggedValue"].length;c++){var u=l["UML:ModelElement.taggedValue"]["UML:TaggedValue"][c]["@attributes"];h.taggedValues[u.tag]=u.value}o[s].connection.push(h)}}else n[s]={isAbstract:"true"===i[r]["@attributes"].isAbstract,isLeaf:"true"===i[r]["@attributes"].isLeaf,isRoot:"true"===i[r]["@attributes"].isRoot,name:i[r]["@attributes"].name,namespace:i[r]["@attributes"].namespace,visibility:i[r]["@attributes"].visibility,id:i[r]["@attributes"]["xmi.id"],type:r}}return{symbols:n,relations:o}},_xmlToJson:function(t){var e={};if(1===t.nodeType){if(t.attributes.length>0){e["@attributes"]={};for(var i=0;i<t.attributes.length;i++){var n=t.attributes.item(i);e["@attributes"][n.nodeName]=n.nodeValue}}}else 3===t.nodeType&&(e=t.nodeValue);if(t.hasChildNodes())for(var o=0;o<t.childNodes.length;o++){var r=t.childNodes.item(o),s=r.nodeName;if("undefined"==typeof e[s])e[s]=this._xmlToJson(r);else{if("undefined"==typeof e[s].push){var a=e[s];e[s]=[],e[s].push(a)}e[s].push(this._xmlToJson(r))}}return e}};var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),UseCase;!function(t){var e=Loira.Common,i=function(t){function e(e){var i=t.call(this,e)||this;return i.width=100,i.height=70,i.text=e.text,i.type="use_case",i}return __extends(e,t),e.prototype.obtainBorderPos=function(t,e){var i=this.width/2,n=this.height/2,o=t.xm(),r=t.ym(),s=i*n/Math.sqrt(i*i*r*r+n*n*o*o);return Math.sqrt(Math.pow(s*r,2)+Math.pow(s*o,2))},e.prototype.render=function(t,e,i){if(t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType,this.text){var n=this.x-e,o=this.y-i,r=.5522848,s=this.width/2*r,a=this.height/2*r,l=n+this.width,h=o+this.height,c=n+this.width/2,u=o+this.height/2;t.beginPath(),t.lineWidth=2,t.moveTo(n,u),t.bezierCurveTo(n,u-a,c-s,o,c,o),t.bezierCurveTo(c+s,o,l,u-a,l,u),t.bezierCurveTo(l,u+a,c+s,h,c,h),t.bezierCurveTo(c-s,h,n,u+a,n,u),t.stroke(),t.fillStyle="#fcf5d9",t.fill(),t.fillStyle="#000000",this.drawText(t,this.text,e,i)}},e.prototype.recalculateBorders=function(){},e}(e.Symbol);t.UseCase=i;var n=function(t){function e(e){var i=this;return e.icon="spear1",e.text="<< extends >>",e.isDashed=!0,i=t.call(this,e)||this,i.type="extends",i}return __extends(e,t),e}(e.Relation);t.Extends=n;var o=function(t){function e(e){var i=this;return e.icon="spear1",e.text="<< include >>",e.isDashed=!0,i=t.call(this,e)||this,i.type="include",i}return __extends(e,t),e}(e.Relation);t.Include=o}(UseCase||(UseCase={}));var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Box;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(Loira.util.BaseOption);t.ColorOption=e;var i=function(t){function e(e){var i=t.call(this,e)||this;return i.width="width"in e?e.width:30,i.height="height"in e?e.height:30,i.color="color"in e?e.color:"rgba(0,0,0,0.3)",i.baseType="box",i}return __extends(e,t),e.prototype.render=function(t,e,i){t.fillStyle=this.color;var n=this.x-e,o=this.y-i;t.fillRect(n,o,this.width,this.height),t.fillText(this.text,n,o-10)},e.prototype.recalculateBorders=function(){},e}(Loira.Element);t.Box=i}(Box||(Box={}));var Loira;!function(t){var e=function(){function t(t){this._registers=[],this._element=t}return t.prototype.moveTo=function(t,e,i){void 0===i&&(i=1);this._fps*i;this._isRunning=!0},t.prototype.setFps=function(t){this._fps=t},t.prototype.proccess=function(){this._isRunning&&0==this._registers.length&&(this._isRunning=!1)},t}();t.Animation=e}(Loira||(Loira={}));var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Workflow;!function(t){var e=Loira.util.BaseOption,i=Loira.util.Line,n=Loira.BaseController,o=Loira.Common,r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(e);t.WorkflowOption=r;var s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.iteratorKey=0,e}return __extends(e,t),e.prototype.bind=function(t){var e=this;this.canvas=t,t.defaultRelation="Workflow.Association",t.on(Loira.event.OBJECT_PRE_ADD,function(e){if("parallel_start"===e.selected.type||"parallel_end"===e.selected.type||"mono_parallel_start"===e.selected.type||"mono_parallel_end"===e.selected.type)for(var i=0,n=t.items;i<n.length;i++){var o=n[i];if(o.type==e.selected.type&&o.key==e.selected.key)return t.emit(Loira.event.ERROR_MESSAGE,{message:"Existe un nodo con la misma llave en el diagrama."}),!1}}),t.on(Loira.event.RELATION_PRE_ADD,function(e){if(("parallel_start"===e.selected.end.type||"mono_parallel_start"===e.selected.end.type)&&"returns"===e.selected.type)return t.emit(Loira.event.ERROR_MESSAGE,{message:"No es posible retornar a un nodo inicio de paralelismo."}),!1;if(("parallel_start"===e.selected.start.type||"parallel_end"===e.selected.start.type||"mono_parallel_start"===e.selected.start.type||"mono_parallel_end"===e.selected.start.type)&&"returns"===e.selected.type)return t.emit(Loira.event.ERROR_MESSAGE,{message:"No es posible retornar desde un nodo de paralelismo."}),!1;if("mono_parallel_start"===e.selected.start.type&&"process"!==e.selected.end.type&&"decision"!==e.selected.end.type)return t.emit(Loira.event.ERROR_MESSAGE,{message:"El siguiente estado de un nodo de paralelismo monotarea debe ser decisión o proceso."}),!1;if("fork_parallel"===e.selected.start.type&&"workflow_fork_continuity"===e.selected.type)for(var i=t.getRelationsFromObject(e.selected.start,!1,!0),n=0,o=i;n<o.length;n++){var r=o[n];if("workflow_fork_continuity"===r.type)return t.emit(Loira.event.ERROR_MESSAGE,{message:"Ya existe una relación de continuidad para el nodo de bifurcación."}),!1}}),t.on(Loira.event.OBJECT_ADDED,function(t){"parallel_start"!==t.selected.type&&"mono_parallel_start"!==t.selected.type||t.selected.label||(e.iteratorKey++,t.selected.label=e.iteratorKey)})},e.prototype.load=function(t){},e.prototype.exportData=function(){},e.prototype.defineLabelId=function(){for(var t={},e=0,i=this.canvas.items;e<i.length;e++){var n=i[e];"parallel_start"!==n.type&&"mono_parallel_start"!==n.type||t[n.key]||(t[n.key]=n.label)}for(var o=0,r=this.canvas.items;o<r.length;o++){var n=r[o];"parallel_end"!==n.type&&"mono_parallel_end"!==n.type||(n.label=t[n.key])}},e}(n);t.Controller=s;var a=function(t){function e(e){var i=t.call(this,e)||this;i.startPoint=!!e.startPoint&&e.startPoint,i.endPoint=!!e.endPoint&&e.endPoint;var n=i;return i.menu=[{text:Loira.Config.workflow.menu.joinTo,callback:function(){n._linkSymbol()}},{text:Loira.Config.workflow.menu.deleteBtn,callback:function(){n._canvas.remove([n])}}],i}return __extends(e,t),e.prototype._linkSymbol=function(t){var e=this,i=t?t:this._canvas.defaultRelation,n=this._canvas.on("mouse:down",function(t){var o=e._canvas;if(!e.maxOutGoingRelation||o.getRelationsFromObject(e,!1,!0).length<e.maxOutGoingRelation)for(var r=0,s=o.items;r<s.length;r++){var a=s[r];if("relation"!==a.baseType&&!a.startPoint&&a.checkCollision(t.x,t.y)&&!e.endPoint){var l=Loira.util.stringToFunction(i);o.add(new l({start:e,end:a}));break}}o.fall("mouse:down",n)})},e}(o.Symbol);t.Symbol=a;var l=function(t){function e(e){var i=this;return e.width=e.width?e.width:100,e.height=e.height?e.height:70,i=t.call(this,e)||this,i.text=e.text,i.type="process",i.borders={bottomLeft:0,topLeft:0,topRight:0,bottomRight:0},i.recalculateBorders(),i.maxOutGoingRelation=1,i}return __extends(e,t),e.prototype.obtainBorderPos=function(t,e){var n=t.x2-t.x1,o=t.y2-t.y1,r=Math.atan(o/n);n<0&&(r+=Math.PI);var s={x:100,y:this.y-10};s=r>this.borders.bottomLeft&&r<this.borders.topLeft||r>this.borders.topRight&&r<this.borders.bottomRight?Loira.util.intersectPointLine(t,new i(this.x,(-100),this.x,100)):Loira.util.intersectPointLine(t,new i((-100),this.y,100,this.y));var a=s.x-(this.x+this.width/2),l=s.y-(this.y+this.height/2);return Math.sqrt(Math.pow(a,2)+Math.pow(l,2))},e.prototype.render=function(t,e,i){t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType,t.beginPath(),t.lineWidth=2,t.rect(this.x-e,this.y-i,this.width,this.height),t.stroke(),t.fillStyle="#fcf5d9",t.fill(),t.fillStyle="#000000",this.drawText(t,this.text,e,i)},e.prototype.recalculateBorders=function(){var t=Math.round(this.width/2),e=Math.round(this.height/2);this.borders.bottomLeft=Math.atan(-e/t),this.borders.topLeft=Math.atan(e/t),this.borders.topRight=Math.atan(e/-t)+Math.PI,this.borders.bottomRight=Math.atan(-e/-t)+Math.PI},e}(a);t.Process=l;var h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.obtainBorderPos=function(t,e){var i=t.x2-t.x1,n=t.y2-t.y1,o=this.width/2,r=this.height/2,s=o*r/Math.sqrt(o*o*n*n+r*r*i*i);return Math.sqrt(Math.pow(s*n,2)+Math.pow(s*i,2))},e.prototype.render=function(t,e,i){t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType;var n=this.x-e,o=this.y-i,r=n+this.width-20,s=o+this.height;n+=20,t.beginPath(),t.lineWidth=2,t.moveTo(n,o),t.lineTo(r,o),t.bezierCurveTo(r+30,o,r+30,s,r,s),t.lineTo(n,s),t.bezierCurveTo(n-30,s,n-30,o,n,o),t.stroke(),t.fillStyle="#fcf5d9",t.fill(),t.fillStyle="#000000",this.drawText(t,this.text,e,i)},e.prototype.recalculateBorders=function(){},e}(a);t.Terminator=h;var c=function(t){function e(e){var i=this;return e.width=e.width?e.width:100,e.height=e.height?e.height:30,i=t.call(this,e)||this,i.text="INICIO",i.startPoint=!0,i.maxOutGoingRelation=1,i.resizable=!1,i.type="start_terminator",i}return __extends(e,t),e}(h);t.StartTerminator=c;var u=function(t){function e(e){var i=t.call(this,e)||this;return i.width=70,i.height=30,i.text="FIN",i.endPoint=!0,i.type="end_terminator",i.resizable=!1,i}return __extends(e,t),e}(h);t.EndTerminator=u;var d=function(t){function e(e){var i=t.call(this,e)||this;return i.width=70,i.height=30,i.text="FIN",i.endPoint=!0,i.type="end_thread_terminator",i.resizable=!1,i}return __extends(e,t),e.prototype.obtainBorderPos=function(t,e){var i=t.x2-t.x1,n=t.y2-t.y1,o=this.width/2,r=this.height/2,s=o*r/Math.sqrt(o*o*n*n+r*r*i*i);return Math.sqrt(Math.pow(s*n,2)+Math.pow(s*i,2))},e.prototype.render=function(t,e,i){t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType;var n=this.x-e,o=this.y-i,r=n+this.width-20,s=o+this.height;n+=20,t.beginPath(),t.lineWidth=2,t.moveTo(n,o),t.lineTo(r,o),t.bezierCurveTo(r+30,o,r+30,s,r,s),t.lineTo(n,s),t.bezierCurveTo(n-30,s,n-30,o,n,o),t.setLineDash([5,5]),t.stroke(),t.fillStyle="#fcf5d9",t.fill(),t.fillStyle="#000000",this.drawText(t,this.text,e,i)},e.prototype.recalculateBorders=function(){},e}(a);t.ThreadTerminator=d;var p=function(t){function e(e){var i=this;return e.width=e.width?e.width:100,e.height=e.height?e.height:70,i=t.call(this,e)||this,i.text=e.text,i.type="data",i}return __extends(e,t),e.prototype.obtainBorderPos=function(t,e){var i=t.x2-t.x1,n=t.y2-t.y1,o=this.width/2,r=this.height/2,s=o*r/Math.sqrt(o*o*n*n+r*r*i*i);return Math.sqrt(Math.pow(s*n,2)+Math.pow(s*i,2))},e.prototype.render=function(t,e,i){t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType;var n=this.x-e,o=this.y-i,r=n+this.width,s=o+this.height;n+=20,t.beginPath(),t.lineWidth=2,t.moveTo(n,o),t.lineTo(r,o),t.lineTo(r-20,s),t.lineTo(n-20,s),t.lineTo(n,o),t.stroke(),t.fillStyle="#fcf5d9",t.fill(),t.fillStyle="#000000",this.drawText(t,this.text,e,i)},e.prototype.recalculateBorders=function(){},e}(a);t.Data=p;var f=function(t){function e(e){var i=this;return e.width=e.width?e.width:100,e.height=e.height?e.height:70,i=t.call(this,e)||this,i.text=e.text,i.type="decision",i}return __extends(e,t),e.prototype.obtainBorderPos=function(t,e){var n,o=t.x2-t.x1,r=t.y2-t.y1,s=this.x,a=this.y,l=this.x+this.width/2,h=this.y+this.height/2,c=this.x+this.width,u=this.y+this.height,d=Math.atan(h/o);return o<0&&(d+=Math.PI),r/=Math.abs(r),n=d>0&&d<1.6?r>0?Loira.util.intersectPointLine(t,new i(s,h,l,a)):Loira.util.intersectPointLine(t,new i(s,h,l,u)):r>0?Loira.util.intersectPointLine(t,new i(l,a,c,h)):Loira.util.intersectPointLine(t,new i(l,u,c,h)),s=n.x-(this.x+this.width/2),a=n.y-(this.y+this.height/2),Math.sqrt(Math.pow(s,2)+Math.pow(a,2))},e.prototype.render=function(t,e,i){t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType;var n=this.x-e,o=this.y-i;Loira.shape.drawDiamond(t,n,o,this.width,this.height),t.fillStyle="#000000",this.drawText(t,this.text,e,i)},e.prototype.recalculateBorders=function(){},e}(a);t.Decision=f;var y=function(t){function e(e){var i=this;e.icon="spear1",e.text=e.text||"<<returns>>",e.isDashed=!0,i=t.call(this,e)||this,i.type="returns";var n=i;return i.menu=[{text:"Partir",callback:function(){n.addPoint()}},{text:"Borrar",callback:function(){n._canvas.remove([n])}}],i.pointMenu=[{text:"Borrar punto",callback:function(){n.removePoint(n.selectedArea)}}],i}return __extends(e,t),e}(o.Relation);t.Returns=y;var v=function(t){function e(e){var i=this;e.icon="spear",i=t.call(this,e)||this,i.type="workflow_association";var n=i;return i.menu=[{text:"Partir",callback:function(){n.addPoint()}},{text:"Borrar",callback:function(){n._canvas.remove([n],!0)}}],i.pointMenu=[{text:"Borrar punto",callback:function(){n.removePoint(n.selectedArea)}}],i}return __extends(e,t),e}(o.Relation);t.Association=v;var g=function(t){function e(e){var i=this;return e.width=e.width?e.width:30,e.height=e.height?e.height:30,i=t.call(this,e)||this,i.unDefined="No definido",i.resizable=!1,i.key=e.key,i.label=e.labelId,i}return __extends(e,t),e.prototype.obtainBorderPos=function(t,e){var n,o=t.x2-t.x1,r=t.y2-t.y1,s=this.x,a=this.y,l=this.x+this.width/2,h=this.y+this.height/2,c=this.x+this.width,u=this.y+this.height,d=Math.atan(h/o);return o<0&&(d+=Math.PI),r/=Math.abs(r),n=d>0&&d<1.6?r>0?Loira.util.intersectPointLine(t,new i(s,h,l,a)):Loira.util.intersectPointLine(t,new i(s,h,l,u)):r>0?Loira.util.intersectPointLine(t,new i(l,a,c,h)):Loira.util.intersectPointLine(t,new i(l,u,c,h)),s=n.x-(this.x+this.width/2),a=n.y-(this.y+this.height/2),Math.sqrt(Math.pow(s,2)+Math.pow(a,2))},e.prototype.render=function(t,e,i){t.font="bold "+Loira.Config.fontSize+"px "+Loira.Config.fontType;var n=this.x-e,o=this.y-i;Loira.shape.drawDiamond(t,n,o,this.width,this.height),this.renderCustom(t,n,o)},e.prototype.recalculateBorders=function(){},e}(a);t.ParallelBase=g;var x=function(e){function i(i){var n=e.call(this,i)||this;n.type="parallel_start",n.key=n.key||Loira.util.createRandom(5);var o=n;return n.menu.push(null),n.menu.push({text:"Agregar punto de fin",callback:function(){o._canvas.add([new t.ParallelEnd({x:o.x,y:o.y+50,key:o.key,labelId:o.label})])}}),n}return __extends(i,e),i.prototype.renderCustom=function(t,e,i){t.fillStyle="#000000",t.beginPath(),t.arc(e+15,i+15,5,0,2*Math.PI,!1),t.fillStyle="#FFFFFF",t.fill(),t.lineWidth=3,t.strokeStyle="#000000",t.stroke(),t.fillStyle="#FF0000",t.fillText(this.label||this.unDefined,e+25,i+Loira.Config.fontSize-5)},i}(g);t.ParallelStart=x;var _=function(e){function i(i){var n=e.call(this,i)||this;n.type="parallel_end",n.maxOutGoingRelation=1;var o=n;return n.menu.push(null),n.menu.push({text:"Agregar punto de inicio",callback:function(){o._canvas.add([new t.ParallelStart({x:o.x,y:o.y+50,key:o.key,labelId:o.label})])}}),n}return __extends(i,e),i.prototype.renderCustom=function(t,e,i){t.beginPath(),t.arc(e+15,i+15,5,0,2*Math.PI,!1),t.fillStyle="#000000",t.fill(),t.lineWidth=3,t.strokeStyle="#000000",t.stroke(),t.fillStyle="#FF0000",t.fillText(this.label||this.unDefined,e+25,i+Loira.Config.fontSize-5)},i}(g);t.ParallelEnd=_;var m=function(e){function i(i){var n=e.call(this,i)||this;n.type="mono_parallel_start",n.key=n.key||Loira.util.createRandom(5);var o=n;return n.maxOutGoingRelation=1,n.menu.push(null),n.menu.push({text:"Agregar punto de fin",callback:function(){o._canvas.add([new t.MonoParallelEnd({x:o.x,y:o.y+50,key:o.key,labelId:o.label})])}}),n}return __extends(i,e),i.prototype.renderCustom=function(t,e,i){t.fillStyle="#000000",t.beginPath(),t.rect(e+10,i+10,10,10),t.fillStyle="#FFFFFF",t.fill(),t.lineWidth=3,t.strokeStyle="#000000",t.stroke(),t.fillStyle="#FF0000",t.fillText(this.label||this.unDefined,e+25,i+Loira.Config.fontSize-5)},i}(g);t.MonoParallelStart=m;var w=function(e){function i(i){var n=e.call(this,i)||this;n.type="mono_parallel_end",n.maxOutGoingRelation=1;var o=n;return n.menu.push(null),n.menu.push({text:"Agregar punto de inicio",callback:function(){o._canvas.add([new t.MonoParallelStart({x:o.x,y:o.y+50,key:o.key,labelId:o.label})])}}),n}return __extends(i,e),i.prototype.renderCustom=function(t,e,i){t.beginPath(),t.rect(e+10,i+10,10,10),t.fillStyle="#000000",t.fill(),t.lineWidth=3,t.strokeStyle="#000000",t.stroke(),t.fillStyle="#FF0000",t.fillText(this.label||this.unDefined,e+25,i+Loira.Config.fontSize-5)},i}(g);t.MonoParallelEnd=w;var b=function(t){function e(e){var i=t.call(this,e)||this;i.type="fork_parallel",i.key=i.key||Loira.util.createRandom(5);var n=i;return i.menu.push(null),i.menu.push({text:"Agregar via de continuidad",callback:function(){n._linkSymbol("Workflow.ForkContinuity")}}),i}return __extends(e,t),e.prototype.renderCustom=function(t,e,i){t.fillStyle="#000000",t.beginPath(),t.moveTo(e+15,i+8),t.lineTo(e+8,i+20),t.moveTo(e+15,i+10),t.lineTo(e+15,i+20),t.moveTo(e+15,i+10),t.lineTo(e+22,i+20),t.lineWidth=3,t.strokeStyle="#000000",t.stroke()},e}(g);t.Fork=b;var L=function(t){function e(e){var i=this;return e.icon="arrow",e.isDashed=!0,i=t.call(this,e)||this,i.type="workflow_fork_continuity",i}return __extends(e,t),e}(t.Association);t.ForkContinuity=L}(Workflow||(Workflow={}));var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),OrgChart;!function(t){var e,i=Loira.BaseController,n=Loira.util.RelOption,o=Loira.util.Rect,r=Loira.Common,s=["#124FFD","#FF4FFD","#12003D"],a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(Loira.util.BaseOption);t.RoleOption=a;var l=function(){function t(t){this.children=[],this.role=t,this.height=40}return t.prototype.recalculate=function(t){void 0===t&&(t=0),this.width=0,this.level=t;var i=t+1;e.length<=t&&e.push(this.role.height);for(var n=0;n<this.children.length;n++){var o=this.children[n];o.x=this.x+this.width,o.recalculate(i),this.width+=o.width}0===this.width&&(this.width=this.role.width+10),this.role.x=Math.floor(this.width/2-this.role.width/2)+this.x,this.role.isDuplicate||(this.role.color=s[t]),this.role.level=t,e[t]<this.role.height&&(e[t]=this.role.height)},t.prototype.getAllChildren=function(){var t=[];if(this.children.length>0)for(var e=0;e<this.children.length;e++){var i=this.children[e].getAllChildren();t.push(this.children[e]);for(var n=0;n<i.length;n++)t.push(i[n])}return t},t.prototype.getAllParent=function(){for(var t=[],e=this;e.parent;)t.push(e.parent),e=e.parent;return t},t}();t.Group=l;var h=function(i){function o(t,e){void 0===t&&(t=null),void 0===e&&(e=!0);var n=i.call(this)||this;return n.roots=[],n.elements=[],t&&(s=t),n.autoRefresh=e,n}return __extends(o,i),o.prototype.bind=function(e){var i=this;this.canvas=e,e.defaultRelation="OrgChart.Relation",e.on("object:added",function(t){var e=new l(t.selected);i.roots.push(e),i.elements.push(e),i.autoRefresh&&i.reorderElements()}),e.on("relation:pre-add",function(t){for(var n=e.getRelationsFromObject(t.selected.start,!1,!0),o=0,r=n;o<r.length;o++){var s=r[o];if(s.end==t.selected.end)return!1}var a=i.getGroup(t.selected.end,i.elements).item;if(a){var l=a.getAllChildren();l.push(a);for(var h=0;h<l.length;h++)if(l[h].role.id===t.selected.start.id&&l[h].role!=t.selected.start)return!1}}),e.on("object:selected",function(t){var i=t.selected;i.isDuplicate&&(e.centerToPoint(i.rolePrimary.x,i.rolePrimary.y),e.setSelectedElement(i.rolePrimary),setTimeout(function(){e.trigger("object:selected",i.rolePrimary)},300))}),e.on("relation:added",function(o){var r=i.getGroup(o.selected.end,i.roots).index,s=i.getGroup(o.selected.end,i.elements).item,a=i.getGroup(o.selected.start,i.elements).item;if(r>=0)i.roots.splice(r,1),a.parent==s&&i.roots.push(a);else{var l=s.parent.children;r=i.getGroup(s.role,l).index,l.splice(r,1);for(var h=e.getRelationsFromObject(o.selected.end,!0,!1),c=[],u=0,d=h;u<d.length;u++){var p=d[u];p.start!=a.role&&c.push(p)}c.length>0&&e.remove(c,!1)}if(a.parent==s){if(a.parent=s.parent,r=i.getGroup(a.role,s.children).index,s.children.splice(r,1),a.parent){a.parent.children.push(a);var f=new n;f.start=a.parent.role,f.end=a.role;var p=new t.Relation(f);e.add([p],!1)}e.removeRelation(s.role,a.role)}s.parent=a,a.children.push(s),i.autoRefresh&&(i.reorderElements(),e.renderAll(!0))}),e.on("object:removed",function(t){var n,o,r;if("relation"===t.selected.baseType)n=t.selected,o=i.getGroup(n.end,i.elements).item;else{r=i.getGroup(t.selected,i.elements).index,o=i.elements[r],i.elements.splice(r,1);for(var s=o.getAllChildren(),a=[],l=[],h=0;h<s.length;h++)l.push(i.elements.indexOf(s[h])),a.push(s[h].role);Loira.util.removeWhole(l,i.elements),e.remove(a,!1)}o.parent?(r=i.getGroup(o.role,o.parent.children).index,o.parent.children.splice(r,1)):(r=i.getGroup(o.role,i.roots).index,i.roots.splice(r,1)),n&&(o.parent=null,i.roots.push(o)),i.autoRefresh&&i.reorderElements()})},o.prototype.load=function(t){var e,i,o,r=[],s=[],h=this.canvas.readOnly;this.canvas.readOnly=!1;for(var d=0,p=t;d<p.length;d++){var f=p[d];if(e=new a,e.id=f.id?f.id.toString():"",e.personName=f.personName?f.personName.toString():null,e.title=f.title?f.title.toString():null,this.getGroupById(e.id).item&&(e.isDuplicate=!0),i=new l(new c(e)),h&&i.role.on(null),f.parent){var y=this.getGroupById(f.parent?f.parent.toString():"").item;y.children.push(i),i.parent=y,o=new n,o.start=y.role,o.end=i.role,s.push(new u(o))}else this.roots.push(i);this.elements.push(i),r.push(i.role)}this.canvas.add(r,!1),this.canvas.add(s,!1),this.canvas.readOnly=h},o.prototype.exportData=function(){for(var t=[],e=0,i=this.elements;e<i.length;e++){var n=i[e],o=n.parent;t.push({id:n.role.id,level:n.role.level,parent:o?o.role.id:null})}return t},o.prototype.reorderElements=function(){var t=0;e=[];for(var i=0,n=this.roots;i<n.length;i++){var o=n[i];o.x=t,o.recalculate(),t+=o.width}e[0]+=30;for(var r=1;r<e.length;r++)e[r]+=e[r-1]+30;for(var r=0;r<this.elements.length;r++){var s=this.elements[r];s.role.y=0===s.level?10:e[s.level-1]}},o.prototype.getGroup=function(t,e){e||(e=this.elements);for(var i=0;i<e.length;i++)if(e[i].role==t)return{item:e[i],index:i};return{item:null,index:-1}},o.prototype.getGroupById=function(t,e){e||(e=this.elements),t=t.trim();for(var i=0;i<e.length;i++)if(""!==t&&e[i].role.id==t)return{item:e[i],index:i};return{item:null,index:-1}},o}(i);t.Controller=h;var c=function(t){function e(e){var i=t.call(this,e)||this;return i.width=Loira.Config.orgChart.roleWidth,i.height=20,i.parent=e.parent,i.title=e.title,i.resizable=!1,i.draggable=!1,i.id=e.id,i.personName=e.personName?e.personName:"",i.isDuplicate=!!e.isDuplicate&&e.isDuplicate,i.type="role",i}return __extends(e,t),e.prototype.render=function(e,i,n){t.prototype.render.call(this,e,i,n);var o,r,s,a=this.x-i,l=this.y-n,h=a+this.width/2,c=0;this.personName&&(r={fontSize:Loira.Config.fontSize,lines:t.prototype.splitText.call(this,e,this.personName)},c=(r.fontSize+3)*r.lines.length+5),this.title&&(s={fontSize:Loira.Config.fontSize-(r?3:0),lines:t.prototype.splitText.call(this,e,this.title)},c+=(s.fontSize+3)*s.lines.length+5),o=l+Loira.Config.fontSize,this.height=c;var u,d,p=5;if(e.fillStyle=this.isDuplicate?"#000000":this.color,e.lineWidth=4,this.isSelected?(u="#00c0ff",
d=20,e.strokeStyle="#00c0ff",this.isSelected=!1):(u="#000000",d=10,e.strokeStyle="#000000"),this._canvas.userAgent!=Loira.UserAgent.FIREFOX&&(e.shadowColor=u,e.shadowBlur=d),Loira.shape.drawRoundRect(e,a,l,this.width,this.height,p),e.fillStyle="#FFFFFF",e.font=Loira.Config.fontSize+"px "+Loira.Config.fontType,r){for(var f=0;f<r.lines.length;f++){var y=e.measureText(r.lines[f]).width;e.fillText(r.lines[f],h-y/2,o+3),o=o+s.fontSize+3}o+=5,e.font="bold "+s.fontSize+"px "+Loira.Config.fontType}if(s)for(var f=0;f<s.lines.length;f++){var y=e.measureText(s.lines[f]).width;e.fillText(s.lines[f],h-y/2,o+3),o=o+s.fontSize+3}},e.prototype.recalculateBorders=function(){},e.prototype.obtainBorderPos=function(t,e){return 0},e.prototype.drawSelected=function(t){this.isSelected=!0,this.render(t,this._canvas.virtualCanvas.x,this._canvas.virtualCanvas.y)},e.prototype.attach=function(e){t.prototype.attach.call(this,e);var i=e.getContext(),n=0;this.personName&&(n+=(Loira.Config.fontSize+3)*t.prototype.splitText.call(this,i,this.personName).length+5),this.title&&(n+=(Loira.Config.fontSize+3-(this.personName?3:0))*t.prototype.splitText.call(this,i,this.title).length+5),this.height=n,e.readOnly&&this.on(null),this.isDuplicate&&this.setDuplicate()},e.prototype.setDuplicate=function(){for(var t=this._canvas.controller.elements,e=this._canvas.controller.getGroup(this).item,i=e.getAllParent(),n=!0,o=0;o<i.length;o++)if(this.id&&i[o].role.id===this.id){this.title=" ",this.id="",n=!1;break}if(n)for(var o=0;o<t.length;o++)if(t[o].role!==this&&t[o].role.id==this.id.trim()&&!t[o].role.isDuplicate){this.isDuplicate=!0,this.on(null),this.rolePrimary=t[o].role;break}},e.prototype.update=function(t){this.title=t.title,this.id=t.id.trim(),this.setDuplicate()},e}(r.Symbol);t.Role=c;var u=function(t){function e(e){var i=t.call(this,e)||this;return i.type="orgchart:relation",i}return __extends(e,t),e.prototype.render=function(t,e,i){var n,r,s=new o(this.start.x-e,this.start.y-i,this.start.width,this.start.height),a=new o(this.end.x-e,this.end.y-i,this.end.width,this.end.height);n=a.y-10,r={x:s.x+s.width/2,y:s.y+s.height/2},this.points[0]=r,this.points[1]={x:r.x,y:n},this.points[2]={x:a.x+a.width/2,y:n},this.points[3]={x:a.x+a.width/2,y:a.y+a.height/2},t.beginPath(),t.lineWidth=4,t.strokeStyle="rgba(255,255,255,0.5)",t.moveTo(r.x,r.y),t.lineJoin="round";for(var l=1;l<this.points.length;l++)t.lineTo(this.points[l].x,this.points[l].y);t.stroke()},e}(r.Relation);t.Relation=u}(OrgChart||(OrgChart={}));