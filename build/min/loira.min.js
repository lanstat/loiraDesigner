var Loira;!function(t){var e;!function(t){var e=function(){function t(t,e,i){this.x=t,this.y=e,this.type=i}return t}();t.MouseEvent=e;var i=function(){function t(t,e){this.selected=t,this.type=e}return t}();t.ObjectEvent=i;var n=function(){function t(t,e){this.selected=t,this.type=e}return t}();t.RelationEvent=n}(e=t.event||(t.event={}))}(Loira||(Loira={}));var Loira;!function(t){var e=t.event.RelationEvent,i=t.event.ObjectEvent,n=t.event.MouseEvent,o=(function(){function t(){this.x=0,this.y=0,this.w=0,this.h=0}return t}(),function(){function t(t){this._selected=null,this._isDragged=!1,this._tmp={},this.items=[],this._canvas=null,this._background=null,this._canvasContainer=null,this.defaultRelation=null,"string"==typeof t?this._canvas=document.getElementById(t):this._canvas=t,this._callbacks={},this.items=[],this.defaultRelation="Relation.Association",document.defaultView&&document.defaultView.getComputedStyle&&(this._border={paddingLeft:parseInt(document.defaultView.getComputedStyle(this._canvas,null).paddingLeft,10)||0,paddingTop:parseInt(document.defaultView.getComputedStyle(this._canvas,null).paddingTop,10)||0,borderLeft:parseInt(document.defaultView.getComputedStyle(this._canvas,null).borderLeftWidth,10)||0,borderTop:parseInt(document.defaultView.getComputedStyle(this._canvas,null).borderTopWidth,10)||0}),this._bind()}return t.prototype.renderAll=function(){var t=this._canvas.getContext("2d");t.clearRect(0,0,this._canvas.width,this._canvas.height),this._background&&t.drawImage(this._background,0,0);for(var e=0;e<this.items.length;e++)this.items[e]._render(t);this._selected&&(this._selected.drawSelected(t),this._selected._renderButtons(t))},t.prototype.add=function(t){t.length||(t=[].splice.call(arguments,0));for(var n=this.items,o=this,s=0,a=t;s<a.length;s++){var r=a[s];if(r._canvas=o,"relation"===r.baseType){var h=n.indexOf(r.start);h=h<n.indexOf(r.end)?h:n.indexOf(r.end),n.splice(h,0,r),o._emit("relation:added",new e(r,"relationadded"))}else"container"===r.baseType?(n.splice(0,0,r),o._emit("container:added",new i(r,"objectadded"))):(r.centerObject&&(o._canvasContainer?(r.x=o._canvasContainer.w/2+o._canvasContainer.x-r.width/2,r.y=o._canvasContainer.h/2+o._canvasContainer.y-r.height/2):(r.x=o._canvas.width/2,r.y=o._canvas.height/2)),n.push(r),o._emit("object:added",new i(r,"objectadded")))}},t.prototype.remove=function(t){t=[].splice.call(arguments,0);for(var e=this.items,n=this,o=0,s=t;o<s.length;o++){var a=s[o],r=[];a._canvas=null,r.push(e.indexOf(a));for(var h=0;h<e.length;h++)if("relation"===e[h].baseType){var l=e[h];l.start._uid!==a._uid&&l.end._uid!==a._uid||(l._canvas=null,r.push(h))}for(r.sort(),h=r.length-1;h>=0;h--)e.splice(r[h],1);n._emit("object:removed",new i(a,"objectremoved"))}this._selected=null},t.prototype.removeAll=function(){for(var t=0;t<this.items.length;t++)this.items[t]._canvas=null;this.items=[],this._selected=null},t.prototype.destroy=function(){this._canvas.onmousemove=null,this._canvas.onkeydown=null,this._canvas.onmousedown=null,this._canvas.onmouseup=null,this._canvas.ondblclick=null,this._canvas.onselectstart=null,this._canvasContainer&&this._canvasContainer.element.removeEventListener("scroll",this._canvasContainer.listener),this._canvasContainer=null,this._canvas=null},t.prototype.on=function(t,e){var i;if("string"==typeof t)return"undefined"==typeof this._callbacks[t]&&(this._callbacks[t]=[]),this._callbacks[t].push(e),e;if("object"==typeof t)for(i in t)t.hasOwnProperty(i)&&("undefined"==typeof this._callbacks[i]&&(this._callbacks[i]=[]),this._callbacks[i].push(t[i]));return null},t.prototype.fall=function(t,e){var i=this._callbacks[t].indexOf(e);i>-1&&this._callbacks[t].splice(i,1)},t.prototype._bind=function(){var t=this;t._canvas.onkeydown=function(e){var i=e.keyCode;46===i&&t._selected&&"relation"!==t._selected.baseType&&t.remove(t._selected)};var e=function(e,o){var s=t._getMouse(e);if(t._tmp.pointer=s,o?t._emit("mouse:dblclick",new n(s.x,s.y,"dblclick")):t._emit("mouse:down",new n(s.x,s.y,"mousedown")),t._selected){if(t._tmp.transform=t._selected.getSelectedCorner(s.x,s.y),t._tmp.transform||t._selected.callCustomButton(s.x,s.y))return;t._selected=null}for(var a,r=t.items.length-1;r>=0;r--)if(a=t.items[r],a.checkCollision(s.x,s.y)){if(t._selected=a,o||(t._isDragged=!0),"relation"!==a.baseType){o?t._emit("object:dblclick",new i(a,"objectdblclick")):t._emit("object:selected",new i(a,"objectselected"));break}o?t._emit("relation:dblclick",new i(a,"relationdblclick")):t._emit("relation:selected",new i(a,"relationselected"));break}t.renderAll()};t._canvas.onmousedown=function(t){e(t,!1)},t._canvas.onmousemove=function(e){var o=t._getMouse(e);if(t._emit("mouse:move",new n(o.x,o.y,"mousemove")),t._selected){if(t._tmp.transform){if("relation"!==t._selected.baseType)switch(t._tmp.transform){case"tc":t._selected.y+=o.y-t._tmp.pointer.y,t._selected.height-=o.y-t._tmp.pointer.y;break;case"bc":t._selected.height+=o.y-t._tmp.pointer.y;break;case"ml":t._selected.x+=o.x-t._tmp.pointer.x,t._selected.width-=o.x-t._tmp.pointer.x;break;case"mr":t._selected.width+=o.x-t._tmp.pointer.x}else t._selected.movePoint(t._tmp.transform,o.x-t._tmp.pointer.x,o.y-t._tmp.pointer.y);t.renderAll()}else t._isDragged&&(t._selected.x+=o.x-t._tmp.pointer.x,t._selected.y+=o.y-t._tmp.pointer.y,t._canvas.style.cursor="move",t._emit("object:dragging",new i(t._selected,"objectdragging")),t.renderAll());t._tmp.pointer=o}},t._canvas.onmouseup=function(e){var o=t._getMouse(e);t._canvas.style.cursor="default",t._emit("mouse:up",new n(o.x,o.y,"mouseup")),t._selected&&(t._emit("object:released",new i(t._selected,"objectreleased")),t._isDragged=!1,t._tmp.transform=!1,t._selected.recalculateBorders())},t._canvas.onselectstart=function(){return!1}},t.prototype._emit=function(t,e){if("undefined"!=typeof this._callbacks[t])for(var i=0,n=this._callbacks[t];i<n.length;i++){var o=n[i];o.call(this,e)}},t.prototype._getMouse=function(t){var e=this._canvas,i=0,n=0;if(e.offsetParent)do i+=e.offsetLeft,n+=e.offsetTop;while(e=e.offsetParent);var o=this._border;i+=o.paddingLeft,n+=o.paddingTop,i+=o.borderLeft,n+=o.borderTop;var s={x:t.pageX-i,y:t.pageY-n};return this._canvasContainer&&(s.x+=this._canvasContainer.x,s.y+=this._canvasContainer.y),s},t.prototype.setBackground=function(t,e){this._background=t,e&&(this._canvas.width=t.width,this._canvas.height=t.height)},t.prototype.setScrollContainer=function(t){var e=this;e._canvasContainer&&e._canvasContainer.element.removeEventListener("scroll",e._canvasContainer.listener),e._canvasContainer={x:0,y:0,w:0,h:0,element:document.getElementById(t),listener:function(){return e._canvasContainer.y=e._canvasContainer.element.scrollTop,e._canvasContainer.x=e._canvasContainer.element.scrollLeft,!0}},e._canvasContainer.w=e._canvasContainer.element.clientWidth,e._canvasContainer.h=e._canvasContainer.element.clientHeight,e._canvasContainer.element.addEventListener("scroll",e._canvasContainer.listener)},t.prototype.getRelationsFromObject=function(t,e,i){for(var n=[],o=0,s=this.items;o<s.length;o++){var a=s[o];if("relation"===a.baseType){var r=a;r.start!==t&&r.end!==t||(r.start===t&&i?n.push(a):r.end===t&&e?n.push(a):e||i||n.push(a))}}return n},t}());t.Canvas=o}(Loira||(Loira={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Loira;!function(t){var e;!function(t){function e(t){for(var e="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<t;n++)e+=i.charAt(Math.floor(Math.random()*i.length));return e}function i(t,e){var i=(t.y2-t.y1)*(e.x2-e.x1)-(t.x2-t.x1)*(e.y2-e.y1);if(0===i)return!1;var n=e.y1-t.y1,o=e.x1-t.x1,s=(t.x2-t.x1)*n-(t.y2-t.y1)*o;return n=s/i,{x:e.x1+n*(e.x2-e.x1),y:e.y1+n*(e.y2-e.y1)}}function n(t){for(var e=t.split("."),i=window||this,n=0,o=e;n<o.length;n++){var s=o[n];i=i[s]}if("function"!=typeof i)throw new Error("function not found");return i}var o=function(){function t(){}return t}();t.BaseOption=o;var s=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(o);t.RelOption=s;var a=function(){function t(){}return t}();t.Line=a;var r=function(){function t(t,e){this.x=t,this.y=e}return t}();t.Point=r,t.createRandom=e,t.intersectPointLine=i,t.stringToFunction=n}(e=t.util||(t.util={}))}(Loira||(Loira={}));var Loira;!function(t){var e=t.util.BaseOption,i=function(){function i(i){this._uid=t.util.createRandom(8),"undefined"==typeof i&&(i=new e),this.x="x"in i?i.x:0,this.y="y"in i?i.y:0,this.width="width"in i?i.width:0,this.height="height"in i?i.height:0,this.centerObject="centerObject"in i&&i.centerObject,this.maxOutGoingRelation="maxOutGoingRelation"in i?i.maxOutGoingRelation:0,this.extras="extras"in i?i.extras:{},this.text=i.text?i.text:"",this._buttons=[],this._canvas=null,this.type="",this.baseType=""}return i.prototype.checkCollision=function(t,e){return t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height},i.prototype.on=function(t){t=[].splice.call(arguments,0);for(var e=0,i=t;e<i.length;e++){var n=i[e],o=document.createElement("IMG");o.src=n.icon,this._buttons.push({icon:o,click:n.click})}},i.prototype._renderButtons=function(t){var e=this.x+this.width+10,i=this.y;this._buttons.length>0&&this._buttons.forEach(function(n){t.drawImage(n.icon,e,i),i+=n.icon.height+4})},i.prototype.callCustomButton=function(t,e){for(var i=this.x+this.width+10,n=this.y,o=0,s=this._buttons;o<s.length;o++){var a=s[o];if(i<=t&&t<=i+a.icon.width&&n<=e&&e<=n+a.icon.height)return a.click.call(this),!0;n+=a.icon.height+4}return!1},i.prototype.drawSelected=function(e){var i=this.x-2,n=this.y-2,o=this.width,s=this.height;e.beginPath(),e.lineWidth=2,e.setLineDash([5,5]),e.strokeStyle=t.Config.selected.color,e.rect(i,n,o+4,s+4),e.stroke(),e.setLineDash([]),e.fillStyle=t.Config.selected.color,e.fillRect(i-4,n-4,8,8),e.fillRect(i+o,n+s,8,8),e.fillRect(i+o,n-4,8,8),e.fillRect(i-4,n+s,8,8),e.fillRect(i+o/2,n-4,8,8),e.fillRect(i+o/2,n+s,8,8),e.fillRect(i-4,n+s/2,8,8),e.fillRect(i+o,n+s/2,8,8),e.strokeStyle="#000000",e.fillStyle="#000000"},i.prototype.getSelectedCorner=function(t,e){var i=this.x-2,n=this.y-2,o=this.width,s=this.height,a=o/2,r=s/2;return i-4<=t&&t<=i+4&&n-4<=e&&e<=n+4?"tl":i+o<=t&&i+o+8>=t&&n-4<=e&&n+4>=e?"tr":i+o<=t&&i+o+8>=t&&n+s<=e&&n+s+8>=e?"br":i-4<=t&&i+4>=t&&n+s<=e&&n+s+8>=e?"bl":i+a<=t&&i+a+8>=t&&n-4<=e&&n+4>=e?"tc":i+a<=t&&i+a+8>=t&&n+s<=e&&n+s+8>=e?"bc":i-4<=t&&i+4>=t&&n+r<=e&&n+r+8>=e?"ml":i+o<=t&&i+o+8>=t&&n+r<=e&&n+r+8>=e?"mr":""},i.prototype.show=function(){var t=this;if(this._canvas&&this._canvas._canvasContainer){var e=t.x+t.width/2-this._canvas._canvasContainer.element.offsetWidth/2,i=t.y+t.height/2-this._canvas._canvasContainer.element.offsetHeight/2;e=e>=0?e:0,i=i>=0?i:0,this._canvas._canvasContainer.x=e,this._canvas._canvasContainer.y=i,this._canvas._canvasContainer.element.scrollTop=i,this._canvas._canvasContainer.element.scrollLeft=e}},i}();t.Element=i}(Loira||(Loira={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Common;!function(t){var e=Loira.util.Point,i=function(t){function i(i){t.call(this,i),this.start=i.start?i.start:null,this.end=i.end?i.end:null,this.isDashed=!!i.isDashed&&i.isDashed,this.points=i.points?i.points:[new e,new e],this.img=null,i.icon&&(this.img=document.createElement("IMG"),this.img.src=Loira.Config.assetsPath+i.icon),this.baseType="relation"}return __extends(i,t),i.prototype._render=function(t){var e,i,n,o,s,a=this.start,r=this.end;this.points[0]={x:a.x+a.width/2,y:a.y+a.height/2},this.points[this.points.length-1]={x:r.x+r.width/2,y:r.y+r.height/2},i=this.points[0],n=this.points[1],t.beginPath(),t.lineWidth=1,t.moveTo(i.x,i.y),this.isDashed&&t.setLineDash([5,5]);for(var h=1;h<this.points.length;h++)t.lineTo(this.points[h].x,this.points[h].y);if(t.stroke(),t.setLineDash([]),this.img&&(i=this.points[this.points.length-2],n=this.points[this.points.length-1],o=n.x-i.x,s=n.y-i.y,e=Math.atan(s/o),o<0&&(e+=Math.PI),t.translate(n.x,n.y),t.rotate(e),t.drawImage(this.img,-(15+r.obtainBorderPos(o,s,{x1:i.x,y1:i.y,x2:n.x,y2:n.y},t)),-7),t.rotate(-e),t.translate(-n.x,-n.y)),this.text||this.text.length>0){t.font="10px "+Loira.Config.fontType;var l=Math.round(this.points.length/2);i=this.points[l-1],n=this.points[l],o=n.x-i.x,s=n.y-i.y,e=t.measureText(this.text).width,t.fillStyle=Loira.Config.background,t.fillRect(i.x+o/2-e/2,i.y+s/2-15,e,12),t.fillStyle="#000000",t.fillText(this.text,i.x+o/2-e/2,i.y+s/2-5),t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType}},i.prototype.recalculateBorders=function(){},i.prototype.update=function(t,e){return this.start=t,this.end=e,this},i.prototype.checkCollision=function(t,e){for(var i,n=null,o=null,s=0,a=0,r={x:0,y:0},h={x:0,y:0},l=1;l<this.points.length;l++)if(n=this.points[l-1],o=this.points[l],r.x=n.x,r.y=n.y,h.y=o.y,h.x=o.x,n.x>o.x&&(r.x=o.x,h.x=n.x),n.y>o.y&&(r.y=o.y,h.y=n.y),t>r.x-5&&t<h.x+5&&e>r.y-5&&e<h.y+5)if(a=Math.abs(o.y-n.y),s=Math.abs(o.x-n.x),t=Math.abs(t-n.x),e=Math.abs(e-n.y),s>a){if(i=Math.abs(a/s*t),0===i&&e>r.y&&e<h.y||i>e-8&&i<e+8)return!0}else if(i=Math.abs(s/a*e),0===i&&t>r.x&&t<h.x||i>t-8&&i<t+8)return!0;return!1},i.prototype.drawSelected=function(t){t.beginPath(),t.fillStyle=Loira.Config.selected.color;for(var e=0;e<this.points.length;e++)t.fillRect(this.points[e].x-4,this.points[e].y-4,8,8);t.strokeStyle="#000000"},i.prototype.addPoint=function(){var t=this,e=t.points[1],i=t.points[0],n=Math.round((e.x-i.x)/2)+i.x,o=Math.round((e.y-i.y)/2)+i.y;t.points.splice(1,0,{x:n,y:o})},i.prototype.getSelectedCorner=function(t,e){for(var i=1;i<this.points.length-1;i++){var n=this.points[i].x-4,o=this.points[i].y-4,s=n+8,a=o+8;if(t>n&&t<s&&e>o&&e<a)return i}return!1},i.prototype.movePoint=function(t,e,i){this.points[t].x+=e,this.points[t].y+=i},i}(Loira.Element);t.Relation=i;var n=function(t){function e(e){t.call(this,e);var i=this._linkSymbol;this.on({icon:Loira.Config.assetsPath+"arrow.png",click:i}),this.baseType="symbol"}return __extends(e,t),e.prototype._linkSymbol=function(){var t=this,e=this._canvas.on("mouse:down",function(i){var n=t._canvas,o=n.getRelationsFromObject(t,!1,!0);if(!t.maxOutGoingRelation||o.length<t.maxOutGoingRelation)for(var s=0,a=n.items;s<a.length;s++){var r=a[s];if("relation"!==r.baseType&&r.checkCollision(i.x,i.y)){var h=Loira.util.stringToFunction(n.defaultRelation);n.add(new h({}).update(t,r));break}}n.fall("mouse:down",e)})},e.prototype._splitText=function(t,e,i){void 0===i&&(i=10);for(var n=e.split(" "),o="",s=[],a=0;a<n.length;a++)t.measureText(o+n[a]).width>this.width-i?(s.push(o),o=n[a]+" "):o=o+" "+n[a];return s.push(o),s},e.prototype.drawText=function(t,e,i,n){var o,s,a=this.x+this.width/2,r=this.y+this.height/2;s=this._splitText(t,e),o=r+3-(6*s.length+3*s.length)/2;for(var h=0;h<s.length;h++){var l=t.measureText(s[h]).width;t.fillText(s[h],a-l/2,o+3),o=o+Loira.Config.fontSize+3}},e}(Loira.Element);t.Symbol=n;var o=function(t){function e(e){t.call(this,e),this.img=document.createElement("IMG"),this.img.src=Loira.Config.assetsPath+"actor.png",this.img.onload=function(){},this.text=e.text?e.text:"Actor1",this.width=30,this.height=85,this.type="actor"}return __extends(e,t),e.prototype.obtainBorderPos=function(t,e,i,n){n.font=Loira.Config.fontSize+"px "+Loira.Config.fontType;var o=n.measureText(this.text).width;o>this.width&&(this.x=this.x+this.width/2-o/2,this.width=o);var s=Math.atan(e/t);t<0&&(s+=Math.PI);var a={x:100,y:this.y-10};a=s>-.8&&s<.68||s>2.46&&s<4?Loira.util.intersectPointLine(i,{x1:this.x,y1:-100,x2:this.x,y2:100}):Loira.util.intersectPointLine(i,{x1:-100,y1:this.y,x2:100,y2:this.y});var r=a.x-(this.x+this.width/2),h=a.y-(this.y+this.height/2);return Math.sqrt(Math.pow(r,2)+Math.pow(h,2))},e.prototype._render=function(t){var e=t.measureText(this.text).width;e>this.width&&(this.x=this.x+this.width/2-e/2,this.width=e),t.fillStyle=Loira.Config.background,t.fillRect(this.x,this.y,this.width,this.height),t.fillStyle="#000000",t.drawImage(this.img,this.x+this.width/2-15,this.y),t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType,t.fillStyle="#000000",t.fillText(this.text,this.x,this.y+80)},e.prototype.recalculateBorders=function(){},e}(t.Symbol);t.Actor=o}(Common||(Common={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Relation;!function(t){var e=function(t){function e(e){t.call(this,e),this.type="association"}return __extends(e,t),e}(Common.Relation);t.Association=e;var i=function(t){function e(e){e.icon="spear.png",t.call(this,e),this.type="direct_association"}return __extends(e,t),e}(Common.Relation);t.DirectAssociation=i;var n=function(t){function e(e){e.icon="spear2.png",t.call(this,e),this.type="generalization"}return __extends(e,t),e}(Common.Relation);t.Generalization=n;var o=function(t){function e(e){e.icon="spear2.png",e.isDashed=!0,t.call(this,e),this.type="realization"}return __extends(e,t),e}(Common.Relation);t.Realization=o;var s=function(t){function e(e){e.icon="spear1.png",e.isDashed=!0,t.call(this,e),this.type="dependency"}return __extends(e,t),e}(Common.Relation);t.Dependency=s}(Relation||(Relation={})),Loira.XmiParser={load:function(t,e){var i,n,o=null;if(window.DOMParser){var s=new DOMParser;o=s.parseFromString(t,"text/xml")}else o=new ActiveXObject("Microsoft.XMLDOM"),o.async=!1,o.loadXML(t);var a=this._parse(o),r={};for(n in a.symbols)a.symbols.hasOwnProperty(n)&&(i=a.symbols[n],"UML:UseCase"===i.type?r[i.id]=new UseCase.UseCase({text:i.name}):"UML:Actor"===i.type&&(r[i.id]=new Common.Actor({text:i.name})),e.add(r[i.id]));for(n in a.relations)if(a.relations.hasOwnProperty(n)&&(i=a.relations[n],"UML:Association"===i.type)){for(var h={},l=0;l<i.connection.length;l++)"source"===i.connection[l].taggedValues.ea_end?h.start=r[i.connection[l].type]:"target"===i.connection[l].taggedValues.ea_end&&(h.end=r[i.connection[l].type]);e.addRelation(new Relation.Association(h))}setTimeout(function(){e.renderAll()},50)},_parse:function(t){var e=this._xmlToJson(t),i=e.XMI["XMI.content"]["UML:Model"]["UML:Namespace.ownedElement"]["UML:Package"]["UML:Namespace.ownedElement"],n={},o={};for(var s in i)if(i.hasOwnProperty(s)&&"string"!=typeof i[s]){var a=i[s]["@attributes"]["xmi.id"];if("undefined"!=typeof i[s]["UML:Association.connection"]){o[a]={isAbstract:"true"===i[s]["@attributes"].isAbstract,isLeaf:"true"===i[s]["@attributes"].isLeaf,isRoot:"true"===i[s]["@attributes"].isRoot,visibility:i[s]["@attributes"].visibility,id:i[s]["@attributes"]["xmi.id"],type:s,connection:[]};for(var r=0;r<i[s]["UML:Association.connection"]["UML:AssociationEnd"].length;r++){for(var h=i[s]["UML:Association.connection"]["UML:AssociationEnd"][r],l={aggregation:h["@attributes"].aggregation,changeable:h["@attributes"].changeable,isNavigable:"true"===h["@attributes"].isNavigable,isOrdered:"true"===h["@attributes"].isOrdered,targetScope:h["@attributes"].targetScope,type:h["@attributes"].type,visibility:h["@attributes"].visibility,taggedValues:{}},c=0;c<h["UML:ModelElement.taggedValue"]["UML:TaggedValue"].length;c++){var u=h["UML:ModelElement.taggedValue"]["UML:TaggedValue"][c]["@attributes"];l.taggedValues[u.tag]=u.value}o[a].connection.push(l)}}else n[a]={isAbstract:"true"===i[s]["@attributes"].isAbstract,isLeaf:"true"===i[s]["@attributes"].isLeaf,isRoot:"true"===i[s]["@attributes"].isRoot,name:i[s]["@attributes"].name,namespace:i[s]["@attributes"].namespace,visibility:i[s]["@attributes"].visibility,id:i[s]["@attributes"]["xmi.id"],type:s}}return{symbols:n,relations:o}},_xmlToJson:function(t){var e={};if(1===t.nodeType){if(t.attributes.length>0){e["@attributes"]={};for(var i=0;i<t.attributes.length;i++){var n=t.attributes.item(i);e["@attributes"][n.nodeName]=n.nodeValue}}}else 3===t.nodeType&&(e=t.nodeValue);if(t.hasChildNodes())for(var o=0;o<t.childNodes.length;o++){var s=t.childNodes.item(o),a=s.nodeName;if("undefined"==typeof e[a])e[a]=this._xmlToJson(s);else{if("undefined"==typeof e[a].push){var r=e[a];e[a]=[],e[a].push(r)}e[a].push(this._xmlToJson(s))}}return e}};var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},UseCase;!function(t){var e=function(t){function e(e){t.call(this,e),this.width=100,this.height=70,this.text=e.text,this.type="use_case"}return __extends(e,t),e.prototype.obtainBorderPos=function(t,e,i,n){var o=this.width/2,s=this.height/2,a=o*s/Math.sqrt(o*o*e*e+s*s*t*t);return Math.sqrt(Math.pow(a*e,2)+Math.pow(a*t,2))},e.prototype._render=function(t){if(t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType,this.text){var e=.5522848,i=this.width/2*e,n=this.height/2*e,o=this.x+this.width,s=this.y+this.height,a=this.x+this.width/2,r=this.y+this.height/2;t.beginPath(),t.lineWidth=2,t.moveTo(this.x,r),t.bezierCurveTo(this.x,r-n,a-i,this.y,a,this.y),t.bezierCurveTo(a+i,this.y,o,r-n,o,r),t.bezierCurveTo(o,r+n,a+i,s,a,s),t.bezierCurveTo(a-i,s,this.x,r+n,this.x,r),t.stroke(),t.fillStyle="#fcf5d9",t.fill(),t.fillStyle="#000000",this.drawText(t,this.text)}},e.prototype.recalculateBorders=function(){},e}(Common.Symbol);t.UseCase=e;var i=function(t){function e(e){e.icon="spear1.png",e.text="<< extends >>",e.isDashed=!0,t.call(this,e),this.type="extends"}return __extends(e,t),e}(Common.Relation);t.Extends=i;var n=function(t){function e(e){e.icon="spear1.png",e.text="<< include >>",e.isDashed=!0,t.call(this,e),this.type="include"}return __extends(e,t),e}(Common.Relation);t.Include=n}(UseCase||(UseCase={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Box;!function(t){var e=(function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(Loira.util.BaseOption),function(t){function e(e){t.call(this,e),this.width="width"in e?e.width:30,this.height="height"in e?e.height:30,this.color="color"in e?e.color:"rgba(0,0,0,0.3)",this.baseType="box"}return __extends(e,t),e.prototype._render=function(t){t.fillStyle=this.color,t.fillRect(this.x,this.y,this.width,this.height),t.fillStyle="#000000"},e.prototype.recalculateBorders=function(){},e}(Loira.Element));t.Box=e}(Box||(Box={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Workflow;!function(t){var e=Loira.util.BaseOption,i=Loira.util.Point,n=(function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(e),function(t){function e(e){t.call(this,e),this.startPoint=!!e.startPoint&&e.startPoint,this.endPoint=!!e.endPoint&&e.endPoint}return __extends(e,t),e.prototype._linkSymbol=function(){var t=this,e=this._canvas.on("mouse:down",function(n){var o=t._canvas,s=o.getRelationsFromObject(t,!1,!0);if(!t.maxOutGoingRelation||s.length<t.maxOutGoingRelation)for(var a=0,r=o.items;a<r.length;a++){var h=r[a];if("relation"!==h.baseType&&!h.startPoint&&h.checkCollision(n.x,n.y)&&!t.endPoint){var l=Loira.util.stringToFunction(o.defaultRelation),c=null;if(t._uid==h._uid){var u=t.x+t.width+30,d=t.y+t.height/2;c=[],c.push(new i),c.push(new i(u,d)),c.push(new i(u,t.y-30)),c.push(new i(t.x+t.width/2,t.y-30)),c.push(new i)}o.add(new l({points:c}).update(t,h));break}}o.fall("mouse:down",e)})},e}(Common.Symbol)),o=function(t){function e(e){e.width=e.width?e.width:100,e.height=e.height?e.height:70,t.call(this,e),this.text=e.text,this.type="process",this.borders={bottomLeft:0,topLeft:0,topRight:0,bottomRight:0},this.recalculateBorders(),this.maxOutGoingRelation=1}return __extends(e,t),e.prototype.obtainBorderPos=function(t,e,i,n){var o=Math.atan(e/t);t<0&&(o+=Math.PI);var s={x:100,y:this.y-10};s=o>this.borders.bottomLeft&&o<this.borders.topLeft||o>this.borders.topRight&&o<this.borders.bottomRight?Loira.util.intersectPointLine(i,{x1:this.x,y1:-100,x2:this.x,y2:100}):Loira.util.intersectPointLine(i,{x1:-100,y1:this.y,x2:100,y2:this.y});var a=s.x-(this.x+this.width/2),r=s.y-(this.y+this.height/2);return Math.sqrt(Math.pow(a,2)+Math.pow(r,2))},e.prototype._render=function(t){t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType,t.beginPath(),t.lineWidth=2,t.rect(this.x,this.y,this.width,this.height),t.stroke(),t.fillStyle="#fcf5d9",t.fill(),t.fillStyle="#000000",this.drawText(t,this.text)},e.prototype.recalculateBorders=function(){var t=Math.round(this.width/2),e=Math.round(this.height/2);this.borders.bottomLeft=Math.atan(-e/t),this.borders.topLeft=Math.atan(e/t),this.borders.topRight=Math.atan(e/-t)+Math.PI,this.borders.bottomRight=Math.atan(-e/-t)+Math.PI},e}(n);t.Process=o;var s=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.obtainBorderPos=function(t,e,i,n){var o=this.width/2,s=this.height/2,a=o*s/Math.sqrt(o*o*e*e+s*s*t*t);return Math.sqrt(Math.pow(a*e,2)+Math.pow(a*t,2))},e.prototype._render=function(t){t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType;var e=this.x+20,i=this.y,n=this.x+this.width-20,o=this.y+this.height;t.beginPath(),t.lineWidth=2,t.moveTo(e,i),t.lineTo(n,i),t.bezierCurveTo(n+30,i,n+30,o,n,o),t.lineTo(e,o),t.bezierCurveTo(e-30,o,e-30,i,e,i),t.stroke(),t.fillStyle="#fcf5d9",t.fill(),t.fillStyle="#000000",this.drawText(t,this.text)},e.prototype.recalculateBorders=function(){},e}(n),a=function(t){function e(e){e.width=e.width?e.width:100,e.height=e.height?e.height:70,t.call(this,e),this.text="INICIO",this.startPoint=!0,this.maxOutGoingRelation=1,this.type="start_terminator"}return __extends(e,t),e}(s);t.StartTerminator=a;var r=function(t){function e(e){t.call(this,e),this.width=70,this.height=30,this.text="FIN",this.endPoint=!0,this.type="end_terminator"}return __extends(e,t),e}(s);t.EndTerminator=r;var h=function(t){function e(e){e.width=e.width?e.width:100,e.height=e.height?e.height:70,t.call(this,e),this.text=e.text,this.type="data"}return __extends(e,t),e.prototype.obtainBorderPos=function(t,e,i,n){var o=this.width/2,s=this.height/2,a=o*s/Math.sqrt(o*o*e*e+s*s*t*t);return Math.sqrt(Math.pow(a*e,2)+Math.pow(a*t,2))},e.prototype._render=function(t){t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType;var e=this.x+20,i=this.y,n=this.x+this.width,o=this.y+this.height;t.beginPath(),t.lineWidth=2,t.moveTo(e,i),t.lineTo(n,i),t.lineTo(n-20,o),t.lineTo(e-20,o),t.lineTo(e,i),t.stroke(),t.fillStyle="#fcf5d9",t.fill(),t.fillStyle="#000000",this.drawText(t,this.text)},e.prototype.recalculateBorders=function(){},e}(n);t.Data=h;var l=function(t){function e(e){e.width=e.width?e.width:100,e.height=e.height?e.height:70,t.call(this,e),this.text=e.text,this.type="decision"}return __extends(e,t),e.prototype.obtainBorderPos=function(t,e,i,n){var o,s=this.x,a=this.y,r=this.x+this.width/2,h=this.y+this.height/2,l=this.x+this.width,c=Math.atan(h/t);return t<0&&(c+=Math.PI),o=c>0&&c<1.6||c>3.15&&c<4.7?Loira.util.intersectPointLine(i,{x1:s,y1:h,x2:r,y2:a}):Loira.util.intersectPointLine(i,{x1:r,y1:a,x2:l,y2:h}),s=o.x-(this.x+this.width/2),a=o.y-(this.y+this.height/2),Math.sqrt(Math.pow(s,2)+Math.pow(a,2))},e.prototype._render=function(t){t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType;var e=this.x,i=this.y,n=this.x+this.width/2,o=this.y+this.height/2,s=this.x+this.width,a=this.y+this.height;t.beginPath(),t.lineWidth=2,t.moveTo(n,i),t.lineTo(s,o),t.lineTo(n,a),t.lineTo(e,o),t.lineTo(n,i),t.stroke(),t.fillStyle="#fcf5d9",t.fill(),t.fillStyle="#000000",this.drawText(t,this.text)},e.prototype.recalculateBorders=function(){},e}(n);t.Decision=l}(Workflow||(Workflow={}));var Loira;!function(t){var e,i=12,n="Arial",o={color:"#339966"},s="#aacccc",a="../assets/";!function(t){t.fontSize=i,t.fontType=n,t.selected=o,t.background=s,t.assetsPath=a}(e=t.Config||(t.Config={}))}(Loira||(Loira={}));