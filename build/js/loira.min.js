var Loira={};Loira.Canvas=function(){"use strict";var t=function(t){this.initialize(t)};return t.prototype={_selected:null,_isDragged:!1,_tmp:{},items:[],_canvas:null,_background:null,_canvasContainer:null,defaultRelation:null,initialize:function(t){"string"==typeof t?this._canvas=document.getElementById(t):this._canvas=t,this._callbacks={},this.items=[],this.defaultRelation="Relation.Association",document.defaultView&&document.defaultView.getComputedStyle&&(this._border={paddingLeft:parseInt(document.defaultView.getComputedStyle(this._canvas,null).paddingLeft,10)||0,paddingTop:parseInt(document.defaultView.getComputedStyle(this._canvas,null).paddingTop,10)||0,borderLeft:parseInt(document.defaultView.getComputedStyle(this._canvas,null).borderLeftWidth,10)||0,borderTop:parseInt(document.defaultView.getComputedStyle(this._canvas,null).borderTopWidth,10)||0}),this._bind()},renderAll:function(){var t=this._canvas.getContext("2d");t.clearRect(0,0,this._canvas.width,this._canvas.height),this._background&&t.drawImage(this._background,0,0);for(var i=0;i<this.items.length;i++)this.items[i]._render(t);this._selected&&(this._selected.drawSelected(t),this._selected._renderButtons(t))},add:function(t){t.length||(t=[].splice.call(arguments,0));var i=this.items,e=this;t.forEach(function(t){if(t._canvas=e,"relation"===t.baseType){var n=i.indexOf(t.start);n=n<i.indexOf(t.end)?n:i.indexOf(t.end),i.splice(n,0,t),e._emit("relation:added",new relationEvent({selected:t,type:"relationadded"}))}else"container"===t.baseType?(i.splice(0,0,t),e._emit("container:added",new objectEvent({selected:t,type:"objectadded"}))):(t.centerObject&&(e._canvasContainer?(t.x=e._canvasContainer.w/2+e._canvasContainer.x-t.width/2,t.y=e._canvasContainer.h/2+e._canvasContainer.y-t.height/2):(t.x=e._canvas.width/2,t.y=e._canvas.height/2)),i.push(t),e._emit("object:added",new objectEvent({selected:t,type:"objectadded"})))})},remove:function(){var t=[].splice.call(arguments,0),i=this.items,e=this;t.forEach(function(t){var n=[];t._canvas=null,n.push(i.indexOf(t));for(var s=0;s<i.length;s++)"relation"===i[s].baseType&&(i[s].start._uid!==t._uid&&i[s].end._uid!==t._uid||(i[s]._canvas=null,n.push(s)));for(n.sort(),s=n.length-1;s>=0;s--)i.splice(n[s],1);e._emit("object:removed",new objectEvent({selected:t,type:"objectremoved"}))}),this._selected=null},removeAll:function(){for(var t=0;t<this.items.length;t++)this.items[t]._canvas=null;this.items=[],this._selected=null},destroy:function(){this._canvas.onmousemove=null,this._canvas.onkeydown=null,this._canvas.onmousedown=null,this._canvas.onmouseup=null,this._canvas.ondblclick=null,this._canvas.onselectstart=null,this._canvasContainer&&this._canvasContainer.element.removeEventListener("scroll",this._canvasContainer.listener),this._canvasContainer=null,this._canvas=null},on:function(t,i){var e;if("string"==typeof t)return"undefined"==typeof this._callbacks[t]&&(this._callbacks[t]=[]),this._callbacks[t].push(i),i;if("object"==typeof t)for(e in t)t.hasOwnProperty(e)&&("undefined"==typeof this._callbacks[e]&&(this._callbacks[e]=[]),this._callbacks[e].push(t[e]))},fall:function(t,i){var e=this._callbacks[t].indexOf(i);e>-1&&this._callbacks[t].splice(e,1)},_bind:function(){var t=this;t._canvas.onkeydown=function(i){var e=i.keyCode;46===e&&t._selected&&"relation"!==t._selected.baseType&&t.remove(t._selected)};var i=function(i,e){var n=t._getMouse(i);if(t._tmp.pointer=n,e?t._emit("mouse:dblclick",new mouseEvent({x:n.x,y:n.y,type:"dblclick"})):t._emit("mouse:down",new mouseEvent({x:n.x,y:n.y,type:"mousedown"})),t._selected){if(t._tmp.transform=t._selected.getSelectedCorner(n.x,n.y),t._tmp.transform||t._selected.callCustomButton(n.x,n.y))return;t._selected=null}for(var s,a=t.items.length-1;a>=0;a--)if(s=t.items[a],s.checkCollision(n.x,n.y)){if(t._selected=s,e||(t._isDragged=!0),"relation"!==s.baseType){e?t._emit("object:dblclick",new objectEvent({selected:s,type:"objectdblclick"})):t._emit("object:selected",new objectEvent({selected:s,type:"objectselected"}));break}e?t._emit("relation:dblclick",new objectEvent({selected:s,type:"relationdblclick"})):t._emit("relation:selected",new objectEvent({selected:s,type:"relationselected"}));break}t.renderAll()};t._canvas.onmousedown=function(t){i(t,!1)},t._canvas.onmousemove=function(i){var e=t._getMouse(i);if(t._emit("mouse:move",new mouseEvent({x:e.x,y:e.y,type:"mousemove"})),t._selected){if(t._tmp.transform){if("relation"!==t._selected.baseType)switch(t._tmp.transform){case"tc":t._selected.y+=e.y-t._tmp.pointer.y,t._selected.height-=e.y-t._tmp.pointer.y;break;case"bc":t._selected.height+=e.y-t._tmp.pointer.y;break;case"ml":t._selected.x+=e.x-t._tmp.pointer.x,t._selected.width-=e.x-t._tmp.pointer.x;break;case"mr":t._selected.width+=e.x-t._tmp.pointer.x}else t._selected.movePoint(t._tmp.transform,e.x-t._tmp.pointer.x,e.y-t._tmp.pointer.y);t.renderAll()}else t._isDragged&&(t._selected.x+=e.x-t._tmp.pointer.x,t._selected.y+=e.y-t._tmp.pointer.y,t._canvas.style.cursor="move",t._emit("object:dragging",new objectEvent({selected:t._selected,type:"objectdragging"})),t.renderAll());t._tmp.pointer=e}},t._canvas.onmouseup=function(i){var e=t._getMouse(i);t._canvas.style.cursor="default",t._emit("mouse:up",new mouseEvent({x:e.x,y:e.y,type:"mouseup"})),t._selected&&(t._emit("object:released",new mouseEvent({selected:t.selected,type:"objectreleased"})),t._isDragged=!1,t._tmp.transform=!1,t._selected.recalculateBorders())},t._canvas.onselectstart=function(){return!1}},_emit:function(t,i){if("undefined"!=typeof this._callbacks[t])for(var e=0;e<this._callbacks[t].length;e++){var n=this._callbacks[t][e];n.call(this,i)}},_getMouse:function(t){var i=this._canvas,e=0,n=0;if(i.offsetParent)do e+=i.offsetLeft,n+=i.offsetTop;while(i=i.offsetParent);var s=this._border;e+=s.paddingLeft,n+=s.paddingTop,e+=s.borderLeft,n+=s.borderTop;var a={x:t.pageX-e,y:t.pageY-n};return this._canvasContainer&&(a.x+=this._canvasContainer.x,a.y+=this._canvasContainer.y),a},setBackground:function(t,i){this._background=t,i&&(this._canvas.width=t.width,this._canvas.height=t.height)},setScrollContainer:function(t){var i=this;i._canvasContainer&&i._canvasContainer.element.removeEventListener("scroll",i._canvasContainer.listener),i._canvasContainer={x:0,y:0,w:0,h:0,element:document.getElementById(t),listener:function(t){return i._canvasContainer.y=i._canvasContainer.element.scrollTop,i._canvasContainer.x=i._canvasContainer.element.scrollLeft,!0}},i._canvasContainer.w=i._canvasContainer.element.clientWidth,i._canvasContainer.h=i._canvasContainer.element.clientHeight,i._canvasContainer.element.addEventListener("scroll",i._canvasContainer.listener)},getRelationsFromObject:function(t,i,e){for(var n=[],s=0;s<this.items.length;s++){var a=this.items[s];"relation"==a.baseType&&(a.start!=t&&a.end!=t||(a.start==t&&e?n.push(a):a.end==t&&i?n.push(a):i||e||n.push(a)))}return n}},t}();var mouseEvent=function(t){this.x="x"in t?t.x:-1,this.y="y"in t?t.y:-1,this.type="type"in t?t.type:""},objectEvent=function(t){this.selected="selected"in t?t.selected:null,this.type="type"in t?t.type:""},relationEvent=function(t){this.selected="selected"in t?t.selected:null,this.type="type"in t?t.type:""};Loira.util=function(){return{createClass:function(t,i,e){var n,s={};for(n in i)i.hasOwnProperty(n)&&(s[n]=i[n]);for(n in t)t.hasOwnProperty(n)&&(s.hasOwnProperty(n)?s["$"+n]=t[n]:s[n]=t[n]);return e?s:function(t){for(var i in s)s.hasOwnProperty(i)&&(this[i]=s[i]);this.initialize(t)}},createRandom:function(t){for(var i="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;t>n;n++)i+=e.charAt(Math.floor(Math.random()*e.length));return i},intersectPointLine:function(t,i){var e=(t.y2-t.y1)*(i.x2-i.x1)-(t.x2-t.x1)*(i.y2-i.y1);if(0===e)return!1;var n=i.y1-t.y1,s=i.x1-t.x1,a=(t.x2-t.x1)*n-(t.y2-t.y1)*s,o=(i.x2-i.x1)*n-(i.y2-i.y1)*s;return n=a/e,s=o/e,{x:i.x1+n*(i.x2-i.x1),y:i.y1+n*(i.y2-i.y1)}},stringToFunction:function(t){for(var i=t.split("."),e=window||this,n=0,s=i.length;s>n;n++)e=e[i[n]];if("function"!=typeof e)throw new Error("function not found");return e}}}(),Loira.Object=function(){"use strict";return{_canvas:null,_buttons:[],initialize:function(t){this._uid=Loira.util.createRandom(8),"undefined"==typeof t&&(t={}),this.x="x"in t?t.x:0,this.y="y"in t?t.y:0,this.width="width"in t?t.width:0,this.height="height"in t?t.height:0,this.centerObject="centerObject"in t?t.centerObject:!1,this.startPoint="startPoint"in t?t.startPoint:!1,this.endPoint="endPoint"in t?t.endPoint:!1,this.maxOutGoingRelation="maxOutGoingRelation"in t?t.maxOutGoingRelation:!1,this.extras="extras"in t?t.extras:{},this._buttons=[],this._canvas=null,this.type="",this.baseType="",this._prepare(t)},callSuper:function(t,i){return i=[].splice.call(arguments,0),t="$"+t,i=i.length>1?i.splice(1,i.length):[],this[t].apply(this,i)},_render:function(t){},_prepare:function(t){},checkCollision:function(t,i){return t>=this.x&&t<=this.x+this.width&&i>=this.y&&i<=this.y+this.height},on:function(t){t=[].splice.call(arguments,0);for(var i=0;i<t.length;i++){var e=t[i],n=document.createElement("IMG");n.src=e.icon,this._buttons.push({icon:n,click:e.click})}},_renderButtons:function(t){var i=this.x+this.width+10,e=this.y;this._buttons.length>0&&this._buttons.forEach(function(n){t.drawImage(n.icon,i,e),e+=n.icon.height+4})},callCustomButton:function(t,i){for(var e=this.x+this.width+10,n=this.y,s=0;s<this._buttons.length;s++){var a=this._buttons[s];if(t>=e&&t<=e+a.icon.width&&i>=n&&i<=n+a.icon.height)return a.click.call(this),!0;n+=a.icon.height+4}return!1},drawSelected:function(t){var i=this.x-2,e=this.y-2,n=this.width,s=this.height;t.beginPath(),t.lineWidth=2,t.setLineDash([5,5]),t.strokeStyle=Loira.Config.selected.color,t.rect(i,e,n+4,s+4),t.stroke(),t.setLineDash([]),t.fillStyle=Loira.Config.selected.color,t.fillRect(i-4,e-4,8,8),t.fillRect(i+n,e+s,8,8),t.fillRect(i+n,e-4,8,8),t.fillRect(i-4,e+s,8,8),t.fillRect(i+n/2,e-4,8,8),t.fillRect(i+n/2,e+s,8,8),t.fillRect(i-4,e+s/2,8,8),t.fillRect(i+n,e+s/2,8,8),t.strokeStyle="#000000",t.fillStyle="#000000"},getSelectedCorner:function(t,i){var e=this.x-2,n=this.y-2,s=this.width,a=this.height,o=s/2,r=a/2;return t>=e-4&&e+4>=t&&i>=n-4&&n+4>=i?"tl":t>=e+s&&e+s+8>=t&&i>=n-4&&n+4>=i?"tr":t>=e+s&&e+s+8>=t&&i>=n+a&&n+a+8>=i?"br":t>=e-4&&e+4>=t&&i>=n+a&&n+a+8>=i?"bl":t>=e+o&&e+o+8>=t&&i>=n-4&&n+4>=i?"tc":t>=e+o&&e+o+8>=t&&i>=n+a&&n+a+8>=i?"bc":t>=e-4&&e+4>=t&&i>=n+r&&n+r+8>=i?"ml":t>=e+s&&e+s+8>=t&&i>=n+r&&n+r+8>=i?"mr":!1},show:function(){var t=this;if(this._canvas&&this._canvas._canvasContainer){var i=t.x+t.width/2-this._canvas._canvasContainer.element.offsetWidth/2,e=t.y+t.height/2-this._canvas._canvasContainer.element.offsetHeight/2;i=i>=0?i:0,e=e>=0?e:0,this._canvas._canvasContainer.x=i,this._canvas._canvasContainer.y=e,this._canvas._canvasContainer.element.scrollTop=e,this._canvas._canvasContainer.element.scrollLeft=i}},recalculateBorders:function(){}}}();var Common={};Common.Relation=function(){"use strict";return Loira.util.createClass(Loira.Object,{_prepare:function(t){"undefined"==typeof t&&(t={}),this.start=t.start?t.start:null,this.end=t.end?t.end:null,this.text=t.text?t.text:"",this.isDashed=t.isDashed?t.isDashed:!1,this.points=t.points?t.points:[{},{}],this.img=null,t.icon&&(this.img=document.createElement("IMG"),this.img.src=Loira.Config.assetsPath+t.icon,this.img.onload=function(){}),this.baseType="relation"},_render:function(t){var i,e,n,s,a,o=this.start,r=this.end;this.points[0]={x:o.x+o.width/2,y:o.y+o.height/2},this.points[this.points.length-1]={x:r.x+r.width/2,y:r.y+r.height/2},e=this.points[0],n=this.points[1],t.beginPath(),t.lineWidth=1,t.moveTo(e.x,e.y),this.isDashed&&t.setLineDash([5,5]);for(var h=1;h<this.points.length;h++)t.lineTo(this.points[h].x,this.points[h].y);t.stroke(),t.setLineDash([]),this.img&&(e=this.points[this.points.length-2],n=this.points[this.points.length-1],s=n.x-e.x,a=n.y-e.y,i=Math.atan(a/s),0>s&&(i+=Math.PI),t.translate(n.x,n.y),t.rotate(i),t.drawImage(this.img,-(15+r.obtainBorderPos(s,a,{x1:e.x,y1:e.y,x2:n.x,y2:n.y},t)),-7),t.rotate(-i),t.translate(-n.x,-n.y)),(this.text||this.text.length>0)&&(t.font="10px "+Loira.Config.fontType,e=this.points[0],n=this.points[1],s=n.x-e.x,a=n.y-e.y,i=t.measureText(this.text).width,t.fillStyle=Loira.Config.background,t.fillRect(e.x+s/2-i/2,e.y+a/2-15,i,12),t.fillStyle="#000000",t.fillText(this.text,e.x+s/2-i/2,e.y+a/2-5),t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType)},update:function(t,i){return this.start=t,this.end=i,this},checkCollision:function(t,i){for(var e,n=null,s=null,a=0,o=0,r=0,h=0,l=0,c=0,u=1;u<this.points.length;u++)if(n=this.points[u-1],s=this.points[u],a=n.x,r=n.y,h=s.y,o=s.x,n.x>s.x&&(a=s.x,o=n.x),n.y>s.y&&(r=s.y,h=n.y),t>a-5&&o+5>t&&i>r-5&&h+5>i)if(c=Math.abs(s.y-n.y),l=Math.abs(s.x-n.x),t=Math.abs(t-n.x),i=Math.abs(i-n.y),l>c){if(e=Math.abs(c/l*t),0==e&&i>r&&h>i||e>i-8&&i+8>e)return!0}else if(e=Math.abs(l/c*i),0==e&&t>a&&o>t||e>t-8&&t+8>e)return!0;return!1},drawSelected:function(t){t.beginPath(),t.fillStyle=Loira.Config.selected.color;for(var i=0;i<this.points.length;i++)t.fillRect(this.points[i].x-4,this.points[i].y-4,8,8);t.strokeStyle="#000000"},addPoint:function(){var t=this,i=t.points[1],e=t.points[0],n=Math.round((i.x-e.x)/2)+e.x,s=Math.round((i.y-e.y)/2)+e.y;t.points.splice(1,0,{x:n,y:s})},getSelectedCorner:function(t,i){for(var e=1;e<this.points.length-1;e++){var n=this.points[e].x-4,s=this.points[e].y-4,a=n+8,o=s+8;if(t>n&&a>t&&i>s&&o>i)return e}return!1},movePoint:function(t,i,e){this.points[t].x+=i,this.points[t].y+=e}},!0)}(),Common.Symbol=function(){"use strict";return Loira.util.createClass(Loira.Object,{_prepare:function(t){var i=this._linkSymbol;this.on({icon:Loira.Config.assetsPath+"arrow.png",click:i}),this.baseType="symbol"},_linkSymbol:function(){var t=this,i=this._canvas.on("mouse:down",function(e){var n=t._canvas,s=n.getRelationsFromObject(t,!1,!0);if(!t.maxOutGoingRelation||s.length<t.maxOutGoingRelation)for(var a=0;a<n.items.length;a++){var o=n.items[a];if("relation"!=o.baseType&&!o.startPoint&&o.checkCollision(e.x,e.y)&&!t.endPoint){var r=Loira.util.stringToFunction(n.defaultRelation);n.add(new r({}).update(t,o));break}}n.fall("mouse:down",i)})},obtainBorderPos:function(t,i,e,n){return 0}},!0)}(),Common.Actor=function(){"use strict";return Loira.util.createClass(Common.Symbol,{initialize:function(t){this.callSuper("initialize",t),this.img=document.createElement("IMG"),this.img.src=Loira.Config.assetsPath+"actor.png",this.img.onload=function(){},this.text=t.text?t.text:"Actor1",this.width=30,this.height=85,this.type="actor"},_render:function(t){var i=t.measureText(this.text).width;i>this.width&&(this.x=this.x+this.width/2-i/2,this.width=i),t.fillStyle=Loira.Config.background,t.fillRect(this.x,this.y,this.width,this.height),t.fillStyle="#000000",t.drawImage(this.img,this.x+this.width/2-15,this.y),t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType,t.fillStyle="#000000",t.fillText(this.text,this.x,this.y+80)},obtainBorderPos:function(t,i,e,n){n.font=Loira.Config.fontSize+"px "+Loira.Config.fontType;var s=n.measureText(this.text).width;s>this.width&&(this.x=this.x+this.width/2-s/2,this.width=s);var a=Math.atan(i/t);0>t&&(a+=Math.PI);var o={x:100,y:this.y-10};o=a>-.8&&.68>a||a>2.46&&4>a?Loira.util.intersectPointLine(e,{x1:this.x,y1:-100,x2:this.x,y2:100}):Loira.util.intersectPointLine(e,{x1:-100,y1:this.y,x2:100,y2:this.y});var r=o.x-(this.x+this.width/2),h=o.y-(this.y+this.height/2);return Math.sqrt(Math.pow(r,2)+Math.pow(h,2))}})}(),Common.Container=function(){"use strict";return Loira.util.createClass(Common.Symbol,{initialize:function(t){this.callSuper("initialize",t),this.text=t.text?t.text:"Contenedor",this.width=100,this.height=100,this.type="container",this.baseType="container"},_render:function(t){var i=t.measureText(this.text).width;i>this.width&&(this.x=this.x+this.width/2-i/2,this.width=i),t.rect(this.x,this.y,this.width,this.height),t.fillText("<< "+this.text+" >>",this.x,this.y+10)},obtainBorderPos:function(t,i,e){var n=Math.atan(i/t);0>t&&(n+=Math.PI);var s={x:100,y:this.y-10};s=n>-.8&&.68>n||n>2.46&&4>n?Loira.util.intersectPointLine(e,{x1:this.x,y1:-100,x2:this.x,y2:100}):Loira.util.intersectPointLine(e,{x1:-100,y1:this.y,x2:100,y2:this.y});var a=s.x-(this.x+this.width/2),o=s.y-(this.y+this.height/2);return Math.sqrt(Math.pow(a,2)+Math.pow(o,2))}})}(),Common.Table=function(){"use strict";return Loira.util.createClass(Common.Symbol,{initialize:function(t){this.callSuper("initialize",t),this.text=t.text?t.text:"Tabla",this.width=100,this.height=100,this.type="table",this.baseType="table"},_render:function(t){var i=t.measureText(this.text).width;i>this.width&&(this.x=this.x+this.width/2-i/2,this.width=i),t.rect(this.x,this.y,this.width,this.height),t.fillText("<< "+this.text+" >>",this.x,this.y+10)},obtainBorderPos:function(t,i,e){var n=Math.atan(i/t);0>t&&(n+=Math.PI);var s={x:100,y:this.y-10};s=n>-.8&&.68>n||n>2.46&&4>n?Loira.util.intersectPointLine(e,{x1:this.x,y1:-100,x2:this.x,y2:100}):Loira.util.intersectPointLine(e,{x1:-100,y1:this.y,x2:100,y2:this.y});var a=s.x-(this.x+this.width/2),o=s.y-(this.y+this.height/2);return Math.sqrt(Math.pow(a,2)+Math.pow(o,2))}})}();var Relation={};Relation.Association=function(){return Loira.util.createClass(Common.Relation,{initialize:function(t){this.callSuper("initialize",t),this.type="association"}})}(),Relation.DirectAssociation=function(){return Loira.util.createClass(Common.Relation,{initialize:function(t){t.icon="spear.png",this.callSuper("initialize",t),this.type="direct_association"}})}(),Relation.Generalization=function(){return Loira.util.createClass(Common.Relation,{initialize:function(t){t.icon="spear2.png",this.callSuper("initialize",t),this.type="generalization"}})}(),Relation.Realization=function(){return Loira.util.createClass(Common.Relation,{initialize:function(t){t.icon="spear2.png",t.isDashed=!0,this.callSuper("initialize",t),this.type="realization"}})}(),Relation.Dependency=function(){return Loira.util.createClass(Common.Relation,{initialize:function(t){t.icon="spear1.png",t.isDashed=!0,this.callSuper("initialize",t),this.type="dependency"}})}(),Loira.XmiParser={load:function(t,i){var e,n,s=null;if(window.DOMParser){var a=new DOMParser;s=a.parseFromString(t,"text/xml")}else s=new ActiveXObject("Microsoft.XMLDOM"),s.async=!1,s.loadXML(t);var o=this._parse(s),r={};for(n in o.symbols)o.symbols.hasOwnProperty(n)&&(e=o.symbols[n],"UML:UseCase"===e.type?r[e.id]=new UseCase.UseCase({text:e.name}):"UML:Actor"===e.type&&(r[e.id]=new Common.Actor({text:e.name})),i.add(r[e.id]));for(n in o.relations)if(o.relations.hasOwnProperty(n)&&(e=o.relations[n],"UML:Association"===e.type)){for(var h={},l=0;l<e.connection.length;l++)"source"===e.connection[l].taggedValues.ea_end?h.start=r[e.connection[l].type]:"target"===e.connection[l].taggedValues.ea_end&&(h.end=r[e.connection[l].type]);i.addRelation(new Relation.Association(h))}setTimeout(function(){i.renderAll()},50)},_parse:function(t){var i=this._xmlToJson(t),e=i.XMI["XMI.content"]["UML:Model"]["UML:Namespace.ownedElement"]["UML:Package"]["UML:Namespace.ownedElement"],n={},s={};for(var a in e)if(e.hasOwnProperty(a)&&"string"!=typeof e[a]){var o=e[a]["@attributes"]["xmi.id"];if("undefined"!=typeof e[a]["UML:Association.connection"]){s[o]={isAbstract:"true"===e[a]["@attributes"].isAbstract,isLeaf:"true"===e[a]["@attributes"].isLeaf,isRoot:"true"===e[a]["@attributes"].isRoot,visibility:e[a]["@attributes"].visibility,id:e[a]["@attributes"]["xmi.id"],type:a,connection:[]};for(var r=0;r<e[a]["UML:Association.connection"]["UML:AssociationEnd"].length;r++){for(var h=e[a]["UML:Association.connection"]["UML:AssociationEnd"][r],l={aggregation:h["@attributes"].aggregation,changeable:h["@attributes"].changeable,isNavigable:"true"===h["@attributes"].isNavigable,isOrdered:"true"===h["@attributes"].isOrdered,targetScope:h["@attributes"].targetScope,type:h["@attributes"].type,visibility:h["@attributes"].visibility,taggedValues:{}},c=0;c<h["UML:ModelElement.taggedValue"]["UML:TaggedValue"].length;c++){var u=h["UML:ModelElement.taggedValue"]["UML:TaggedValue"][c]["@attributes"];l.taggedValues[u.tag]=u.value}s[o].connection.push(l)}}else n[o]={isAbstract:"true"===e[a]["@attributes"].isAbstract,isLeaf:"true"===e[a]["@attributes"].isLeaf,isRoot:"true"===e[a]["@attributes"].isRoot,name:e[a]["@attributes"].name,namespace:e[a]["@attributes"].namespace,visibility:e[a]["@attributes"].visibility,id:e[a]["@attributes"]["xmi.id"],type:a}}return{symbols:n,relations:s}},_xmlToJson:function(t){var i={};if(1===t.nodeType){if(t.attributes.length>0){i["@attributes"]={};for(var e=0;e<t.attributes.length;e++){var n=t.attributes.item(e);i["@attributes"][n.nodeName]=n.nodeValue}}}else 3===t.nodeType&&(i=t.nodeValue);if(t.hasChildNodes())for(var s=0;s<t.childNodes.length;s++){var a=t.childNodes.item(s),o=a.nodeName;if("undefined"==typeof i[o])i[o]=this._xmlToJson(a);else{if("undefined"==typeof i[o].push){var r=i[o];i[o]=[],i[o].push(r)}i[o].push(this._xmlToJson(a))}}return i}};var UseCase={};UseCase.UseCase=Loira.util.createClass(Common.Symbol,{initialize:function(t){this.callSuper("initialize",t),this.width=100,this.height=70,this.text=t.text,this.type="use_case"},_render:function(t){if(t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType,this.text){var i=.5522848,e=this.width/2*i,n=this.height/2*i,s=this.x+this.width,a=this.y+this.height,o=this.x+this.width/2,r=this.y+this.height/2;t.beginPath(),t.lineWidth=2,t.moveTo(this.x,r),t.bezierCurveTo(this.x,r-n,o-e,this.y,o,this.y),t.bezierCurveTo(o+e,this.y,s,r-n,s,r),t.bezierCurveTo(s,r+n,o+e,a,o,a),t.bezierCurveTo(o-e,a,this.x,r+n,this.x,r),t.stroke(),t.fillStyle="#fcf5d9",t.fill(),t.fillStyle="#000000",this._drawText(t,this._splitText(t,this.text))}},_splitText:function(t,i){for(var e=i.split(" "),n="",s=[],a=0;a<e.length;a++)t.measureText(n+e[a]).width>this.width-10?(s.push(n),n=e[a]+" "):n=n+" "+e[a];return s.push(n),s},_drawText:function(t,i,e,n){var s=(this.x,this.y),a=this.x+this.width/2,o=this.y+this.height/2;if("string"==typeof i){var r=i;i=[r]}s=o+3-(6*i.length+3*i.length)/2;for(var h=0;h<i.length;h++){var l=t.measureText(i[h]).width;t.fillText(i[h],a-l/2,s+3),s=s+Loira.Config.fontSize+3}},obtainBorderPos:function(t,i){var e=this.width/2,n=this.height/2,s=e*n/Math.sqrt(e*e*i*i+n*n*t*t);return Math.sqrt(Math.pow(s*i,2)+Math.pow(s*t,2))}}),UseCase.Extends=Loira.util.createClass(Common.Relation,{initialize:function(t){t.icon="spear1.png",t.text="<< extends >>",t.isDashed=!0,this.callSuper("initialize",t),this.type="extends"}}),UseCase.Include=Loira.util.createClass(Common.Relation,{initialize:function(t){t.icon="spear1.png",t.text="<< include >>",t.isDashed=!0,this.callSuper("initialize",t),this.type="include"}});var Box={};Box.Box=function(){"use strict";return Loira.util.createClass(Loira.Object,{_prepare:function(t){this.width="width"in t?t.width:30,this.height="height"in t?t.height:30,this.color="color"in t?t.color:"rgba(0,0,0,0.3)",this.baseType="box"},_render:function(t){t.fillStyle=this.color,t.fillRect(this.x,this.y,this.width,this.height),t.fillStyle="#000000"},obtainBorderPos:function(t,i){return 0}})}();var Workflow={};Workflow.Process=Loira.util.createClass(Common.Symbol,{initialize:function(t){this.callSuper("initialize",t),this.width=100,this.height=70,this.text=t.text,this.type="process",this.borders={bottomLeft:0,topLeft:0,topRight:0,bottomRight:0},this.recalculateBorders(),this.maxOutGoingRelation=1},_render:function(t){t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType,t.beginPath(),t.lineWidth=2,t.rect(this.x,this.y,this.width,this.height),t.stroke(),t.fillStyle="#fcf5d9",t.fill(),t.fillStyle="#000000",this._drawText(t,this._splitText(t,this.text))},_splitText:function(t,i){for(var e=i.split(" "),n="",s=[],a=0;a<e.length;a++)t.measureText(n+e[a]).width>this.width-10?(s.push(n),n=e[a]+" "):n=n+" "+e[a];return s.push(n),s},_drawText:function(t,i,e,n){var s=(this.x,this.y),a=this.x+this.width/2,o=this.y+this.height/2;if("string"==typeof i){var r=i;i=[r]}s=o+3-(6*i.length+3*i.length)/2;for(var h=0;h<i.length;h++){var l=t.measureText(i[h]).width;t.fillText(i[h],a-l/2,s+3),s=s+Loira.Config.fontSize+3}},obtainBorderPos:function(t,i,e,n){var s=Math.atan(i/t);0>t&&(s+=Math.PI);var a={x:100,y:this.y-10};a=s>this.borders.bottomLeft&&s<this.borders.topLeft||s>this.borders.topRight&&s<this.borders.bottomRight?Loira.util.intersectPointLine(e,{x1:this.x,y1:-100,x2:this.x,y2:100}):Loira.util.intersectPointLine(e,{x1:-100,y1:this.y,x2:100,y2:this.y});var o=a.x-(this.x+this.width/2),r=a.y-(this.y+this.height/2);return Math.sqrt(Math.pow(o,2)+Math.pow(r,2))},recalculateBorders:function(){var t=Math.round(this.width/2),i=Math.round(this.height/2);this.borders.bottomLeft=Math.atan(-i/t),this.borders.topLeft=Math.atan(i/t),this.borders.topRight=Math.atan(i/-t)+Math.PI,this.borders.bottomRight=Math.atan(-i/-t)+Math.PI}}),Workflow.Terminator=Loira.util.createClass(Common.Symbol,{_render:function(t){t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType;var i=this.x+20,e=this.y,n=this.x+this.width-20,s=this.y+this.height;t.beginPath(),t.lineWidth=2,t.moveTo(i,e),t.lineTo(n,e),t.bezierCurveTo(n+30,e,n+30,s,n,s),t.lineTo(i,s),t.bezierCurveTo(i-30,s,i-30,e,i,e),t.stroke(),t.fillStyle="#fcf5d9",t.fill(),t.fillStyle="#000000",this._drawText(t,this._splitText(t,this.text))},_splitText:function(t,i){for(var e=i.split(" "),n="",s=[],a=0;a<e.length;a++)t.measureText(n+e[a]).width>this.width-10?(s.push(n),n=e[a]+" "):n=n+" "+e[a];return s.push(n),s},_drawText:function(t,i,e,n){var s=(this.x,this.y),a=this.x+this.width/2,o=this.y+this.height/2;if("string"==typeof i){var r=i;i=[r]}s=o+3-(6*i.length+3*i.length)/2;for(var h=0;h<i.length;h++){var l=t.measureText(i[h]).width;t.fillText(i[h],a-l/2,s+3),s=s+Loira.Config.fontSize+3}},obtainBorderPos:function(t,i){var e=this.width/2,n=this.height/2,s=e*n/Math.sqrt(e*e*i*i+n*n*t*t);return Math.sqrt(Math.pow(s*i,2)+Math.pow(s*t,2))}},!0),Workflow.StartTerminator=Loira.util.createClass(Workflow.Terminator,{initialize:function(t){this.callSuper("initialize",t),this.width=70,this.height=30,this.text="INICIO",this.startPoint=!0,this.maxOutGoingRelation=1,this.type="start_terminator"}}),Workflow.EndTerminator=Loira.util.createClass(Workflow.Terminator,{initialize:function(t){this.callSuper("initialize",t),this.width=70,this.height=30,this.text="FIN",this.endPoint=!0,this.type="end_terminator"}}),Workflow.Data=Loira.util.createClass(Common.Symbol,{initialize:function(t){this.callSuper("initialize",t),this.width=100,this.height=70,this.text=t.text,this.type="data"},_render:function(t){t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType;var i=this.x+20,e=this.y,n=this.x+this.width,s=this.y+this.height;t.beginPath(),t.lineWidth=2,t.moveTo(i,e),t.lineTo(n,e),t.lineTo(n-20,s),t.lineTo(i-20,s),t.lineTo(i,e),t.stroke(),t.fillStyle="#fcf5d9",t.fill(),t.fillStyle="#000000",this._drawText(t,this._splitText(t,this.text))},_splitText:function(t,i){for(var e=i.split(" "),n="",s=[],a=0;a<e.length;a++)t.measureText(n+e[a]).width>this.width-10?(s.push(n),n=e[a]+" "):n=n+" "+e[a];return s.push(n),s},_drawText:function(t,i,e,n){var s=(this.x,this.y),a=this.x+this.width/2,o=this.y+this.height/2;if("string"==typeof i){var r=i;i=[r]}s=o+3-(6*i.length+3*i.length)/2;for(var h=0;h<i.length;h++){var l=t.measureText(i[h]).width;t.fillText(i[h],a-l/2,s+3),s=s+Loira.Config.fontSize+3}},obtainBorderPos:function(t,i){var e=this.width/2,n=this.height/2,s=e*n/Math.sqrt(e*e*i*i+n*n*t*t);return Math.sqrt(Math.pow(s*i,2)+Math.pow(s*t,2))}}),Workflow.Decision=Loira.util.createClass(Common.Symbol,{initialize:function(t){this.callSuper("initialize",t),this.width=100,this.height=70,this.text=t.text,this.type="decision"},_render:function(t){t.font=Loira.Config.fontSize+"px "+Loira.Config.fontType;var i=this.x,e=this.y,n=this.x+this.width/2,s=this.y+this.height/2,a=this.x+this.width,o=this.y+this.height;t.beginPath(),t.lineWidth=2,t.moveTo(n,e),t.lineTo(a,s),t.lineTo(n,o),t.lineTo(i,s),t.lineTo(n,e),t.stroke(),t.fillStyle="#fcf5d9",t.fill(),t.fillStyle="#000000",this._drawText(t,this._splitText(t,this.text))},_splitText:function(t,i){for(var e=i.split(" "),n="",s=[],a=0;a<e.length;a++)t.measureText(n+e[a]).width>this.width-10?(s.push(n),n=e[a]+" "):n=n+" "+e[a];return s.push(n),s},_drawText:function(t,i,e,n){var s=(this.x,this.y),a=this.x+this.width/2,o=this.y+this.height/2;if("string"==typeof i){var r=i;i=[r]}s=o+3-(6*i.length+3*i.length)/2;for(var h=0;h<i.length;h++){var l=t.measureText(i[h]).width;t.fillText(i[h],a-l/2,s+3),s=s+Loira.Config.fontSize+3}},obtainBorderPos:function(t,i,e){var n,s=this.x,a=this.y,o=this.x+this.width/2,r=this.y+this.height/2,h=this.x+this.width,l=Math.atan(i/t);return 0>t&&(l+=Math.PI),n=l>0&&1.6>l||l>3.15&&4.7>l?Loira.util.intersectPointLine(e,{x1:s,y1:r,x2:o,y2:a}):Loira.util.intersectPointLine(e,{x1:o,y1:a,x2:h,y2:r}),s=n.x-(this.x+this.width/2),a=n.y-(this.y+this.height/2),Math.sqrt(Math.pow(s,2)+Math.pow(a,2))}}),Loira.Config={fontSize:12,fontType:"Arial",selected:{color:"#339966"},background:"#aacccc",assetsPath:"../assets/"};